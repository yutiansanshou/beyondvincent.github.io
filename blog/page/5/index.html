
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>破船之家</title>
	<meta name="author" content="破船(BeyondVincent)">

	
	<meta name="description" content="Jun 6th, 2013 Step by Step, Windows商店应用开发 Windows Store App开发[052]变换(Transform)(1)简介 小引 在程序的开发过程中，变换是一个常用的操作，比如图片的缩放、旋转、移动等，都涉及到变换。在接下来的几篇文章中， &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="破船之家" type="application/atom+xml">
	
	<link rel="canonical" href="http://BeyondVincent.github.io/blog/page/5/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("beyondvincent@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">破船之家</a></h1>
<p class="subtitle">宠辱不惊，闲看庭前花开花落<br>去留无意，漫随天外云卷云舒<br>不妄取，不妄予，不妄想，不妄求<br>与人方便，随遇而安</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/about">关于我</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/beyondvincent" title="Weibo">Weibo</a>
		
		
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav></header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/81/" itemprop="url">Windows Store App开发[052]变换(Transform)(1)简介</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>在程序的开发过程中，变换是一个常用的操作，比如图片的缩放、旋转、移动等，都涉及到变换。在接下来的几篇文章中，我将对变换进行详细的介绍，欢迎你的阅读。</p>

<h3><a name="t4"></a>变换简介</h3>

<p>变换在数学上的定义是这样的：</p>

<p>非空集合A到自身的一个映射f：A→A称为集合A的变换。</p>

<p>变换是基于一个数学公式：从一个Point到新的一个Point。如果将某个对象所有的Point都应用到这个公式上，就可以达到移动、缩放、旋转等效果。</p>

<p>在Windows Runtime中，UIElement定义了三个属性来支持变换：</p>

<ol>
<li>RenderTransform——位置变换信息</li>
<li>RenderTransformOrigin——RenderTransform变换的原点信息</li>
<li>Projection——投影效果(三维效果)</li>
</ol>


<p>这些属性是定义在UIElement上的，可知，所有的Element都可以进行变换，例如：Image、TextBlock和Button。如果在Panel的子类(如Grid)上进行变换，那么这个子类所有的children都会同时被变换。</p>

<h3><a name="t5"></a>变换类型</h3>

<p>在Windows Runtime中，变换类型有如下：</p>

<ol>
<li>仿射变换——RenderTransform</li>
<li>非仿射变换——Projection</li>
</ol>


<h4><a name="t6"></a>仿射变换</h4>

<p>仿射变换的继承关系，如下图所示：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/120.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb18.jpg" width="412" height="677" /></a></p>

<p>从图中我们可以看到，仿射变换有7种类型（粉色部分），平移、缩放、旋转等，在后续的文章中，我会详细介绍如何使用它们。</p>

<p>粉色部分的排列顺序是按照数学公式复杂度排列的，TranslateTransform最简单，TransformGroup最复杂。</p>

<p>这7个类定义了二维仿射变换，对象变换之后，直线依旧是直线，平行关系也不会发生改变。只不过位置、大小、方向发生改变而已。</p>

<p>前面已经说了RenderTransform是UIElement的属性，它的类型是Transform。所以可以把这7种类型赋值给RenderTransform。</p>

<h4><a name="t7"></a>非仿射变换——Projection</h4>

<p>非仿射变换的继承关系，如下图所示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/216.jpg"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb15.jpg" width="388" height="366" /></a></p>

<p>非仿射变换主要用于三维视觉，在使用的时候，只需要将PlaneProjection或Matrix3DProjection赋值给UIElement的属性Projection即可。</p>

<p>注：在三维空间中，旋转总是基于某个轴（xyz）进行的。</p>

<p>很明显：在这种情况下，对象的平行关系是会改变的。</p>

<p>Projection变换也经常称为模拟3D变换，比如Flip(翻转)。</p>

<p>在后续的文章中，我会对Projection进行详细介绍。</p>

<h3><a name="t8"></a>变换演示</h3>

<p>下面我写了个小示例，来演示一下仿射变换和非仿射变换的效果。</p>

<p>左边是原始效果，中间是以正中心为原点，旋转45度，右边是翻转45度</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/312.jpg"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb12.jpg" width="682" height="386" /></a></p>

<p>最后附上代码，方便大家自行演示效果</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" mc:ignorable="d" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:BV_Transform_Introduction" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="BV_Transform_Introduction.MainPage"&gt;

    &lt;grid background="Green"&gt;
        &lt;grid.columndefinitions&gt;
            &lt;columndefinition&gt;&lt;/columndefinition&gt;
            &lt;columndefinition&gt;&lt;/columndefinition&gt;
            &lt;columndefinition&gt;&lt;/columndefinition&gt;
        &lt;/grid.columndefinitions&gt;
        &lt;textblock margin="128,76,127,632" fontsize="50" horizontalalignment="Center" grid.row="0" grid.column="0" text="原始效果"&gt;&lt;/textblock&gt;
        &lt;img grid.row="0" grid.column="0" source="1.jpg" /&gt;&lt;/img&gt;
        &lt;textblock margin="128,76,127,632" fontsize="50" horizontalalignment="Center" grid.row="0" grid.column="1" text="旋转效果"&gt;&lt;/textblock&gt;
        &lt;img grid.row="0" grid.column="1" source="1.jpg" /&gt;
            &lt;image.rendertransformorigin&gt;0.5 0.5&lt;/image.rendertransformorigin&gt;
            &lt;image.rendertransform&gt;
                &lt;rotatetransform angle="45"&gt;&lt;/rotatetransform&gt;
            &lt;/image.rendertransform&gt;
        &lt;/img&gt;
        &lt;textblock margin="128,76,127,632" fontsize="50" horizontalalignment="Center" grid.row="0" grid.column="2" text="翻转效果"&gt;&lt;/textblock&gt;
        &lt;img grid.row="0" grid.column="2" source="1.jpg" /&gt;
            &lt;image.projection&gt;
                &lt;planeprojection rotationy="60"&gt;&lt;/planeprojection&gt;
            &lt;/image.projection&gt;
        &lt;/img&gt;
        &lt;img width="549" height="92" margin="352,676,0,0" horizontalalignment="Left" grid.column="1" source="BeyondVincentWin8Logo.png" grid.columnspan="2" verticalalignment="Top" /&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/TransformIntroduction" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/80/" itemprop="url">Windows Store App开发[051]数据绑定(3)通知属性改变</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>当绑定源的某个属性改变了，有时候在绑定目标上需要得到实时更新，比如航班起飞时间延误了，那么需要实时的将此信息告知乘客。本文，我就来介绍一下通知属性改变。</p>

<h3><a name="t4"></a>简介</h3>

<p>属性改变的通知在程序开发过程中非常的实用，用上了该功能，我们就不用自己去改变UI界面更新等操作了。通过绑定引擎可以完成属性改变通知，不过开发者也需要在代码上做一些编写。</p>

<h3><a name="t5"></a>通知属性改变的关键技术</h3>

<p>实现INotifyPropertyChanged接口</p>

<p>发起PropertyChanged事件</p>

<h3><a name="t6"></a>实现步骤</h3>

<p>A、新建空白工程，名称为BV_Binding_INotifyPropertyChanged</p>

<p>B、在项目工程上单击右键，选择添加->选择类->输入People，然后确定</p>

<p>C、在People.cs文件实现INotifyPropertyChanged接口</p>

<p>代码如下：</p>

<p>注：此demo的作用是对年龄属性进行增加，在小于18时，为未成年，否则为成年</p>

<p>在引发PropertyChanged事件时，使用属性名作为参数。如果要想表示所有属性都改变了，那么可以用string.Empty当作参数。在下面的代码中，有具体的演示</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace BV_Binding_INotifyPropertyChanged
{
    public class People : INotifyPropertyChanged
    {
        private int age = 0;

        private string typeLevel = &quot;未成年&quot;;

        public string TypeLevel
        {
            get { return typeLevel; }
            set
            {
                typeLevel = value;
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        public int Age
        {
            get { return age; }
            set
            {
                age = value;
                if (age &lt; 18)
                {
                    TypeLevel = &quot;未成年&quot;;
                }
                else
                { 
                    TypeLevel = &quot;成年&quot;;
                    NotifyPropertyChanged(string.Empty);
                    return;
                }

                NotifyPropertyChanged(&quot;Age&quot;);
            }
        }

        public void NotifyPropertyChanged(string propertyName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this,
                    new PropertyChangedEventArgs(propertyName));
            }
        }
    }
}</pre>


<p>D、在MainPage.xaml中使用绑定</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:BV_Binding_INotifyPropertyChanged" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="BV_Binding_INotifyPropertyChanged.MainPage" mc:ignorable="d"&gt;

    &lt;grid background="Green" name="grid"&gt;
        &lt;textblock foreground="White" fontsize="50" text="{Binding Age}" margin="462,193,556,485"&gt;&lt;/textblock&gt;
        &lt;textblock foreground="White" fontsize="50" text="{Binding TypeLevel}" margin="462,288,556,407"&gt;&lt;/textblock&gt;
        &lt;button content="+1" fontsize="50" margin="497,397,0,0" horizontalalignment="Left" height="84" verticalalignment="Top" width="247" click="Button_Click_1"&gt;
    &lt;/grid&gt;
&lt;/page&gt;

&lt;pre&gt;</pre>


<p></p></p>

<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>


<p></button></p>

<p>E、MainPage.xaml.cs中设置DataContent，并处理按钮事件</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;

// “空白页”项模板在 http://go.microsoft.com/fwlink/?LinkId=234238 上有介绍

namespace BV_Binding_INotifyPropertyChanged
{
    /// &lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;summary&gt;
    /// 可用于自身或导航至 Frame 内部的空白页。
    /// &lt;/summary&gt;
    public sealed partial class MainPage : Page
    {
        People people = new People();
        public MainPage()
        {
            this.InitializeComponent();

            grid.DataContext = people;
        }

        /// &lt;summary&gt;
        /// 在此页将要在 Frame 中显示时进行调用。
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;描述如何访问此页的事件数据。Parameter
        /// 属性通常用于配置页。&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }

        private void Button_Click_1(object sender, RoutedEventArgs e)
        {
            ++people.Age;
        }
    }
}</pre>


<p>F、运行效果</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/311.jpg"><img title="3" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb11.jpg" width="443" height="398" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/BindingINotifyPropertyChanged" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/79/" itemprop="url">Windows Store App开发[050]数据绑定(2)转换器</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>在数据绑定中，有时候我们要显示的内容跟绑定的源有所不同：比如：考生的分数60分以下为不及格或者糟糕、60-90为及格或还行，90分以上为优秀或非常棒。那么我们就需要对绑定源的数据进行处理。这篇文章，我就来说一说绑定中的转换器——通过转换器可以达到对数据的处理，以显示想要的内容。</p>

<h3><a name="t4"></a>简介</h3>

<p>由于<a href="http://beyondvincent.com/2013/06/06/windows-store-app%E5%BC%80%E5%8F%91049%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A1%E7%BB%91%E5%AE%9A%E6%A8%A1%E5%9E%8B/"><u>上一篇</u></a>文章中我只是介绍了绑定模型，没有对数据绑定进行介绍，那么我们先来看看下面这个图（来自msdn），以便对数据绑定有一个了解：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/119.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb17.jpg" width="591" height="249" /></a></p>

<p>上面这个图描述了数据绑定的如下内容：</p>

<p>A、绑定目标——必须是依赖属性，一般来说，都是在FrameworkElement中。</p>

<p>B、绑定对象——连接绑定源与绑定目标的一个对象，绑定引擎通过绑定对象，对绑定源和绑定目标进行相应的处理</p>

<p>C、绑定源——也就是数据的来源，只要是CLR对象即可，不一定必须是依赖属性</p>

<p>E、转换器——对绑定源与绑定目标的值进行转换的接口</p>

<p>本文就是使用到上面的转换器。</p>

<h3><a name="t5"></a>使用转换器的关键技术</h3>

<p>A、实现IValueConverter接口</p>

<p>B、创建一个转换器，告诉绑定对象使用该转换器</p>

<h3><a name="t6"></a>实现步骤</h3>

<p>A、新建空白工程，名称为BV_Binding_Convert</p>

<p>B、在项目工程上单击右键，选择添加->选择类->输入DataConverter，然后确定</p>

<p>C、在DataConverter.cs文件实现IValueConverter接口</p>

<p>IValueConverter接口需要重写两个函数：</p>

<p>Convert——当数据从数据源传递过来了，绑定引擎会掉用该方法，并将数据返回给绑定目标</p>

<p>ConvertBack——与Convert相反：当数据从绑定目标传递过来了，绑定引擎会掉用该方法，并将数据返回给绑定源</p>

<p>注意：在下面的代码中，我还利用了parameter参数，这是在绑定的时候可以指定的参数。可以在这里做一些判断。我在这里根据这个参数回返回不同的值。</p>

<p>另：在代码中我使用的是默认绑定模型：单向绑定，所以不会用到ConvertBack，我也就没有做具体的实现代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Windows.UI.Xaml.Data;

namespace BV_Binding_Convert
{
    // Define the Convert method to change a DateTime object to // a month string.
    public class DataConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, string language)
        {
            string type = parameter.ToString();

            double count = (double)value;
            string temp;
            if (count &lt; 60)
            {
                if (type == &quot;1&quot;)
                    temp = &quot;不及格&quot;;
                else
                    temp = &quot;糟糕&quot;;
            }
            else if (count &gt;= 60 &amp;&amp; count &lt;= 90)
            {
                if (type == &quot;1&quot;)
                    temp = &quot;及格&quot;;
                else
                    temp = &quot;还行&quot;;
            }
            else
            {
                if (type == &quot;1&quot;)
                    temp = &quot;优秀&quot;;
                else
                    temp = &quot;非常棒&quot;;
            }

            return temp;
        }

        public object ConvertBack(object value, Type targetType, object parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</pre>


<p>D、在xaml中使用绑定</p>

<p>我定义了一个Slider控件——当作绑定源</p>

<p>3个TextBlock当作绑定目标：1个是没有使用转换器，另外两个使用转换器，并携带了不同的参数。</p>

<p>具体代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" mc:ignorable="d" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:BV_Binding_Convert" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="BV_Binding_Convert.MainPage"&gt;

    &lt;page.resources&gt;
        &lt;local:dataconverter x:key="DataConverter1" /&gt;
    &lt;/page.resources&gt;

    &lt;!--LayoutRoot 是包含所有页面内容的根网格--&gt;
    &lt;grid background="Transparent" x:name="LayoutRoot"&gt;

        &lt;!--ContentPanel - 在此处放置其他内容--&gt;
        &lt;grid background="Green"&gt;
            &lt;slider margin="326,220,352,149" maximum="100" value="60" foreground="Red" name="slider"&gt;&lt;/slider&gt;
            &lt;textblock margin="554,286,542,254" text="{Binding ElementName=slider, Path=Value}" fontsize="50"&gt;&lt;/textblock&gt;
            &lt;textblock margin="554,366,542,174" text="{Binding ElementName=slider, Path=Value, Converter={StaticResource DataConverter1}, ConverterParameter=&#39;1&#39;}" fontsize="60"&gt;&lt;/textblock&gt;
            &lt;textblock margin="554,451,614,89" text="{Binding ElementName=slider, Path=Value, Converter={StaticResource DataConverter1}, ConverterParameter=&#39;2&#39;}" fontsize="60"&gt;&lt;/textblock&gt;
        &lt;/grid&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>E、运行效果</p>

<p>用鼠标滑动Slider控件，则绑定目标会根据Slider不同的值进行改变更新。</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/215.jpg"><img title="2" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb14.jpg" width="682" height="329" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/BindingConvert" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/78/" itemprop="url">Windows Store App开发[049]数据绑定(1)绑定模型</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>在Windows Store app开发中，数据绑定非常的重要，它提供了一个简单的方法，使我们的程序可以很方便的显示数据并与数据进行交互。今天我先给大家简单的介绍一下Windows Store app中的数据绑定，在后面的文章中，我会展开详细的介绍。</h3>

<h3><a name="t4"></a>简介</h3>

<p>数据绑定在UI控件中显示数据是非常重要的一部分内容。当任意一个UI控件使用了绑定，那么它将会显示出相应的数据。当然，很重要的一个因素就是当绑定的数据发生了改变，此时UI控件显示的内容就会自动的改变。同样，当用户在UI控件上做了改变，这些变动的数据也会被自动保存到数据对象中。</p>

<p>在数据绑定中，每一个绑定都有一个Mode属性，该属性决定了数据流是如何走向的。在Windows Store Apps中，如果使用XAML和C#开发，有3中Mode可以使用：</p>

<p>OneWay绑定</p>

<p>TwoWay绑定</p>

<p>Onetime绑定</p>

<h3><a name="t5"></a>OneWay</h3>

<p>这是默认的绑定模型。OneWay绑定中，数据流的走向是从绑定源流向绑定目标的，不能反过来。当绑定源的数据发生了改变，那么绑定目标会得到更新。</p>

<p>示例：TextBox的Background为绑定目标，ListBox的SelectedItem.Content为绑定源</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;grid background="BurlyWood"&gt;

    &lt;grid height="150" width="165"&gt;

        &lt;textbox background="{Binding ElementName=listBox, Path=SelectedItem.Content, Mode=OneWay}" height="82" fontsize="30" name="textBox" margin="0,-117,-218,0" verticalalignment="Top" foreground="Red" text="OneWay绑定模式"&gt;

        &lt;/textbox&gt;

        &lt;listbox fontsize="30" name="listBox" margin="0,0,-218,-70"&gt;

            &lt;listboxitem content="Green" /&gt;

            &lt;listboxitem content="Blue" isselected="True" /&gt;

            &lt;listboxitem content="Orange" /&gt;

        &lt;/listbox&gt;

    &lt;/grid&gt;

&lt;/grid&gt;</pre>


<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/118.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb16.jpg" width="546" height="420" /></a></p>

<h3>TwoWay</h3>

<p>就如名字一样，TwoWay绑定模式可以在绑定源于绑定目标之间相互同步数据。也就是说，无论是绑定源还是绑定目标，谁的数据改变了，另外一方的数据也会得到更新。</p>

<p>示例：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;grid background="Green"&gt;

    &lt;grid height="180" width="165"&gt;

        &lt;textbox height="56" fontsize="30" name="textBox" margin="0,-101,-192,0" verticalalignment="Top" text="{Binding ElementName=listBox,&#13;&#10;&#13;&#10;                    Path=SelectedItem.Content,&#13;&#10;&#13;&#10;                    Mode=TwoWay}"&gt;

        &lt;/textbox&gt;

        &lt;listbox fontsize="30" name="listBox" margin="0,0,-192,-62"&gt;

            &lt;listboxitem content="破船" /&gt;

            &lt;listboxitem content="BeyondVincent" /&gt;

            &lt;listboxitem content="小破船" /&gt;

            &lt;listboxitem content="小BeyondVincent" /&gt;

        &lt;/listbox&gt;

    &lt;/grid&gt;

&lt;/grid&gt;</pre>


<p>当选择ListBox中的数据时，TextBox中的内容也会跟着改变</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/214.jpg"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb13.jpg" width="510" height="451" /></a></p>

<p>当在TextBox中修改文本内容，ListBox中对应选中项也会改变[注意，TextBox需要失去Focus，才会触发数据改变]</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/310.jpg"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb10.jpg" width="553" height="456" /></a></p>

<h3>OneTime</h3>

<p>OneTime绑定模式，数据流是从绑定源到绑定目标的，并且只有一次。当绑定源的数据第一次发生改变时，绑定目标会得到更新。以后绑定源再怎么改变，绑定目标都不会更新。当需要查看数据首次加载情况时，可以选择这种模式。</p>

<p>示例：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;grid background="Green"&gt;

    &lt;stackpanel verticalalignment="Center" orientation="Vertical"&gt;

        &lt;slider background="Wheat" margin="593,0,354,0" value="50" maximum="100" minimum="1" x:name="sliderOneTimeDataSource" /&gt;

        &lt;textbox height="86" text="{Binding ElementName=sliderOneTimeDataSource, Path=Value, Mode=OneTime}" margin="608,0,354,0" fontsize="50" x:name="tbOneTimeDataBound" /&gt;

    &lt;/stackpanel&gt;

&lt;/grid&gt;</pre>


<p>当源数据确定后，绑定就已经完成了。所以之后Slider再怎么改变数据，都不会影响到TextBox的内容。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/410.jpg"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb10.jpg" width="531" height="273" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/BindingMode" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/77/" itemprop="url">Windows Store App开发[048]模仿开始屏幕中磁贴的按下、移动效果</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>在Windows 8的开始屏幕上全是一些方块，当我们用鼠标或者手去触摸时，会有不同的按下倾斜效果，移动的时候也会有放大+半透明的效果。这效果非常的cool。那么这篇博文，我就在自定义一下Button，让其具有类似的效果（Tile内容更新的效果不在此范围，或许在以后的文章中我会写，此文只讨论按下、移动效果）。</p>

<p>注：我在这里称这样的按钮为TileButton</p>

<h3><a name="t4"></a>自定义TileButton的关键技术</h3>

<p>A、继承自Button，这样会方便很多，只需要做极少部分的处理</p>

<p>B、截获按下事件，首先分析按下位置，然后根据位置做不同的效果</p>

<p>C、移动过程中，对按钮做放大和半透明处理，增加用户体验</p>

<h3><a name="t5"></a>制作步骤</h3>

<p>1、新建空白工程，名称为BV_TileButton</p>

<p>2、在项目工程上单击右键，选择添加->选择类->输入BV_TileButton，然后确定</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/117.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb15.jpg" width="682" height="415" /></a></p>

<p>3、打开BV_TileButton.cs文件：</p>

<p>里面的内容如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">/*
* ==============================================================================
* Filename: BV_TileButton.cs
 * 
* Description: 
* TileButton实现了按下、拖动等效果，有点类似开始屏幕那些磁贴的按下、拖动效果、还支持缩放、旋转等。
 * 还存在的问题：在边界按下时，进行拖动没有效果，暂时不知道如何处理
 * 
* Version: 1.0
* Created: 2012/11/15 21:32:23
*
* Author: BeyondVincent(破船)
* http://weibo.com/beyondvincent
* qq:77973689
* ==============================================================================
*/

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Windows.Foundation;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;

namespace BV_TileButton
{
    class BV_TileButton : Button
    {
        // 翻转效果
        PlaneProjection projection;

        // 移动、缩放、旋转等转换
        CompositeTransform transform;

        // 按下时，倾斜的角度
        int angle = 10;

        // 拖动多远时，开始移动空间
        double dragoffx = 5;
        double dragoffy = 5;

        // 构造函数 做一些初始化工作
        public BV_TileButton()
        {
            projection = new PlaneProjection();
            Projection = projection;
            transform = new CompositeTransform();
            RenderTransform = transform;

            ManipulationMode = ManipulationModes.Rotate | ManipulationModes.Scale | ManipulationModes.TranslateX | ManipulationModes.TranslateY;
        }

        /*
         * 按下时的事件处理，两个步骤
         * 1、首先判断当前按下去的位置在控件的那个区域（控件共分为9个区域，详见PressPointLocation定义）
         * 2、根据按下去的位置，对控件做不同的效果
         */
        protected override void OnPointerPressed(Windows.UI.Xaml.Input.PointerRoutedEventArgs e)
        {
            // 获得当前区域位置
            PressPointLocation location = GetPointLocation(e.GetCurrentPoint(this).Position);


            // 开始对控件做效果处理

            
            if (location == (PressPointLocation.Left | PressPointLocation.YCenter))
            {// 左中
                projection.RotationY = angle;
                projection.CenterOfRotationX = 1;
            }
            else if (location == (PressPointLocation.Left | PressPointLocation.Top))
            {// 左上
                projection.RotationX = -angle;
                projection.RotationY = angle;
                projection.CenterOfRotationX = 1;
                projection.CenterOfRotationY = 1;

            }
            else if (location == (PressPointLocation.Top | PressPointLocation.XCenter))
            {// 上中
                projection.RotationX = -angle * 2;
                projection.CenterOfRotationY = 1;
            }
            else if (location == (PressPointLocation.Right | PressPointLocation.Top))
            {// 右上
                projection.RotationY = projection.RotationX = -angle;
                projection.CenterOfRotationX = 0;
                projection.CenterOfRotationY = 1;
            }
            else if (location == (PressPointLocation.Right | PressPointLocation.YCenter))
            {// 右中
                projection.RotationY = -angle;
                projection.CenterOfRotationX = 0;
            }
            else if (location == (PressPointLocation.Right | PressPointLocation.Bottom))
            {// 右下
                projection.RotationX = angle;
                projection.RotationY = -angle;

                projection.CenterOfRotationX = 0;
                projection.CenterOfRotationY = 0;
            }
            else if (location == (PressPointLocation.Bottom | PressPointLocation.XCenter))
            {// 下中
                projection.RotationX = angle * 2;

                projection.CenterOfRotationY = 0;
            }
            else if (location == (PressPointLocation.Left | PressPointLocation.Bottom))
            {// 左下
                projection.RotationY = projection.RotationX = angle;

                projection.CenterOfRotationX = 1;
                projection.CenterOfRotationY = 1;
            }
            else if (location == (PressPointLocation.XCenter | PressPointLocation.YCenter))
            {// 正中
                CompositeTransform transform = RenderTransform as CompositeTransform;

                transform.CenterX = ActualWidth/2;
                transform.CenterY = ActualHeight/2;
                transform.ScaleX = 0.9;
                transform.ScaleY = 0.9;
            }
        }

        /*
         * 按下放开时的事件处理
         * 主要是做一些还原处理（旋转角度归零、缩放还原、透明度设置等）
         */
        protected override void OnPointerReleased(Windows.UI.Xaml.Input.PointerRoutedEventArgs e)
        {
            projection.RotationX = 0;
            projection.RotationY = 0;

            CompositeTransform transform = RenderTransform as CompositeTransform;

            transform.CenterX = ActualWidth / 2;
            transform.CenterY = ActualHeight / 2;
            transform.ScaleX = 1;
            transform.ScaleY = 1;

            Opacity = 1;

            dragoffx = 0;
            dragoffy = 0;
        }

        /*
         * 有移动等操作时的事件处理
         * 主要包括移动、放大、透明等
         */
        protected override void OnManipulationDelta(ManipulationDeltaRoutedEventArgs e)
        {
            dragoffx += e.Delta.Translation.X;
            dragoffy += e.Delta.Translation.Y;

            if (-10 &lt;= dragoffx &amp;&amp; dragoffx &lt;= 10 &amp;&amp; -10 &lt;= dragoffy &amp;&amp; dragoffy &lt;= 10)
                return;

            transform.CenterX = ActualWidth / 2;
            transform.CenterY = ActualHeight / 2;
            transform.ScaleX = 1.1;
            transform.ScaleY = 1.1;

            Opacity = 0.5;

            projection.RotationX = 0;
            projection.RotationY = 0;

            transform.TranslateX += e.Delta.Translation.X;
            transform.TranslateY += e.Delta.Translation.Y;

            transform.ScaleX *= e.Delta.Scale;
            transform.ScaleY *= e.Delta.Scale;

            transform.Rotation += e.Delta.Rotation;

            base.OnManipulationDelta(e);
        }

        /*
         * 获取控件所在的区域算法
         */
        PressPointLocation GetPointLocation(Point point)
        {
            PressPointLocation location = PressPointLocation.None;

            double tempwidth = ActualWidth / 3;
            if (point.X &lt; tempwidth)
            {
                location |= PressPointLocation.Left;
            }
            else if (point.X &gt; tempwidth * 2)
            {
                location |= PressPointLocation.Right;
            }
            else
            {
                location |= PressPointLocation.XCenter;
            }

            double tempheight = ActualHeight / 3;
            if (point.Y &lt; tempheight)
            {
                location |= PressPointLocation.Top;
            }
            else if (point.Y &gt; tempheight * 2)
            {
                location |= PressPointLocation.Bottom;
            }
            else
            {
                location |= PressPointLocation.YCenter;
            }
            Debug.WriteLine(location.ToString());
            return location;
        }
    }

    public enum PressPointLocation
    {
        None = 0,
        Left = 1,
        Top = 2,
        Right = 4,
        Bottom = 8,
        XCenter = 16,
        YCenter = 32
    }

    /*
         * 获取指定控件的Rect
         */
    public static class BV_ToolAPI
    {
        public static Rect GetElementRect(this FrameworkElement element)
        {
            GeneralTransform buttonTransform = element.TransformToVisual(null);
            Point point = buttonTransform.TransformPoint(new Point());
            return new Rect(point, new Size(element.ActualWidth, element.ActualHeight));
        }
    }
}</pre>


<p>代码有详细注释，在此不过多讲解。</p>

<p>4、在MainPage.xaml文件中，添加如下代码：</p>

<p>注意：其中3行3列的girid控件是为了演示效果，为控件划分不同的区域。在实际开发中，不需要。</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" mc:ignorable="d" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:BV_TileButton" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="BV_TileButton.MainPage"&gt;

    &lt;grid background="Green"&gt;
        &lt;local:bv_tilebutton width="310" verticalalignment="Center" height="150" horizontalalignment="Center"&gt;
            &lt;local:bv_tilebutton.content&gt;
                &lt;grid margin="0 0 0 0"&gt;
                   
                    &lt;img margin="-15,-9,-16,-10" source="Assets/widelogo.png" /&gt;
                    &lt;img margin="-19,94,234,-6" source="Assets/logo.png" /&gt;
                    &lt;textblock margin="244,90,0,0" foreground="Red" fontsize="30" text="5"&gt;&lt;/textblock&gt;
                    &lt;textblock margin="7,20,10,72" foreground="Magenta" fontsize="25" text="读书的女孩子，很好噢" fontfamily="宋体"&gt;&lt;/textblock&gt;
                    &lt;grid margin="-15,-9,-16,-10" visibility="Visible"&gt;
                        &lt;grid.columndefinitions&gt;
                            &lt;columndefinition&gt;&lt;/columndefinition&gt;
                            &lt;columndefinition&gt;&lt;/columndefinition&gt;
                            &lt;columndefinition&gt;&lt;/columndefinition&gt;
                        &lt;/grid.columndefinitions&gt;
                        &lt;grid.rowdefinitions&gt;
                            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
                            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
                            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
                        &lt;/grid.rowdefinitions&gt;
                        &lt;border grid.row="0" grid.column="0" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="1" grid.column="0" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="2" grid.column="0" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="0" grid.column="1" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="1" grid.column="1" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="2" grid.column="1" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="0" grid.column="2" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="1" grid.column="2" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                        &lt;border grid.row="2" grid.column="2" borderbrush="Red" borderthickness="1"&gt;&lt;/border&gt;
                    &lt;/grid&gt;
                &lt;/grid&gt;
            &lt;/local:bv_tilebutton.content&gt;
        &lt;/local:bv_tilebutton&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>5、运行效果展示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/213.jpg"><img title="2" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb12.jpg" width="402" height="232" /></a> <a href="http://beyondvincent.com/wp-content/uploads/2013/06/39.jpg"><img title="3" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb9.jpg" width="390" height="220" /></a> <a href="http://beyondvincent.com/wp-content/uploads/2013/06/49.jpg"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb9.jpg" width="424" height="247" /></a> </p></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/TileButton" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/76/" itemprop="url">Windows Store App开发[047]自定义Popup</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>在<a href="http://beyondvincent.com/2013/06/06/windows-store-app%e5%bc%80%e5%8f%91044%e8%87%aa%e5%ae%9a%e4%b9%89messagedialog/"><u>上一篇</u></a>文章中，我利用Popup和UserControl自定义了MessageDialog。那么这篇文章我接着自定义Popup。这次的效果是在画面内弹出一个对话框，对话框会以不同的方式弹出。当点击对话框以外的位置时，对话框会自动消失。</p>

<h3><a name="t4"></a><a name="t4"></a><a name="t4"></a>自定义Popup的关键技术点</h3>

<p>利用UserControl控件，在里面添加Popup，然后对外界暴露一个是否显示对话框的接口。</p>

<p>准备好Popup是用到的图片资源，如下两个图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/116.jpg"><img title="1" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb14.jpg" width="204" height="201" /></a> <a href="http://beyondvincent.com/wp-content/uploads/2013/06/213.png"><img title="2" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb14.png" width="244" height="164" /></a></p>

<p>&#160;</p>

<h3>制作步骤</h3>

<p>1、新建空白工程，名称为BV_CustomPopup</p>

<p>2、在项目工程上单击右键，选择添加->新建项->选择用户控件->输入名称BV_CustomPopup.xaml，然后确定</p>

<p>3、在BV_CustomPopup.xaml中输入如下内容：</p>

<p>&lt;UserControl</p>

<p>&#160;&#160;&#160; x:Class=&ldquo;BV_WindowsRuntimeComponent.UI.BV_CustomPopup&rdquo;</p>

<p>&#160;&#160;&#160; xmlns=&ldquo;<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</a>&rdquo;</p>

<p>&#160;&#160;&#160; xmlns:x=&ldquo;<a href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</a>&rdquo;</p>

<p>&#160;&#160;&#160; xmlns:local=&ldquo;using:BV_WindowsRuntimeComponent.UI&rdquo;</p>

<p>&#160;&#160;&#160; xmlns:d=&ldquo;<a href="http://schemas.microsoft.com/expression/blend/2008">http://schemas.microsoft.com/expression/blend/2008</a>&rdquo;</p>

<p>&#160;&#160;&#160; xmlns:mc=&ldquo;<a href="http://schemas.openxmlformats.org/markup-compatibility/2006">http://schemas.openxmlformats.org/markup-compatibility/2006</a>&rdquo;</p>

<p>&#160;&#160;&#160; mc:Ignorable=&ldquo;d&rdquo; Height=&ldquo;200&rdquo; Width=&ldquo;300&rdquo;></p>

<p>&#160;&#160;&#160; <Popup x:Name="popup" IsLightDismissEnabled="True" ></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Popup.ChildTransitions></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <TransitionCollection></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<PaneThemeTransition Edge="Bottom" />&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<AddDeleteThemeTransition/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<ContentThemeTransition/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<EntranceThemeTransition/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<EdgeUIThemeTransition Edge="Bottom"/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <PopupThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<ReorderThemeTransition/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;!&#8211;<RepositionThemeTransition/>&#8211;></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </TransitionCollection></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/Popup.ChildTransitions></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <Grid Width="300" Height="200" ></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Grid.Background></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <ImageBrush ImageSource="../picture/PopupBackground.png"></ImageBrush></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/Grid.Background></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <Image HorizontalAlignment="Left" Height="57" Margin="220,116,0,0" VerticalAlignment="Top" Width="59" Source="ms-appx:///BV_WindowsRuntimeComponent/picture/1.jpg"/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <TextBlock FontSize="30"&#160; HorizontalAlignment="Center" Height="47" Margin="38,64,0,0" TextWrapping="Wrap" Text="世界破船最大" VerticalAlignment="Top" Width="180"/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </Grid></p>

<p>&#160;&#160;&#160; </Popup></p>

<p></UserControl></p>

<p>大家注意，上面代码中，我们可以给Popup添加如下一些动画效果：</p>

<p><PaneThemeTransition Edge="Bottom" /></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <AddDeleteThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <ContentThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <EntranceThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <EdgeUIThemeTransition Edge="Bottom"/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <PopupThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <ReorderThemeTransition/></p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <RepositionThemeTransition/></p>

<p>4、在BV_CustomPopup.xaml.cs文件中，添加如下代码：</p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.IO;</p>

<p>using System.Linq;</p>

<p>using Windows.Foundation;</p>

<p>using Windows.Foundation.Collections;</p>

<p>using Windows.UI.Xaml;</p>

<p>using Windows.UI.Xaml.Controls;</p>

<p>using Windows.UI.Xaml.Controls.Primitives;</p>

<p>using Windows.UI.Xaml.Data;</p>

<p>using Windows.UI.Xaml.Input;</p>

<p>using Windows.UI.Xaml.Media;</p>

<p>using Windows.UI.Xaml.Navigation;</p>

<p>// The User Control item template is documented at <a href="http://go.microsoft.com/fwlink/?LinkId=234236">http://go.microsoft.com/fwlink/?LinkId=234236</a></p>

<p>namespace BV_WindowsRuntimeComponent.UI</p>

<p>{</p>

<p>&#160;&#160;&#160; public sealed partial class BV_CustomPopup : UserControl</p>

<p>&#160;&#160;&#160; {</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; public BV_CustomPopup()</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.InitializeComponent();</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; public bool IsOpen</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; get { return popup.IsOpen; }</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set { popup.IsOpen = value; }</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>

<p>&#160;&#160;&#160; }</p>

<p>}</p>

<p>5、在MainPage.xaml.cs文件中，添加如下代码：</p>

<p>private void btn1_Copy2_Click(object sender, RoutedEventArgs e)</p>

<p>{</p>

<p>&#160;&#160;&#160; BV_WindowsRuntimeComponent.UI.BV_CustomPopup popup = new BV_WindowsRuntimeComponent.UI.BV_CustomPopup();</p>

<p>&#160;&#160;&#160; grid.Children.Add(popup);</p>

<p>&#160;&#160;&#160; popup.IsOpen = true;</p>

<p>}</p>

<p>6、运行效果如下：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/38.jpg"><img title="3" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb8.jpg" width="534" height="414" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/CustomPopup" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/75/" itemprop="url">Windows Store App开发[046]调用自己的异步函数</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>注1：本文译自Programming Windows, 6th Edition Charpter 7 Calling Your Own Async Methods</p>

<p>&#160;&#160;&#160; 假设你用类似下面的这个方法进行隔离存贮中文件保存的逻辑：</p>

<p>async void SaveFile(string text)</p>

<p>{</p>

<p>&#160;&#160;&#160; FileSavePicker picker = new FileSavePicker();</p>

<p>&#160;&#160;&#160; picker.DefaultFileExtension = &ldquo;.txt&rdquo;;</p>

<p>&#160;&#160;&#160; picker.FileTypeChoices.Add(&ldquo;Text&rdquo;, new List<string> { &ldquo;.txt&rdquo; });</p>

<p>&#160;&#160;&#160; StorageFile storageFile = await picker.PickSaveFileAsync();</p>

<p>&#160;&#160;&#160; if (storageFile == null)</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;</p>

<p>&#160;&#160;&#160; await FileIO.WriteTextAsync(storageFile, txtbox.Text);</p>

<p>}</p>

<p>这个方法必须标记为async，因为它有await关键字。然后你可以在OnSaveAsAppBarButtonClick函数中这样调用：</p>

<p>void OnSaveAsAppBarButtonClick(object sender, RoutedEventArgs args)</p>

<p>{</p>

<p>&#160;&#160;&#160; SaveFile(txtbox.Text);</p>

<p>}</p>

<p>OnSaveAsAppBarButtonClick调用SaveFile发生什么呢：SaveFile开始执行，直到第一个await后的PickSaveFileAsync被调用，在这里，SaveFile函数终止并将控制权返回给OnSaveAsAppBarButtonClick函数。当PickSaveFileAsync结果准备好了，SaveFile剩余的代码继续被执行。</p>

<p>&#160;&#160;&#160; 在这种特殊情况下，是正确的。然而，如果如果你想要OnSaveAsAppBarButtonClick方法等待SaveFile的执行，必须包含await关键字，并用async标识OnSaveAsAppBarButtonClick方法：</p>

<p>async void OnSaveAsAppBarButtonClick(object sender, RoutedEventArgs args)</p>

<p>{</p>

<p>&#160;&#160;&#160; await SaveFile(txtbox.Text);</p>

<p>}</p>

<p>但是，当你这样做的话，SaveFile必须要改变一下。它不能再返回void。你可以有许多种方法修改SaveFile，但是可能最简单方法就是将返回类型修改为Task：</p>

<p>async Task SaveFile(string text)</p>

<p>{</p>

<p>&#160;&#160;&#160; &#8230;</p>

<p>}</p>

<p>&#160; 在这里，你可能想将方法的名字改为SaveFileAsync，标识这是一个异步方法，可以被等待。即使在SaveFileAsync方法中没有写明运行在别的线程里，但是调用SaveFileAsync的异步方法会在另外的线程中处理。</p>

<p>下面的OnOpenAppBarButtonClick与ReadFileAsync方法又有点不同。你可能希望ReadFileAsync方法返回文件中的文本内容，所以返回类型不是Task，而是Task<string>:</p>

<p>async Task<string> ReadFileAsync()</p>

<p>{</p>

<p>&#160;&#160;&#160; FileOpenPicker picker = new FileOpenPicker();</p>

<p>&#160;&#160;&#160; picker.FileTypeFilter.Add(&ldquo;.txt&rdquo;);</p>

<p>&#160;&#160;&#160; StorageFile storageFile = await picker.PickSingleFileAsync();</p>

<p>&#160;&#160;&#160; if (storageFile == null)</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; return null;</p>

<p>&#160;&#160;&#160; return await FileIO.ReadTextAsync(storageFile);</p>

<p>}</p>

<p>然后可以像如下调用ReadFileAsync：</p>

<p>async void OnOpenAppBarButtonClick(object sender, RoutedEventArgs args)</p>

<p>{</p>

<p>&#160;&#160;&#160; string text = await ReadFileAsync();</p>

<p>&#160;&#160;&#160; if (text != null)</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; txtbox.Text = text;</p>

<p>}</p>

<p>认识到这些所有的代码都在用户界面线程执行很重要。你不用担心UI对象的访问。FileIO的两个方法是在别的线程中运行的，由于ReadFileAsync方法调用了其它的异步方法，所以它也是异步的。方法中的其它代码则在UI线程运行。</p>

<p>如果你自己写的代码需要很长的处理时间，而你不希望在UI线程中处理，替代传统的技术（创建并执行线程）是考虑使用与Windows Runtime一样的基于任务的方法。你可以将要执行的代码以函数的方式传递给静态方法Task.Run。如下示例：</p>

<p>Task<double> BigJobAsync(int arg1, int arg2)</p>

<p>{</p>

<p>&#160;&#160;&#160; return Task.Run<double>(() =></p>

<p>&#160;&#160;&#160; { double val = 0;</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; // &#8230; lengthy code</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; return val;</p>

<p>&#160;&#160;&#160; });</p>

<p>}</p>

<p>在匿名方法中的所执行的内容都是在另外一个线程中进行的。这也会引起一个问题：它不能访问UI对象。然后，你可以按照下面的代码来访问这个方法：</p>

<p>double value = await BigJobAsync(22, 33);</p>

<p>如果，BigJobAsync中的匿名方法包含了await操作，那么需要将匿名方法标记为async：</p>

<p>Task<double> BigJobAsync(int arg1, int arg2)</p>

<p>{</p>

<p>&#160;&#160;&#160; return Task.Run<double>(async () =></p>

<p>&#160;&#160;&#160; { double val = 0;</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; // &#8230; lengthy code</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; return val;</p>

<p>&#160;&#160;&#160; });</p>

<p>}</p>

<p>在后面的章节中，我会详细介绍异步处理。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/74/" itemprop="url">Windows Store App开发[045]Await和Async</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>注1：本文译自Programming Windows, 6th Edition Charpter 7 Await and Async</p>

<p>&#160;&#160;&#160; 注2：本文内容是关于Await和Async的一个简介，关于详细内容，我会在后续文章中进行介绍</p>

<p>&#160;&#160;&#160; 注3：通过本文的阅读，你可以知道如何在Windows 8中进行简单的异步调用，以及一些注意事项。</p>

<p>&#160;&#160;&#160; C# 5.0的关键字await允许我们对异步的操作就如同正常方法的调用一样。SimplePad2程序除了在应用程序栏中的按钮处理打开和保存外，跟SimplePad1一样。下面是Save按钮的Click事件处理代码：</p>

<p>工程：SimplePad2 | 文件：MainPage.xaml.cs(节选)</p>

<pre class="wp-code-highlight prettyprint linenums:1">async void OnSaveAsAppBarButtonClick(object sender, RoutedEventArgs args)
{
    FileSavePicker picker = new FileSavePicker();
    picker.DefaultFileExtension = &quot;.txt&quot;;
    picker.FileTypeChoices.Add(&quot;Text&quot;, new List&lt;string&gt; { &quot;.txt&quot; });

    // Asynchronous call!
    StorageFile storageFile = await picker.PickSaveFileAsync();

    if (storageFile == null)
        return;

    // Asynchronous call!
    await FileIO.WriteTextAsync(storageFile, txtbox.Text);
}&lt;/string&gt;</pre>


<p>注意两个await前面的注释。PickSaveFileAsync实际上是返回一个IAsyncOperation，一般你需要给它设置一个完成处理的函数，然后在这个完成处理回调中调用GetResults以获取StorageFile对象。await操作看似绕过了所有复杂的东西，而是直接简单的返回 StorageFile。这究竟是怎么回事呢？</p>

<p>&#160;&#160;&#160; 这看起来很神奇，但是许多杂乱的实现细节已经隐藏起来了。C#编译器生成回调(callback)，并且调用GetResults。但是await操作同样将该方法转入一个状态机。（But what the await operator also does is turn the method in which it’s used into a state machine.）OnSaveAsAppBarButtonClick方法开始执行很正常，直到PickSaveFileAsync被调用以及await第一次出现。</p>

<p>&#160;&#160;&#160; 虽然名为await，但是await并不等待操作完成。相反，Click处理函数在这里退出了。控制权回到Windows。其它的代码，可以在程序用户界面线程继续执行，同时也可以对进行文件选取(file-picker)。当文件选取器消失了，即用户对文件选取的结果已经出来了，那么UI线程就准备执行一些代码——继续执行Click处理函数：赋值storageFile变量，然后继续往下执行，直到下一个await操作。就像这样，可以一直往下执行许多await操作（如果有），直到函数完成。</p>

<p>&#160;&#160;&#160; 在Click处理函数中的最后一行代码调用了静态方法FileIO.WriteTextAsync。严格来将，这里的await操作符可以不需要，因为在这里并不需要这个方法的执行结果。File.WriteTextAsync方法不返回任何内容，并且在Click处理函数中，并没有其它代码依赖于此的。因此在这种ing狂下，await操作符可以移除，程序代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">FileIO.WriteTextAsync(storageFile, txtbox.Text);  </pre>


<p>你会收到一条来自编译器的警告消息，但是这没问题。await操作符只在下面两种情况比较关键：你需要从异步方法中获得一个返回值，再者就是在程序逻辑上继续执行之前，异步方法必须完成则需要使用await操作符。</p>

<p>&#160;&#160;&#160; 下面是Open按钮的Click事件处理函数，使用了静态方法FileIO.ReadTextAsync：</p>

<p>工程：SimplePad2 | 文件：MainPage.xaml.cs(节选)</p>

<pre class="wp-code-highlight prettyprint linenums:1">async void OnOpenAppBarButtonClick(object sender, RoutedEventArgs args)
{
    FileOpenPicker picker = new FileOpenPicker();
    picker.FileTypeFilter.Add(&quot;.txt&quot;);

    // Asynchronous call!
    StorageFile storageFile = await picker.PickSingleFileAsync();

    if (storageFile == null)
        return;

    // Asynchronous call!
    txtbox.Text = await FileIO.ReadTextAsync(storageFile);
}</pre>


<p>在await出现之前，C#中异步操作的调用总是有悖于语言的必要组织结构。await操作符带来了必要组织结构，并将异步调用转换为一系列普通方法的调用。而且在Click处理函数中的所有事情都是在UI线程中进行的，因此必用考虑用户界面对象的访问。虽然await的使用，更加简单，但是你要记住的是如果一个函数中出现了await，那么实际上在后端是将该函数分片处理的。</p>

<p>&#160;&#160;&#160; 这里有一些await的使用条款。await不能出现在异常处理的catch或finally语句中。而它可以出现在try语句中，这也是捕获异步函数发生错误的方法。同关键字，样还提供了取消操作，以及一些异步函数的进度通知。这些具体细节我将在后面的异步操作章节中介绍。</p>

<p>&#160;&#160;&#160; 如果函数中出现了await操作符，那么该函数必须用async标识，但是async并不做其它更多的事情。在早期的C#版本中，await并不是一个关键字，所以程序员可以将这个单词(await)用作变量名或属性名，或者其它任何内容。C#5.0中添加了await关键字将改变这一现状，不过使用async标识来限制函数中的await。async不会改变函数的签名——上面的方法任然是Click的处理方法。但是async(以及await)不能被用在入口点，如Main或者类的构造函数中。</p>

<p>&#160;&#160;&#160; 如果你需要在初始化一个FrameworkElement子类时调用异步方法，那么请在Loaded事件处理函数中进行，并将处理函数标记为async：</p>

<pre class="wp-code-highlight prettyprint linenums:1">public MainPage()
{
    this.InitializeComponent();
    ...
    Loaded += OnLoaded;
}
async void OnLoaded(object sender, RoutedEventArgs arg)
{
    ...
}</pre>


<p>或者，如果你喜欢的话，可以按照下面的代码，将Loaded处理函数定义为一个异步函数：</p>

<pre class="wp-code-highlight prettyprint linenums:1">public MainPage()
{
    this.InitializeComponent();

    ...

    Loaded += async (sender, args) =&gt;
    {
        ...
    };
}</pre>


<p>看到参数列表前的async了吗？</p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SimplePad2" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-06</span>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/73/" itemprop="url">Windows Store App开发[044]自定义MessageDialog</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>上一篇文章介绍了Windows Store app中自带的MessageDialog的使用。那个控件使用起来是很方便，但有时候我们想要自己风格的MessageDialog，这时候自带的就满足不了我们的需求。那么在这篇文章中，我将介绍如何自定义MessageDialog。</p>

<h3><a name="t4"></a><a name="t4"></a>自定义MessageDialog关键技术点</h3>

<p>1、自定义控件，在该控件可以写我们想要的对话框。</p>

<p>2、使用Popup来显示自定义控件</p>

<h3><a name="t5"></a>制作步骤</h3>

<p>1、新建空白工程，名称为BV_CustomizeMessageDialog</p>

<p>2、在项目工程上单击右键，选择添加->新建项->选择用户控件->输入名称MyUserControl，然后确定</p>

<p>如下图</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/115.jpg"><img title="1" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb13.jpg" width="561" height="384" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/212.jpg"><img title="2" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb11.jpg" width="682" height="415" /></a></p>

<p>在MyUserControl.xaml文件中，设计自己的对话框</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/37.jpg"><img title="3" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb7.jpg" width="682" height="546" /></a></p>

<p>在MyUserControl.xaml.cs中，添加如下代码.当点击按钮时，把popup隐藏</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/48.jpg"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb8.jpg" width="579" height="532" /></a></p>

<p>这样就完成了自定义控件</p>

<p>2、在Main.xaml布局中添加一个Popup控件，先别显示出来，即IsLightDismissEnabled= “False”，等需要的时候在显示出来。这里注册了一个Closed事件，用于处理当对话框关闭时，的事件逻辑。</p>

<p><Popup Name="popup" Closed="popup\_Closed\_1" IsLightDismissEnabled="False"> <br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160; </Popup></p>

<p>在Main.xaml.cs文件中，添加如下代码，将自定义控件通过Popup显示出来。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/56.jpg"><img title="5" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb6.jpg" width="634" height="399" /></a>
&#160;</p>

<p>至此，代码完毕</p>

<h3><a name="t6"></a>运行效果</h3>

<p>show按钮</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/65.jpg"><img title="6" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb5.jpg" width="608" height="457" /></a> </p></p>

<p>&#160;</p>

<p>点击show按钮，对话框显示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/75.jpg"><img title="7" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb5.jpg" width="632" height="436" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/CustomizeMessageDialog" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-06</span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/06/72/" itemprop="url">Windows Store App开发[043]MessageDialog的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>小引</h3>

<p>最近有开发者问起Windows Store app中对话框如何使用，以及如何自定义对话框。在这篇文章中，我介绍Windows Store app中自带的对话框MessageDialog，实际上非常简单。在下一篇文章中，我将介绍如何使用Popup自定义对话框。</p>

<h3><a name="t4"></a>MessageDialog介绍</h3>

<p>MessaDialog类代表了一个对话框，该对话框中最多可以有3个Command。默认情况下有一个关闭命令。当MessageDialog显示出来时，会对屏幕进行灰度处理，并阻止其它操作。</p>

<p>关于对话框的详细资料，可以来参考msdn上的介绍，如下链接：</p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.popups.messagedialog"><u>http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.popups.messagedialog</u></a></p>

<h3><a name="t5"></a>默认MessageDialog的使用</h3>

<p>如下代码，直接构造，然后设置Title即可，然后调用ShowAsync进行显示。</p>

<pre class="wp-code-highlight prettyprint linenums:1">private async void Button_Click_1(object sender, RoutedEventArgs e)
{
    MessageDialog dialog = new MessageDialog(\\&quot;你好，这里是Windows Store app学习之旅！\\&quot;);
    dialog.Title = \\&quot;温馨提示\\&quot;;
    await dialog.ShowAsync();
}</pre>


<p>运行效果：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/115.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb13.png" width="682" height="389" /></a></p>

<h3>带Command的MessageDialog</h3>

<p>MessageDialog中有一个Command列表，如下定义：</p>

<p>IList<IUICommand> Commands</p>

<p>我们可以往这个列表中添加自己的Command，注意，最多只能是3个。如下代码：</p>

<p>在下面代码中，Command对应的操作是通过lambda表达式进行的，当然，这里也可以把操作内容单独封装在一个函数里面，此处略。</p>

<pre class="wp-code-highlight prettyprint linenums:1">private async void Button_Click_2(object sender, RoutedEventArgs e)
{
    MessageDialog dialog = new MessageDialog(&quot;你好，欢迎访问移动技术开发社区：DevDiv.com&quot;);
    dialog.Title = &quot;温馨提示&quot;;
    dialog.Commands.Add(new UICommand(&quot;DevDiv主页&quot;, command =&gt;
    {
        //在这里做相关操作
        OpenDevDiv(&quot;http://www.DevDiv.com&quot;);
    }));
    dialog.Commands.Add(new UICommand(&quot;关闭&quot;, command =&gt;
    {
        //在这里做相关操作
    }));
    await dialog.ShowAsync();
}</pre>


<p>运行效果：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/212.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb13.png" width="682" height="386" /></a></p>

<h3>获取MessageDialog的返回值</h3>

<p>我们可以获取MessageDialog的返回值，以根据返回内容，做相应的操作，如下代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private async void Button_Click_3(object sender, RoutedEventArgs e)
{
    MessageDialog dialog = new MessageDialog(&quot;你好，欢迎访问移动技术开发社区：DevDiv.com&quot;);
    dialog.Title = &quot;温馨提示&quot;;
    dialog.Commands.Add(new UICommand(&quot;DevDiv主页&quot;, null, 0));
    dialog.Commands.Add(new UICommand(&quot;DevDiv论坛&quot;, null, 1));
    dialog.Commands.Add(new UICommand(&quot;关闭&quot;, null, 2));
    var command = await dialog.ShowAsync();
    if (Convert.ToInt32(command.Id) == 0)
    {
        OpenDevDiv(&quot;http://www.DevDiv.com&quot;);
    }
    else if (Convert.ToInt32(command.Id) == 0)
    {
        OpenDevDiv(&quot;http://www.devdiv.com/forum.php&quot;);
    }
    else
    {
        // do nothing
    }
}</pre>


<p>运行效果：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/314.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb14.png" width="682" height="386" /></a></p>

<h3>设置MessageDialog中Command的index</h3>

<p>MessageDialog中的index有：</p>

<p>CancelCommandIndex：当按Esc键时，会触发该index对应的Command</p>

<p>DefaultCommandIndex：当按Enter键时，会触发该index对应的Command</p>

<p>如下代码：</p>

<p>当按Enter键时，访问DevDiv主页</p>

<p>当按Esc键时，做关闭命令</p>

<pre class="wp-code-highlight prettyprint linenums:1">private async void Button_Click_4(object sender, RoutedEventArgs e)
{
    MessageDialog dialog = new MessageDialog(&quot;你好，欢迎访问移动技术开发社区：DevDiv.com&quot;);
    dialog.Title = &quot;温馨提示&quot;;
    dialog.Commands.Add(new UICommand(&quot;DevDiv主页&quot;, null, 0));
    dialog.Commands.Add(new UICommand(&quot;DevDiv论坛&quot;, null, 1));
    dialog.Commands.Add(new UICommand(&quot;关闭&quot;, null, 2));

    dialog.DefaultCommandIndex = 0;
    dialog.CancelCommandIndex = 2;

    var command = await dialog.ShowAsync();
    if (Convert.ToInt32(command.Id) == 0)
    {
        //OpenDevDiv(&quot;http://www.DevDiv.com&quot;);
    }
    else if (Convert.ToInt32(command.Id) == 1)
    {
        OpenDevDiv(&quot;http://www.devdiv.com/forum.php&quot;);
    }
    else
    {
        // do nothing
    }
}</pre>


<h3>程序主画面运行效果</h3>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/411.png"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb11.png" width="682" height="386" /></a></p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/MessageDialog" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-06</span>
</div>




		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
        <a href="/blog/page/6/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">所有文章</a></div>
    
    <script type="text/javascript">
var duoshuoQuery = {short_name:"beyondvincent"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
</nav>

</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - 破船(BeyondVincent) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'beyondvincent001';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42893468-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1a3c98825a726bfbf68a83ba97e0b9be' type='text/javascript'%3E%3C/script%3E"));
    </script>

		</div>
	</div>
</body>
</html>
