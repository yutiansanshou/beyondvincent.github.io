
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>破船之家</title>
	<meta name="author" content="破船(BeyondVincent)">

	
	<meta name="description" content="Jun 3rd, 2013 Step by Step, Windows商店应用开发 Windows Store App开发[018]我收藏的一些文章：Windows 8 异步编程 在MSDN的Visual Studio 2012文档中，有一些关于异步编程的文章，这些文章是文档编写人推荐的， &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="破船之家" type="application/atom+xml">
	
	<link rel="canonical" href="http://BeyondVincent.github.io/blog/page/8/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("beyondvincent@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">破船之家</a></h1>
<p class="subtitle">宠辱不惊，闲看庭前花开花落<br>去留无意，漫随天外云卷云舒<br>不妄取，不妄予，不妄想，不妄求<br>与人方便，随遇而安</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/about">关于我</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/beyondvincent" title="Weibo">Weibo</a>
		
		
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav></header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/45/" itemprop="url">Windows Store App开发[018]我收藏的一些文章：Windows 8 异步编程</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在MSDN的Visual Studio 2012文档中，有一些关于异步编程的文章，这些文章是文档编写人推荐的，我在这里列出来，供大家参考 <br/>
<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh780559.aspx"><u>在C++中进行异步编程（Metro style apps）</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh700330.aspx"><u>在JavaScript中进行异步编程（Metro style apps）</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/hh158629.aspx"><u>Stream.WriteAsync方法(Byte[], Int32, Int32)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/hh137813(v=vs.110)"><u>Stream.ReadAsync方法(Byte[], Int32, Int32)(Sytem.IO)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155757(VS.110).aspx"><u>使用异步进行文件访问(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/kztecsys.aspx"><u>异步文件I/O</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155761(v=vs.110)"><u>微调你的异步应用程序(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155756(v=vs.110)"><u>启动多任务并处理他们，并直到多任务完成(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/hh873191(v=vs.110)"><u>控制异步程序的流程(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155759(v=vs.110)"><u>取消Task列表中的一个Task(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155760(v=vs.110)"><u>在一段时间之后取消Tasks(C#和Visual Basic)</u></a> <br/>
<a href="http://msdn.microsoft.com/en-us/library/jj155758(v=vs.110)"><u>当一个Task完成之后取消剩余的Tasks(C#和Visual Basic)</u></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/44/" itemprop="url">Windows Store App开发[017]编写和使用自己的Windows Runtime组件</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>今天通过一个非常简单的例子，我给大家介绍一下如何使用WinRT。在这里我用C++创建一个WinRT组件，然后通过C#工程来使用该组件</p>

<p>首先，启动Visual Studio 2012 RC，在这里我使用的系统版本是Windows 8 Rlease Preview。然后新建一个项目，打开Visual C++并选择“Windows RunTime Component”，而不是DLL(Metro style Apps)。输入工程名Calculator。如下图</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/13.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb3.jpg" width="682" height="480" /></a></p>

<p>&#160;</p>

<p>将头文件和cpp文件中的类名修改为Calculator，并在头文件中加入如下Add方法</p>

<pre class="wp-code-highlight prettyprint linenums:1">#pragma once

namespace Calculator
{
    public ref class CalculatorRT sealed
    {
    public:
        CalculatorRT();

        int Add(int i, int j)
        {
            return i+j;
        }
    };
}</pre>


<p>下面是修改类名后的cpp文件</p>

<pre class="wp-code-highlight prettyprint linenums:1">// Class1.cpp
#include &quot;pch.h&quot;
#include &quot;Class1.h&quot;

using namespace Calculator;
using namespace Platform;

CalculatorRT::CalculatorRT()
{
}</pre>


<p>到此，组件的代码就编写完毕了，但是先别编译该工程。</p>

<p>我们先在解决方案中添加一个C#工程，如下图所示</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/21.jpg"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb1.jpg" width="682" height="433" /></a></p>

<p>&#160;</p>

<p>然后右键单击引用，选择添加引用</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/3.jpg"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb.jpg" width="551" height="322" /></a></p>

<p>&#160;</p>

<p>然后在在项目中选择Calculator，记得要勾住左边的复选框，否则引用不会被添加到C#工程中。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/42.jpg"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb2.jpg" width="682" height="467" /></a></p>

<p>&#160;</p>

<p>接着在我们的C#工程中就可以使用该组件了。</p>

<p>我在App.xaml.cs文件中添加名称空间Calculator。如下图，当输入ca的时候会有相应的提示，选择Calculator即可。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/51.jpg"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb1.jpg" width="315" height="339" /></a> </p></p>

<p>&#160;</p>

<p>然后在App函数中添加如下代码，运行即可得知sum等于30</p>

<pre class="wp-code-highlight prettyprint linenums:1">public App()
{
    this.InitializeComponent();
    this.Suspending += OnSuspending;

    CalculatorRT calc = new CalculatorRT();

    int sum = calc.Add(10, 20);

}</pre>


<p>&#160;</p>

<p>好了，至此结束，上面的代码就是如何编写和使用自己的Windows Runtime组件，并且是如果通过C#代码重用C++写的代码。</p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/43/" itemprop="url">Windows Store App开发[016]如何获取设备当前位置</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><strong>在程序中如何获取设备当前位置</strong></p>

<p><strong>目录：</strong></p>

<p><strong>&#160;&#160;&#160; 1、位置能力声明</strong></p>

<p><strong>&#160;&#160;&#160; 2、单次位置访问</strong></p>

<p><strong>&#160;&#160;&#160; 3、持续位置访问</strong></p>

<p><strong><font color="#666666"></font></strong></p>

<hr />

<p><strong>1、位置能力声明</strong></p>

<p>&#160;&#160;&#160; 在程序中添加位置的支持是很容易和直接的事情。首先需要在程序的manifest文件中添加位置功能的声明。声明的作用是让系统知道这个应用程序可能会尝试方位当前的位置。当然，最终程序是否有权限访问当前位置是由用户控制的。可以通过Visual Studio添加这个声明（双击解决方案资源管理器中的Package.appxmanifest文件,单击功能tab,然后在列表中勾上位置复选框）</p>

<p>&#160;&#160;&#160; 下面是在manifest编辑器中声明位置功能之后的样子:</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/12.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb2.jpg" width="632" height="545" /></a></p>

<p>下面的代码片段是当声明了位置功能后，在打开Package.appxmanifest.xml文件中看到的内容：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;capabilities&gt;
  &lt;devicecapability name="location"&gt;
&lt;/devicecapability&gt;&lt;/capabilities&gt;</pre>


<p>只要在程序中声明了位置能力,那么就可以立马通过编写代码来访问位置数据。位置功能被构建在Windows Runtime APIs中了，可以通过名称空间Windows.Devices.Geolocation来访问，或者可以通过JavaScript使用W3C API提供的相关位置功能。关于使用W3C API 提供的位置功能的更多信息，请看：<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh452746.aspx"><u>使用HTML5检测位置（使用JavaScript和HTML开发Metro style Apps）</u></a></p>

<p>&#160;&#160;&#160; 这里有两种基本的方法可以访问位置数据:一次查询,或者当系统检测到位置的改变引发相应的事件流。我们来看看每一种访问模型,之后就可以决定在程序中使用哪种模型更好。</p>

<p>**</p>

<p>**</p>

<p><strong>2、单次位置访问</strong></p>

<p>&#160;&#160;&#160; 如果只是按需访问位置数据,例如在用户所在区域发现用户感兴趣的点,注释与位置信息相关的内容,在地图上显示用户的位置等。只需要少数的几行代码就能搞定了,并且还能够延长电池的寿命。下面来看看相关的代码：</p>

<p>JavaScript:</p>

<pre class="wp-code-highlight prettyprint linenums:1">var loc = new Windows.Devices.Geolocation.Geolocator();
loc.positionAccuracy = Windows.Devices.Geolocation.PositionAccuracy.high;
loc.getGeopositionAsync().done(getPositionHandler, errorHandler);

function getPositionHandler(pos) {
    var lat = pos.coordinate.latitude;
    var long = pos.coordinate.longitude;
    var acc = pos.coordinate.accuracy;
}

function errorHandler(err) {
    // handle error
}</pre>


<p><strong>C#:</strong></p>

<pre class="wp-code-highlight prettyprint linenums:1">using Windows.Devices.Geolocation;

var loc = new Geolocator();

try
{
    loc.DesiredAccuracy = PositionAccuracy.High;
    Geoposition pos = await loc.GetGeopositionAsync();

    var lat = pos.Coordinate.Latitude;
    var long = pos.Coordinate.Longitude;
    var acc = pos.Coordinate.Accuracy;
}
catch (System.UnauthorizedAccessException)
{
    // handle error
}</pre>


<p>通过上面的代码,我们可以看到获取单次位置信息,需要如下步骤:</p>

<h4>1、创建一个Geolocator对象(位置的根对象)</h4>

<p>2、异步调用一个操作来获取当前的位置,并且如果访问位置被拒绝了会有相关的错误处理</p>

<p>注意:</p>

<p>&#160;&#160;&#160; 如果需要，可以取消GetGeopositionAsync操作。这个例子有相关的演示：<a href="http://code.msdn.microsoft.com/windowsapps/Geolocation-2483de66">Windows Runtime Geolocation SDK 示例</a> ,关于单次位置访问信息,请查看<a href="http://msdn.microsoft.com/en-US/library/windows/apps/br225537">Geolocator.GetGeopositionAsync() | getGeopositionAsync() 方法</a>和Geolocation SDK示例.</p>

<p><strong>3、持续位置访问</strong></p>

<p>&#160;&#160;&#160; 如果你的程序需要持续访问位置数据,例如导航,当用户接近感兴趣的位置时提醒做出提醒,路线记录等.你想要添加一个事件监听器,以便当系统位置服务检测到位置改变时,程序会被通知.下面的代码是如何监听位置的改变:</p>

<p>JavaScript:</p>

<pre class="wp-code-highlight prettyprint linenums:1">var loc = new Windows.Devices.Geolocation.Geolocator();
loc.desiredAccuracy = Windows.Devices.Geolocation.PositionAccuracy.high;
loc.addEventListener(&quot;positionchanged&quot;, onPositionChanged);

function onPositionChanged(e) {
    var lat = e.position.coordinate.latitude;
    var long = e.position.coordinate.longitude;
    var acc = e.position.accuracy;
}</pre>


<p>C#:</p>

<pre class="wp-code-highlight prettyprint linenums:1">using Windows.Devices.Geolocation;

private Geolocator loc = new Geolocator();

private void StartTracking(object sender, RoutedEventArgs e)
{
    loc.DesiredAccuracy = PositionAccuracy.High;
    loc.PositionChanged += new TypedEventHandler&lt;geolocator, positionchangedeventargs=&quot;\\&quot;\\&quot;&quot;&gt;(OnPositionChanged);
}

private void OnPositionChanged(Geolocator sender, PositionChangedEventArgs e)
{
    Geoposition pos = e.Position;

    var lat = pos.Coordinate.Latitude;
    var long = pos.Coordinate.Longitude;
    var acc = pos.Coordinate.Accuracy;
}</pre>


<p>上面给出的代码,本质上与单次访问相同,只不过在单次访问中使用了异步操作,而在这里,我们添加了事件监听器,并传递一个代理以处理事件.现在每当检测到一个位置改变,代理就会被调用,通过该代理方法我们可以获得位置数据.如果你想设置移动事件的敏感度,可以通过设置Geolocator对象的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.devices.geolocation.geolocator.movementthreshold.aspx">MovementThreshold</a>属性.</p>

<p>&#160;&#160;&#160; 另外,可以通过设置Geolocator对象的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.devices.geolocation.geolocator.desiredaccuracy.aspx">DesiredAccuracy</a>属性,对位置API进行微调.如果程序不需要达到非常精确的GPS-level(例如天气程序),可以把该属性设置为Default，以通过限制使用GPS设备在确定位置来节省电量.</p>

<p>&#160;&#160;&#160; 更多关于添加位置提醒到程序中,请看<a href="http://code.msdn.microsoft.com/windowsapps/Geolocation-2483de66">Geolocation示例</a>，<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465148.aspx">位置提醒程序开发指南</a>和MSDN上的文档名称空间<a href="http://msdn.microsoft.com/en-us/library/windows/apps/br225603.aspx">Windows.Devices.Geolocation</a>。</p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/42/" itemprop="url">Windows Store App开发[015]添加应用设置(SettingsPane)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>今天我就带领大家学习一下设置合约(SettingsPane)的使用</p>

<p>另:之前有介绍过搜索合约,大家可以从下面的链接去学习</p>

<h3><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91012windows-8-%e4%b8%ad%e6%90%9c%e7%b4%a2%e5%90%88%e7%ba%a6%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[012]Windows 8 中搜索合约的使用</u></a></h3>

<p>首先来看看程序运行效果</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/11.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb1.jpg" width="682" height="420" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/2.jpg"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb.jpg" width="682" height="420" /></a></p>

<p>&#160;</p>

<p>本文章目录结构： <br/>
<strong>设置合约介绍</strong></p>

<p><strong>创建项目 <br/>
</strong><strong>定义设置弹出窗口XAML文件</strong></p>

<p><strong>定义设置弹出窗口.cs文件</strong></p>

<p><strong>弹出设置面板</strong></p>

<p><strong>主界面编写</strong></p>

<p><strong>编译运行+代码附件</strong></p>

<p>&#160;</p>

<p><strong>设置合约介绍</strong></p>

<p>概述</p>

<p>“设置”超级按钮为所有与用户的当前上下文相关的设置提供一个访问点。“设置”超级按钮始终可用。不管上下文如何，设置包括始终可用的系统设置、让用户可以控制应用对系统设备和功能的访问的系统代理的设置，以及当前应用指定的设置。本主题介绍如何使用“设置”合约向“设置”超级按钮中添加应用设置。</p>

<h5><a></a><a></a>用户体验</h5>

<p>从屏幕的一个边缘轻扫可显示多个超级按钮。按“设置”超级按钮可显示设置窗口。设置窗口中既包括应用设置又包括系统设置。</p>

<p>应用中可以提供 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/windows.ui.applicationsettings.settingscommand.aspx"><strong>SettingsCommand</strong></a> 入口点，这些入口点显示在设置窗口的顶部。“权限”<strong><strong>和“评论和打分”</strong></strong>这两个入口点由系统提供。设置窗口的底部包括由系统提供的电脑设置，如音量、亮度和电源。</p>

<p><strong>注意</strong>&#160; 只有通过 Windows 应用商店安装的应用才有“评论和打分”****入口点。侧向加载的企业应用没有这个入口点。</p>

<p>入口点会打开设置弹出窗口，弹出窗口中包含应用的设置、帮助、“关于”信息以及任何不经常由用户访问的次要命令或信息。一个应用中可以有多个设置入口点，每个设置弹出窗口都可以有多个选项。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/38.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb8.png" width="682" height="385" /></a></p>

<p align="center">
  SkyDrive 应用的设置弹出窗口
</p>


<h5>用户体验指南</h5>

<h6><a></a><a></a>一般原则</h6>

<ul>
<li>“设置”超级按钮是保存应用的所有设置的一个地方。 使用“设置”超级按钮作为你的应用设置的单个入口点。</li>
<li>你可以编程方式链接到顶部的“设置”超级按钮体验，或者你可以在必要时深层链接到你的设置体验，例如在应用商店中购买应用需要链接到应用设置以更新信用卡信息。</li>
<li>设置越少越好。定义智能默认值，并尽可能减少设置数。</li>
<li>可以调用和解除“设置”超级按钮，无需用户切换上下文。确保你从“设置”超级按钮显示的设置 UI 遵循相同的原则。当用户与控件交互时，立即提供适用的设置。为你的 UI 使用弱解除界面，以便用户可以通过在界面外触摸或通过从应用中移动焦点来解除。</li>
</ul>


<h6><a></a><a></a>选择在应用设置中访问哪些应用功能</h6>

<ul>
<li>提供对影响应用的整体行为而且不经常调整的配置选项的访问，例如，在天气应用中在摄氏度和华氏度之间选择默认的温度单位，或者更改邮件应用的帐户设置。</li>
<li>使用“设置”超级按钮可以提供对不经常需要的应用信息（如隐私声明、帮助、应用版本或版权信息）的访问。</li>
<li>不要包括属于典型应用工作流的功能（例如，在艺术应用中更改画笔颜色）。这些功能位于应用栏或画布上。有关详细信息，请参阅<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh465302.aspx">应用栏指南和清单</a>。</li>
</ul>


<h6><a></a><a></a>向设置窗口中添加应用设置的入口点。</h6>

<ul>
<li>将相似或相关的设置一起组合到每个入口点下面。避免添加四个以上的入口点。</li>
<li>将不太常用的设置组合到一个入口点中，以便每个更常见的设置都有其各自的入口点。</li>
<li>无论应用的上下文如何，都呈现相同的入口点。如果某些设置与某个上下文不相关，请在应用设置的弹出窗口中处理这些设置，而不是通过更改设置窗口中显示的入口点。</li>
<li>入口点应打开一个设置弹出窗口。如果直接进入 Web，请在进入 Web 的标签后添加“（联机）”，例如“帮助（联机）”。另外，你可以在入口点字符串中使用“Web”或“联机”，例如“Web 论坛”。</li>
<li>通过使用一个设置弹出窗口对指向详细信息的链接进行分组，最大程度地减少链接到 Web 的入口点数。例如，如果你需要提供“关于”、使用条款、隐私声明和支持信息链接，请将它们放在“关于”入口点下的一个通用设置弹出窗口中，而不是为每个设置都提供一个入口点。</li>
<li>所有应用自动在顶层获得“权限”入口。权限窗格是系统控制的界面，应用无法更改。在此窗格中将为需要用户同意的每个系统功能显示一个切换开关。不要在用户所有的设置 UI 中复制此信息。</li>
<li>在你命名入口点时尽可能具有描述性。名称应反映在选择入口点时要呈现给用户的信息或设置。例如，如果设置与帐户相关，则调用入口“帐户”。避免重复使用术语“设置”或使用同义词。而是改用设置的限定符，如“默认设置”。当只有一个设置入口点涵盖多个类别，并且一个通用类别不可避免时，请使用“选项”。尽可能为你的入口点使用一个词的标签。</li>
</ul>


<h6><a></a><a></a>定义设置 UI</h6>

<ul>
<li>从设置窗口中指定的所有设置入口点，使用设置弹出窗口启动一致的 UI 图面。</li>
<li>使用覆盖应用内容的弱解除界面，当用户触摸应用时、当应用取消激活时（例如，当打开超级按钮时）以及当用户贴靠应用时可解除该界面。这让用户可以快速更改设置并返回到应用中。</li>
<li>将你的设置弹出窗口置于和超级按钮相同的屏幕一侧，以便形成完整的 UI 流。请注意，如果系统的文本方向是从右到左，则超级按钮和设置窗口可能会在屏幕的左侧。使用 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/windows.ui.applicationsettings.settingsedgelocation.aspx"><strong>SettingsEdgeLocation</strong></a> 属性来确定设置超级按钮显示屏幕的哪一侧。</li>
<li><a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh701253.aspx"><strong>SettingsFlyout</strong></a> 控件实现了本部分中的所有 UI 要求。</li>
</ul>


<h6><a></a><a></a>向设置弹出窗口中添加设置</h6>

<ul>
<li>旨在实现简化。

<ul>
<li>为你的功能提供经过深思熟虑的默认设置并尽可能少地添加设置。</li>
<li>避免设置层次结构大于两层。</li>
<li>在单列中按照从上到下的顺序显示内容，必要时使内容可滚动，但要将最大滚动长度限制在屏幕高度的两倍。</li>
</ul>
</li>
<li>当用户更改设置时，你的应用应当立即反映所做的更改。用户一停止与特定设置控件交互，将立即应用新设置值。建议所有光取消图面都采用此值。如果你的应用在设置弹出窗口关闭时没有向设置存储应用新值，则新值可能会丢失，这是由于设置弹出窗口不应当有提交按钮。处理 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/br211723.aspx"><strong>beforeshow</strong></a> 和 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/br211720.aspx"><strong>afterhide</strong></a> 事件以执行控件初始化和状态序列化。</li>
<li>使用其他层次的 UI 或展开/折叠模型重复 UI 中列出的多个对象下提供的设置。例如，提供每个城市设置的天气应用提供可以在第一个设置级别配置的城市列表，并允许用户点击城市来访问下一个级别，从而配置其中的选项。支持多个帐户的邮件应用应当显示帐户列表，而且应当允许用户通过点击帐户来打开相应的二级设置 UI。</li>
<li>如果加载控件或 Web 内容需要时间，请使用不确定进度控件。有关详细信息，请参阅<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh465469.aspx">进度控件指南和清单</a>。</li>
<li>你经常需要将用户发送到 Web 以获取更多设置或信息。以你对待应用中链接的相同方式对待打开 Web 浏览器的链接，或者提醒用户他们将进入 Web。不要为浏览器导航事件使用按钮。</li>
<li>为相同类型的设置统一使用控件。 如果禁用其中一个控件，则添加描述性消息。将此消息置于禁用的控件上。</li>
<li><p>下面列出了你可以用于设置的控件：</p>

<ul>
<li>切换开关：使用切换开关可让用户将值设置为打开或关闭。</li>
<li>按钮：使用按钮可让用户立即启动操作，不会消除当前的设置 UI。</li>
<li>超链接：当操作将用户带到其他 UI 界面并消除当前的设置 UI 时，使用超链接。</li>
<li>文本输入框：使用输入框可让用户输入文本。使用与要从用户那里捕获的文本类型（如电子邮件或密码）相对应的文本输入框类型。</li>
<li>单选按钮组：使用单选按钮组可让用户从多达 5 个互相排斥的一组相关选项中选择一个选项。</li>
<li>选择控件：使用选择控件可让用户从一组 6 个或更多个仅文本项中选择一项。</li>
</ul>
</li>
</ul>


<h6><a></a><a></a>创建设置弹出窗口</h6>

<p>对于使用 JavaScript 的 Metro 风格应用，请使用 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh701253.aspx"><strong>SettingsFlyout</strong></a> 控件，该控件实现此部分中的所有 UI 要求，并支持预定义的 CSS 类以实现推荐的样式。</p>

<p>对于使用 C++、C# 或 Visual Basic 的 Metro 风格应用，你必须创建自定义设置 UI。使用以下指南可确保你的 UI 与 UX 设计要求一致。有关详细信息，请参阅<a href="http://go.microsoft.com/fwlink/?linkid=226738">应用程序设置示例</a>。</p>

<ul>
<li>不管方向如何，设置弹出窗口都必须采用全屏高度，并且应该采用窄（346 像素）或宽（646 像素）格式。</li>
<li>设置弹出窗口应当有一个标头，其中包括一个后退按钮、用来打开该弹出窗口的入口点的名称以及应用的图标。该标头的背景颜色和边框颜色应反映清单中指定的应用程序颜色。</li>
<li>使用 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/br230467.aspx"><strong>showPanel</strong></a> 和 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/br212677.aspx"><strong>hidePanel</strong></a> 动画，以便设置弹出窗口从屏幕上距离它们最近的一侧滑入并从同一侧滑出。</li>
<li>在为设置弹出窗口（包括标头）设置动画后，包括作为单个块进行动画处理的设置内容和控件。使用左偏移 100px 的<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/windows.ui.xaml.media.animation.entrancethemetransition.aspx"><strong>EntranceThemeTransition</strong></a> 动画为内容设置动画。</li>
</ul>


<h5><a></a><a></a>设置弹出窗口的样式设置</h5>

<ul>
<li>设置弹出窗口应该采用窄 (346px) 或宽 (646px) 格式。选择适用于内容的大小。不要创建自定义大小。在同一个应用中使用这两个大小都可以。</li>
<li>标头的背景颜色应该与应用的颜色相同，即应用的“开始”磁贴的背景颜色。</li>
<li>边框颜色应采用相同的颜色，但是应该暗 20%。 通过获取每个组件 80% 的 RGB 值来找到此颜色。</li>
<li>在白色背景上显示设置内容。</li>
<li>使用章节标头、段落和标签，以便它们帮助划分和明确层次结构。这些元素在设置弹出窗口中是可选元素。</li>
<li>为控件使用简单的说明标签。</li>
</ul>


<h5><a></a><a></a>不适当的使用设置</h5>

<ul>
<li>不要向设置区域中添加与公用应用工作流相关联的任何命令。这些命令应放在<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh465296.aspx">应用栏</a>或应用画布上。</li>
<li>不要使用设置窗口中的入口点在不启动另一个 UI 图面的情况下直接执行操作。</li>
<li>不要使用设置窗口导航到应用的另一个部分。当设置窗口关闭时，用户在应用中的位置应当与他们输入设置时的位置相同。<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh465296.aspx">应用栏</a>之类的控件是更适合的导航位置。有关详细信息，请参阅<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh767282.aspx">定义布局、导航和命令</a>。</li>
<li>不要使用 <a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/xaml/hh701253.aspx"><strong>SettingsFlyout</strong></a> 类作为通用控件。该类仅适用于从“设置”超级按钮启动的设置 UI。</li>
</ul>


<p>&#160;</p>

<p><strong>创建项目</strong></p>

<ul>
<li>打开 Microsoft Visual Studio 2012。在“文件”菜单上，选择“新建项目”。将出现“新建项目”对话框。</li>
<li>在“模板”窗格中，打开“Visual C#”，然后单击“Windows Metro 风格”。</li>
<li>在中心窗格中，选择“空白应用程序”。</li>
<li>在“名称”文本框中，键入“DevDiv_SettingPaneDemo”。</li>
<li>单击“确定”。即会创建 DevDiv_SettingPaneDemo工程。</li>
</ul>


<p><strong>定义设置弹出窗口XAML文件</strong> <br/>
按快捷键Ctrl+Shift+A弹出添加新项窗口,如下图,根据下图提示,创建一个名称为SimpleSettingsNarrow的用户控件(UserControl)</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/41.jpg"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb1.jpg" width="682" height="433" /></a></p>

<p>打开SimpleSettingsNarrow.xaml文件，用下面的内容进行替换之</p></p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;usercontrol xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:DevDiv_SettingPaneDemo" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="DevDiv_SettingPaneDemo.SimpleSettingsNarrow" mc:ignorable="d" d:designheight="768" d:designwidth="346"&gt;
    &lt;usercontrol.resources&gt;
        &lt;style x:key="SettingsBackButtonStyle" targettype="Button"&gt;
            &lt;setter property="MinWidth" value="0"/&gt;
            &lt;setter property="FontFamily" value="Segoe UI Symbol"/&gt;
            &lt;setter property="FontWeight" value="Normal"/&gt;
            &lt;setter property="FontSize" value="26.66667"/&gt;
            &lt;setter property="AutomationProperties.AutomationId" value="BackButton"/&gt;
            &lt;setter property="AutomationProperties.Name" value="Back"/&gt;
            &lt;setter property="AutomationProperties.ItemType" value="Navigation Button"/&gt;
            &lt;setter property="Template"&gt;
                &lt;setter.value&gt;
                    &lt;controltemplate targettype="Button"&gt;
                        &lt;grid x:name="RootGrid" width="30" height="30"&gt;
                            &lt;grid margin="-6,-6,0,0"&gt;
                                &lt;textblock x:name="BackgroundGlyph" text=""/&gt;
                                &lt;textblock x:name="NormalGlyph" text="{StaticResource BackButtonSnappedGlyph}"/&gt;
                                &lt;textblock x:name="ArrowGlyph" text="" opacity="0"/&gt;
                            &lt;/grid&gt;
                            &lt;rectangle
                            x:name="FocusVisualWhite"
                            ishittestvisible="False"
                            strokeendlinecap="Square"
                            strokedasharray="1,1"
                            opacity="0"
                            strokedashoffset="1.5"/&gt;
                            &lt;rectangle
                            x:name="FocusVisualBlack"
                            ishittestvisible="False"
                            strokeendlinecap="Square"
                            strokedasharray="1,1"
                            opacity="0"
                            strokedashoffset="0.5"/&gt;

                            &lt;visualstatemanager.visualstategroups&gt;
                                &lt;visualstategroup x:name="CommonStates"&gt;
                                    &lt;visualstate x:name="Normal" /&gt;
                                    &lt;visualstate x:name="PointerOver"&gt;
                                        &lt;storyboard&gt;
                                            &lt;objectanimationusingkeyframes storyboard.targetname="BackgroundGlyph" storyboard.targetproperty="Foreground"&gt;
                                                &lt;discreteobjectkeyframe keytime="0" /&gt;
                                            &lt;/objectanimationusingkeyframes&gt;
                                            &lt;objectanimationusingkeyframes storyboard.targetname="NormalGlyph" storyboard.targetproperty="Foreground"&gt;
                                                &lt;discreteobjectkeyframe keytime="0" /&gt;
                                            &lt;/objectanimationusingkeyframes&gt;
                                        &lt;/storyboard&gt;
                                    &lt;/visualstate&gt;
                                    &lt;visualstate x:name="Pressed"&gt;
                                        &lt;storyboard&gt;
                                            &lt;objectanimationusingkeyframes storyboard.targetname="BackgroundGlyph" storyboard.targetproperty="Foreground"&gt;
                                                &lt;discreteobjectkeyframe keytime="0"/&gt;
                                            &lt;/objectanimationusingkeyframes&gt;
                                            &lt;doubleanimation
                                            storyboard.targetname="ArrowGlyph"
                                            storyboard.targetproperty="Opacity"
                                            to="1"
                                            duration="0"/&gt;
                                            &lt;doubleanimation
                                            storyboard.targetname="NormalGlyph"
                                            storyboard.targetproperty="Opacity"
                                            to="0"
                                            duration="0"/&gt;
                                        &lt;/storyboard&gt;
                                    &lt;/visualstate&gt;
                                    &lt;visualstate x:name="Disabled"&gt;
                                        &lt;storyboard&gt;
                                            &lt;objectanimationusingkeyframes storyboard.targetname="RootGrid" storyboard.targetproperty="Visibility"&gt;
                                                &lt;discreteobjectkeyframe keytime="0" value="Collapsed"/&gt;
                                            &lt;/objectanimationusingkeyframes&gt;
                                        &lt;/storyboard&gt;
                                    &lt;/visualstate&gt;
                                &lt;/visualstategroup&gt;
                                &lt;visualstategroup x:name="FocusStates"&gt;
                                    &lt;visualstate x:name="Focused"&gt;
                                        &lt;storyboard&gt;
                                            &lt;doubleanimation
                                            storyboard.targetname="FocusVisualWhite"
                                            storyboard.targetproperty="Opacity"
                                            to="1"
                                            duration="0"/&gt;
                                            &lt;doubleanimation
                                            storyboard.targetname="FocusVisualBlack"
                                            storyboard.targetproperty="Opacity"
                                            to="1"
                                            duration="0"/&gt;
                                        &lt;/storyboard&gt;
                                    &lt;/visualstate&gt;
                                    &lt;visualstate x:name="Unfocused" /&gt;
                                    &lt;visualstate x:name="PointerFocused" /&gt;
                                &lt;/visualstategroup&gt;
                            &lt;/visualstatemanager.visualstategroups&gt;
                        &lt;/grid&gt;
                    &lt;/controltemplate&gt;
                &lt;/setter.value&gt;
            &lt;/setter&gt;
        &lt;/style&gt;
    &lt;/usercontrol.resources&gt;
    &lt;border borderbrush="Black" borderthickness="1,0,0,0"&gt;
        &lt;grid background="#FFD41111" verticalalignment="Stretch"&gt;
            &lt;!-- Root grid definition --&gt;
            &lt;grid.rowdefinitions&gt;
                &lt;rowdefinition height="80"&gt;&lt;/rowdefinition&gt;
                &lt;rowdefinition height="*"&gt;&lt;/rowdefinition&gt;
            &lt;/grid.rowdefinitions&gt;
            &lt;!-- Header area for panel --&gt;
            &lt;grid background="Orange" grid.row="0"&gt;

                &lt;grid margin="40,32,17,13"&gt;

                    &lt;grid.transitions&gt;
                        &lt;transitioncollection&gt;
                            &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                        &lt;/transitioncollection&gt;
                    &lt;/grid.transitions&gt;

                    &lt;grid.columndefinitions&gt;
                        &lt;columndefinition width="30"&gt;&lt;/columndefinition&gt;
                        &lt;columndefinition width="*"&gt;&lt;/columndefinition&gt;
                        &lt;columndefinition&gt;&lt;/columndefinition&gt;
                    &lt;/grid.columndefinitions&gt;

                    &lt;button margin="-21,-13,0,0" width="51" click="MySettingsBackClicked" grid.column="0" horizontalalignment="Left"&gt;
                    &lt;textblock margin="75,-3,0,3" grid.column="1" horizontalalignment="Left" fontfamily="Segoe UI" fontweight="SemiLight" fontsize="24.6667" text="登录"&gt;&lt;/textblock&gt;
                    &lt;img margin="0,-3,34,3" grid.column="2" horizontalalignment="Right" source="Assets/qq.png" /&gt;
                &lt;/grid&gt;
            &lt;/grid&gt;
            &lt;button content="登录" verticalalignment="Top" grid.row="1" margin="84,212,0,0" width="170" horizontalalignment="Left"&gt;
                &lt;button.transitions&gt;
                        &lt;transitioncollection&gt;
                            &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                        &lt;/transitioncollection&gt;
                    &lt;/button.transitions&gt;
                &lt;/button&gt;
            &lt;textblock verticalalignment="Top" height="20" grid.row="1" margin="64,110,0,0" width="45" horizontalalignment="Left" fontsize="20" text="账号" textwrapping="Wrap"&gt;
                &lt;textblock.transitions&gt;
                        &lt;transitioncollection&gt;
                            &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                        &lt;/transitioncollection&gt;
                &lt;/textblock.transitions&gt;
            &lt;/textblock&gt;
            &lt;textblock verticalalignment="Top" grid.row="1" margin="64,155,0,0" horizontalalignment="Left" fontsize="20" text="密码" textwrapping="Wrap"&gt;
                &lt;textblock.transitions&gt;
                    &lt;transitioncollection&gt;
                        &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                    &lt;/transitioncollection&gt;
                &lt;/textblock.transitions&gt;  
            &lt;/textblock&gt;
            &lt;textbox verticalalignment="Top" height="20" grid.row="1" margin="121,106,0,0" width="170" horizontalalignment="Left" textwrapping="Wrap"&gt;
                &lt;textbox.transitions&gt;
                    &lt;transitioncollection&gt;
                        &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                    &lt;/transitioncollection&gt;
                &lt;/textbox.transitions&gt;
            &lt;/textbox&gt;
            &lt;passwordbox verticalalignment="Top" height="24" grid.row="1" margin="121,150,0,0" width="170" horizontalalignment="Left"&gt;
                &lt;passwordbox.transitions&gt;
                    &lt;transitioncollection&gt;
                        &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                    &lt;/transitioncollection&gt;
                &lt;/passwordbox.transitions&gt;
            &lt;/passwordbox&gt;
            &lt;grid background="#FF81B930" verticalalignment="Top" height="78" grid.row="1" margin="0,610,0,0" width="345" horizontalalignment="Left"&gt;
                &lt;grid.transitions&gt;
                    &lt;transitioncollection&gt;
                        &lt;entrancethemetransition fromhorizontaloffset="50"&gt;&lt;/entrancethemetransition&gt;
                    &lt;/transitioncollection&gt;
                &lt;/grid.transitions&gt;
                &lt;textblock verticalalignment="Top" height="68" margin="10,5,0,0" width="294" horizontalalignment="Left" textwrapping="Wrap"&gt;
                            &lt;run fontsize="20" text="Powered by "&gt;&lt;/run&gt;
                            &lt;linebreak&gt;&lt;/linebreak&gt;
                            &lt;run fontsize="20" text="BeyondVincent(破船)@DevDiv"&gt;&lt;/run&gt;
                            &lt;linebreak&gt;&lt;/linebreak&gt;
                            &lt;run fontsize="20" text="2012年9月5日"&gt;&lt;/run&gt;
                            &lt;linebreak&gt;&lt;/linebreak&gt;
                            &lt;run text=""&gt;&lt;/run&gt;
                &lt;/textblock&gt;
            &lt;/grid&gt;
        &lt;/grid&gt;
    &lt;/border&gt;
&lt;/usercontrol&gt;</pre>


<p>效果图如下</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/5.jpg"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb.jpg" width="238" height="471" /></a></p>

<p><strong>弹出设置面板定义设置弹出窗口cs文件</strong></p>

<p>将如下代码添加到SimpleSettingsNarrow.xaml.cs文件下面代码的主要作用是当本控件隐藏时,弹出设置面板</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.ApplicationSettings;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;

namespace DevDiv_SettingPaneDemo
{
    public sealed partial class SimpleSettingsNarrow : UserControl
    {
        public SimpleSettingsNarrow()
        {
            this.InitializeComponent();
        }

        private void MySettingsBackClicked(object sender, RoutedEventArgs e)
        {
            if (this.Parent.GetType() == typeof(Popup))
            {
                ((Popup)this.Parent).IsOpen = false;
            }
            SettingsPane.Show();
        }
    }
}</pre>


<p><strong>弹出设置面板</strong></p>

<p>将下面代码添加到MainPage.xaml.cs</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;
using Windows.UI.ApplicationSettings;

// The Blank Page item template is documented at &lt;a href="\" target="\" _blank\?? ?LinkId=&#039;234238\""&#039; fwlink go.microsoft.com http:&gt;http://go.microsoft.com/fwlink/?LinkId=234238&lt;/a&gt;

namespace DevDiv_SettingPaneDemo
{
    /// &lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;summary&gt;
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class MainPage : Page
    {
        Rect _windowBounds;
        double _settingsWidth = 346;
        Popup _settingsPopup;

        public MainPage()
        {
            this.InitializeComponent();

            _windowBounds = Window.Current.Bounds;

            Window.Current.SizeChanged += OnWindowSizeChanged;

            SettingsPane.GetForCurrentView().CommandsRequested += BlankPage_CommandsRequested;
        }

        void OnWindowSizeChanged(object sender, Windows.UI.Core.WindowSizeChangedEventArgs e)
        {
            _windowBounds = Window.Current.Bounds;
        }

        void BlankPage_CommandsRequested(SettingsPane sender, SettingsPaneCommandsRequestedEventArgs args)
        {
            SettingsCommand cmd = new SettingsCommand(&quot;login&quot;, &quot;登录&quot;, (x) =&gt;
            {
                _settingsPopup = new Popup();
                _settingsPopup.Closed += OnPopupClosed;
                Window.Current.Activated += OnWindowActivated;
                _settingsPopup.IsLightDismissEnabled = true;
                _settingsPopup.Width = _settingsWidth;
                _settingsPopup.Height = _windowBounds.Height;

                SimpleSettingsNarrow mypane = new SimpleSettingsNarrow();
                mypane.Width = _settingsWidth;
                mypane.Height = _windowBounds.Height;

                _settingsPopup.Child = mypane;
                _settingsPopup.SetValue(Canvas.LeftProperty, _windowBounds.Width - _settingsWidth);
                _settingsPopup.SetValue(Canvas.TopProperty, 0);
                _settingsPopup.IsOpen = true;
            });

            args.Request.ApplicationCommands.Add(cmd);

            SettingsCommand cmd1 = new SettingsCommand(&quot;logout&quot;, &quot;注销&quot;, (x) =&gt;
            {
            });

            args.Request.ApplicationCommands.Add(cmd1);
        }

        private void OnWindowActivated(object sender, Windows.UI.Core.WindowActivatedEventArgs e)
        {
            if (e.WindowActivationState == Windows.UI.Core.CoreWindowActivationState.Deactivated)
            {
                _settingsPopup.IsOpen = false;
            }
        }

        void OnPopupClosed(object sender, object e)
        {
            Window.Current.Activated -= OnWindowActivated;
        }

        /// &lt;summary&gt;
        /// Invoked when this page is about to be displayed in a Frame.
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;Event data that describes how this page was reached.  The Parameter
        /// property is typically used to configure the page.&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }

        private void Button_Click_1(object sender, RoutedEventArgs e)
        {
            SettingsPane.Show();
        }

        private void HandleSizeChange(object sender, RoutedEventArgs e)
        {
            RadioButton rb = sender as RadioButton;
            _settingsWidth = Convert.ToInt32(rb.Content);
        }
    }
}</pre>


<p><strong>主界面编写</strong></p>

<p>将下面代码添加到MainPage.xaml中</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:DevDiv_SettingPaneDemo" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="DevDiv_SettingPaneDemo.MainPage" mc:ignorable="d"&gt;

    &lt;grid background="BurlyWood"&gt;
        &lt;stackpanel margin="50,50,0,0"&gt;
            &lt;textblock margin="206,0,-206,0" fontsize="40" text="选择设置面板宽度" foreground="Red"&gt;&lt;/textblock&gt;
            &lt;radiobutton content="346" background="Blue" height="70" margin="206,0,690,0" fontsize="30" groupname="SettingsWidth" ischecked="True" checked="HandleSizeChange"&gt;&lt;/radiobutton&gt;
            &lt;radiobutton content="646" background="Red" height="65" margin="206,0,690,0" fontsize="30" groupname="SettingsWidth" checked="HandleSizeChange"&gt;&lt;/radiobutton&gt;
            &lt;button content="显示设置面板" background="DarkGreen" height="340" margin="206,0,0,0" width="420" click="Button_Click_1" fontsize="60"&gt;
        &lt;/stackpanel&gt;
    &lt;/grid&gt;
&lt;/page&gt;
&lt;pre&gt;</pre>


<p></p></p>

<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>


<p></button></p>

<p>效果如下</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/6.jpg"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb.jpg" width="682" height="420" /></a></p>

<p><strong>编译运行+代码附件</strong></p>

<p>下面来运行起来看看效果如何</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/7.jpg"><img title="7" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb.jpg" width="682" height="420" /></a></p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/71.jpg"><img title="7" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb1.jpg" width="682" height="420" /></a> <a href="http://beyondvincent.com/wp-content/uploads/2013/06/8.jpg"><img title="8" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="8" src="http://beyondvincent.com/wp-content/uploads/2013/06/8_thumb.jpg" width="682" height="420" /></a> <a href="http://beyondvincent.com/wp-content/uploads/2013/06/9.jpg"><img title="9" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="9" src="http://beyondvincent.com/wp-content/uploads/2013/06/9_thumb.jpg" width="682" height="420" /></a></p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SettingPane" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/41/" itemprop="url">Windows Store App开发[014]Step by Step已矣</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>引子：</p>

<p>&#160;&#160;&#160;&#160;&#160; 最近在看村上春树的小说，书中有提到“任何一把剃刀都自有其哲学！”这是萨摩赛特.毛姆说过的一句话，意思大概是：无论何等微不足道的举动，只要日日坚持，从中总会产生出某些类似观念的东西来。能坚持做一件事，开始或许可以靠冲动或自律，时间长了能坚持下去肯定是从中找到了乐趣。</p>

<p>与大家共勉一下</p>

<p>BeyondVincent(破船)@2012.8.9</p>

<p>Windows 8 Metro App开发Step by Step到今天基本告一段落了，我们来回顾一下本系列涉及到的内容，算作Step by Step的一个收场吧。在以后的日子里，我也会与大家一起分享Windows 8 Metro App开发。</p>

<p>细心的读者，或许已经发现，本次Step by Step总结起来实际上分为5部分</p>

<p><strong>1、Windows 8 Metro App开发入门</strong></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91001%e5%b9%b3%e5%8f%b0%e7%ae%80%e4%bb%8b/"></a></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91001%e5%b9%b3%e5%8f%b0%e7%ae%80%e4%bb%8b/"><u>Windows Store App开发[001]平台简介</u></a></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91002%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba%e4%b8%8ehelloworld/"><u>Windows Store App开发[002]开发环境搭建与HelloWorld</u></a></p>

<p>&#160;</p>

<p><strong>2、基本控件AppBar, Flyout与NavBar的使用</strong></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91003%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e6%a0%8fappbar%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[003]应用程序栏(AppBar)的使用</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/01/windows-store-app%e5%bc%80%e5%8f%91004%e5%bc%b9%e5%87%ba%e7%94%bb%e9%9d%a2flayouts/"><u>Windows Store App开发[004]弹出画面(Flayouts)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91005%e5%af%bc%e8%88%aa%e6%a0%8fappbar%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[005]导航栏(AppBar)的使用</u></a></p>

<p>&#160;</p>

<p><strong>3、数据绑定</strong></p>

<p><u>Windows Store App开发[007]视图模型与数据绑定</u></p>

<p>&#160;</p>

<p><strong>4、Layouts and Tiles布局与磁贴</strong></p>

<h4><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91008%e5%a4%84%e7%90%86fullscreen-snapped%e5%92%8cfilled%e7%8a%b6%e6%80%81/"></a></h4>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91008%e5%a4%84%e7%90%86fullscreen-snapped%e5%92%8cfilled%e7%8a%b6%e6%80%81/"><u>Windows Store App开发[008]处理Fullscreen, Snapped和Filled状态</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91009%e9%80%9a%e7%9f%a5%e6%a6%82%e8%bf%b0toasttile%e5%92%8cbadge/"><u>Windows Store App开发[009]通知概述(Toast,Tile和Badge)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91010%e9%80%9a%e7%9f%a5%e4%bd%bf%e7%94%a8toasttile%e5%92%8cbadge/"><u>Windows Store App开发[010]通知使用(Toast,Tile和Badge)</u></a></p>

<p>&#160;</p>

<p><strong>5、应用程序生命周期与合约</strong></p>

<h4><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91011%e6%b5%85%e8%b0%88windows-8-%e4%b8%ad%e7%9a%84%e5%90%88%e7%ba%a6contracts/"></a></h4>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91011%e6%b5%85%e8%b0%88windows-8-%e4%b8%ad%e7%9a%84%e5%90%88%e7%ba%a6contracts/"><u>Windows Store App开发[011]浅谈Windows 8 中的合约(contracts)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91012windows-8-%e4%b8%ad%e6%90%9c%e7%b4%a2%e5%90%88%e7%ba%a6%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[012]Windows 8 中搜索合约的使用</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/03/windows-store-app%e5%bc%80%e5%8f%91013%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f/"><u>Windows Store App开发[013]应用程序生命周期</u></a></p>

<p>&#160;</p>

<p>最后上一个图，祝大家Happy Coding，顺结束这次Windows 8 Metro App开发之旅吧</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/1.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb.jpg" width="682" height="427" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/40/" itemprop="url">Windows Store App开发[013]应用程序生命周期</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>引子：</p>

<p>&#160;&#160;&#160;&#160;&#160; 在本系列学习文章刚开始的帖子<a href="http://www.devdiv.com/_DevDiv%E5%8E%9F%E5%88%9B_Windows_8_Metro_App%E5%BC%80%E5%8F%91_2_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8EHelloWorld-thread-130651-1-1.html">开发环境搭建与HelloWorld</a>中，我曾给大家简单的介绍了一下应用程序生命周期（应用程序的生命周期主要就是通过App.xaml.cs文件进行处理），但没有展开详细的介绍，随着学习的深入，开发的需求和增强用户体验，我们有必要熟悉应用程序的生命周期。</p>

<p>&#160;&#160;&#160; 我查阅了一下网络上的可用资源，有一些相关生命周期的资料，但是内容都出自微软的官方博客，由于官方博文中对此进行了详细的讲解，不仅有英文，中文的也有，非常值得我们学习。在此我就直接引用过来，供大家学习参考。在文章的最后，我会贴上一些有用链接。</p>

<p>本文章目录结构： <br/>
<strong>Metro 风格应用程序的生命周期</strong> <br/>
<strong>打造出色应用程序生存期体验的提示</strong> <br/>
<strong>结束语</strong></p>

<p>&#160;</p>

<p>&#160;</p>

<p><strong>管理应用程序生命周期，让应用程序始终充满“生命活力”</strong> <br/>
Windows 8 中的应用程序生命周期模型意味着用户无需再管理哪些应用程序正在运行。它还使开发人员能够轻松打造当应用程序在后台运行时不会影响设备的电池电量或性能的出色用户体验。使用新的生命周期事件，用户将感觉您的应用程序始终处于运行状态，即使它在位于屏幕之外时从不运行。 <br/>
如今，便携式计算机、平板电脑和手机上的电池电量经常不足，因为即使我们不使用应用程序，往往也会保持应用程序处于运行状态。我们这样做主要是为了方便使用和在应用程序之间实现快速切换。 <br/>
为 Windows 8 中的 Metro 风格应用程序开发生命周期模型时我们牢记以下几个方面：保持应用程序响应能力、节省电池电量并提供出色且一致的性能。Metro 风格应用程序关键在于全屏沉浸式体验。因此，Windows 8 中新的生命周期模型重点关注前台应用程序，确保积极主动的用户体验并充分实现设备的全部价值。在本博文中，我将带您浏览生命周期模型的新状态以及为了使应用程序出色运行您需要做的工作。 <br/>
<strong>Metro 风格应用程序的生命周期</strong> <br/>
在任意给定时间，您的 Metro 风格应用程序都处于以下四种生命周期状态之一：<strong>未运行</strong>、<strong>正在运行</strong>、<strong>已挂起</strong>或<strong>已终止</strong>。当应用程序在不同状态之间切换时，它会收到生命周期事件，这些事件可帮助您向用户提供一致且高性能的体验。 <br/>
下图显示了 Metro 风格应用程序如何在各状态之间切换：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/17.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb7.png" width="682" height="391" /></a></p>

<p>当用户启动 Metro 风格应用程序、在应用程序之间切换以及关闭应用程序时，所有这些应用程序都会经历这些状态。当用户在应用程序之间切换时，应用程序很可能频繁在<strong>正在运行</strong>和<strong>已挂起</strong>状态之间切换。因此，应用程序必须处理生命周期事件。 <br/>
当您的应用程序在各个生命周期状态之间切换时，它会收到以下生命周期事件：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://beyondvincent.com/wp-content/uploads/2013/06/image_thumb.png" width="636" height="172" /></a></p>

<p>&#160;</p>

<p><strong>挂起</strong> <br/>
通常情况下，Metro 风格应用程序会在用户切换到另一应用程序时停止运行。Windows 会挂起不在前台的应用程序。当您的应用程序挂起时，它在内存中处于冻结状态。处于此状态时，它无法运行，但如果用户返回该应用程序，Windows 可立即将其恢复。这样，Windows 就可以让前台应用程序更好地使用系统资源，并确保后台应用程序不会耗尽用户的电池电量。 <br/>
当您的应用程序离开前台时，Windows 会等待几秒钟以便能够快速切换回该应用程序，然后才尝试将其挂起。您的应用程序必须注册 <strong>suspending </strong>或 <strong>checkpoint </strong>(JavaScript) 事件，当 Windows 需要将其挂起时，它会收到这些事件。这是应用程序的重要时刻；可利用此机会保存必须保留在持久存储中的应用程序数据。通常，您的应用程序会按原样恢复，您不需要持久留存的数据，因为它们仍然在内存中。但您需要存储这些数据以防 Windows 为了释放系统资源而终止应用程序。保存足够的应用程序数据可让用户返回到当应用程序挂起时他们在应用程序中所处的位置。这样，您的客户就会感觉您的应用程序始终处于运行状态。 <br/>
如果应用程序没有在收到挂起事件后的 5 秒内从挂起事件处理程序中返回，Windows 会将其终止。切勿在挂起事件处理程序中执行任何繁重操作，这一点非常重要。应保存应用程序数据并快速返回。 <br/>
在本博文中，我们以股票应用程序为例。该应用程序可以使用挂起事件来保存用户上次查看的股票以及股价图的时间范围。这样一来，如果应用程序被终止，它就可以正好重新启动到用户上次查看该应用程序时所看到的同一视图。例如，针对股票应用程序的建议是，借此机会发送本地磁贴通知，以便在 Windows 挂起应用程序之前，应用程序的磁贴能够使用最新信息进行更新。 <br/>
<strong>在 JavaScript 中处理挂起</strong> <br/>
如果您使用 Windows JavaScript 库 (WinJS) 编写 Metro 风格应用程序，则可以使用 <strong>checkpoint </strong>事件处理挂起。</p>

<pre class="wp-code-highlight prettyprint linenums:1">var app = WinJS.Application;

function checkpointHandler() {
    // The checkpoint event gives us the chance to save application data.
    // In this case, we save the current stock info that the user is viewing.
    app.sessionState.lastSeenStock = selectedStock;
    app.sessionState.lastSeenRange = selectedRange;

    // Send client side notifications
    Tile.sendTileUpdate(selectedStock, stockInfo.change, stockInfo.lastSale, 
stockInfo.lastSaleTime, stockInfo.open); 
}

app.addEventListener(&quot;checkpoint&quot;, checkpointHandler);</pre>


<p>这只是一个概要。有关详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465138.aspx"><u>如何挂起应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理理挂起</strong></p>

<p>如果您使用 XAML 和 C# 编写 Metro 风格应用程序，则可以对应用程序对象使用 <strong>Suspending </strong>事件来处理应用程序挂起。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public App()
{
    InitializeComponent();
    this.Suspending += new SuspendingEventHandler(OnSuspending);
}

async protected void OnSuspending(object sender, SuspendingEventArgs args)
{
    // The Suspending event gives us the chance to save application state
    // In this case, we save the current stock info that the user is viewing

    // Because writing to a file is asynchronous, we grab a deferral which ensures
    // that suspending doesn’t complete until our file write is complete
    SuspendingDeferral deferral = args.SuspendingOperation.GetDeferral();

    // Here we create a SuspensionManager class which handles adding session data
    // to a Dictionary and then serializing that data to a file
    SuspensionManager.SessionState[&quot;lastSeenStock&quot;] = stock;
    SuspensionManager.SessionState[&quot;lastSeenRange&quot;] = range;
    await SuspensionManager.SaveAsync();

     // Send client side notifications
    Tile.SendTileUpdate(stock, stockInfo.Change, stockInfo.LastSale, 
stockInfo.LastSaleTime, stockInfo.Open);

    deferral.Complete();
}</pre>


<p>这同样只是一个概要。有关如何在 XAML 和 C# 中处理挂起的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465115.aspx"><u>如何挂起应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>恢复</strong></p>

<p>当应用程序恢复时，它将从 Windows 将其挂起它所处的状态继续进行。具体说就是：当应用程序挂起，应用程序数据和状态保留在内存中，因此当它恢复时，一切都保持它挂起时的状态。在收到 <strong>resuming </strong>事件时，您不需要明确还原任何已保存的数据。</p>

<p>但您希望您的应用程序看起来始终处于运行状态。为此，它必须保持连接并显示最新数据。但是在恢复之前，您的应用程序可能会在挂起状态停留很长时间。因此数据或网络连接可能会过时，在应用程序恢复时，可能需要刷新连接。当用户将您的应用程序切换到前台时，它会收到 <strong>resuming </strong>事件。您可以在应用程序收到此事件时刷新应用程序内容并重新连接网络资源。</p>

<p>在我们的示例股票应用程序中，将在恢复时刷新应用程序在挂起前所具有的所有缓存股票数据。之前的数据可能已存在数小时甚至数天之久。如果用户看到这些旧数据，他们就会意识到所用应用程序并非始终处于运行状态。因此在恢复时，我们的股票应用程序必须更新其所有数据。这样，应用程序每次切换到前台时，用户都会看到最新的股票价格、股价图和新闻文章。</p>

<p><strong>在 JavaScript 中处理恢复</strong></p>

<p>在 JavaScript 中，您可以在 <strong>Windows.UI.WebUI.WebUIApplication</strong> 命名空间中使用 Windows 运行时<strong>resuming </strong>事件。这是专门用于 JavaScript 应用程序的 resuming 事件。</p>

<pre class="wp-code-highlight prettyprint linenums:1">function resumingHandler() {
    //Update the selected stock with the latest news, stock info, and chart data
    News.requestNews(stock);
    Api.getStockInfoData(stock).then(function(data){displayStockInfo(data); });
    Api.getHistoryData(range).then(function (chartData) 
{CanvasChart.drawChart(&quot;chartCanvas&quot;, chartData, Chart.getChartOptions(false));});

    // Send client side notifications
    Tile.sendTileUpdate(stock, stockInfo.change, stockInfo.lastSale, 
stockInfo.lastSaleTime, stockInfo.open);    
        }

Windows.UI.WebUI.WebUIApplication.addEventListener(&quot;resuming&quot;, resumingHandler);</pre>


<p>有关详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465114.aspx"><u>如何恢复应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理恢复</strong></p>

<p>如果您使用 XAML 和 C# 编写 Metro 风格应用程序，则可以对应用程序对象使用 <strong>Resuming </strong>事件来处理应用程序恢复。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public App()
{
    InitializeComponent();
    this.Resuming += new EventHandler&lt;object&gt;(App_Resuming);
}

        async private void App_Resuming(object sender, object e)
        {
            //Update the selected stock with the latest news, stock info, and chart data
            News.RequestNews(stock);

            Data data = await Api.GetStockInfoDataAsync(stock);
            Api.DisplayStockInfo(data);

            Chart chartData = await Api.GetHistoryDataAsync(range);
            CanvasChart.DrawChart("chartCanvas", chartData, Chart.GetChartOptions(false));

            // Send client side notifications
    Tile.SendTileUpdate(stock, stockInfo.Change, stockInfo.LastSale, stockInfo.LastSaleTime, stockInfo.Open);
        }
</pre>


<p></p></p>

<p></object></p>

<p>有关如何在 VB/C#/C++ 和 XAML 中处理恢复的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465110.aspx"><u>如何恢复应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>激活</strong></p>

<p>激活与您应用程序的启动方式息息相关。在 Metro 风格应用程序中它起到多方面的作用。有关如何使用 Metro 风格应用程序激活处理合约的更多详细信息，请参阅我们之前的博文<a href="http://blogs.msdn.com/b/windowsappdev_cn/archive/2012/03/30/windows-8-activating-contracts.aspx"><u>在您的应用程序中激活 Windows 8 合约</u></a>。本文中我们重点介绍当 Windows 终止您的应用程序，随后用户又重新启动它时，如何使用激活来还原之前保存的数据。</p>

<p>Windows 可能会出于多个原因终止已挂起的应用程序。例如：用户手动关闭应用程序或注销，或者系统的资源不足（诸如游戏之类的应用程序可能需要大量资源！）。如果用户在 Windows 终止应用程序后启动应用程序，它会收到 <strong>activated </strong>事件，用户会看到应用程序的初始屏幕，直到应用程序被激活。您可以使用此事件确定应用程序是否需要还原上次挂起时保存的数据，或者您是否必须加载应用程序的默认数据。<strong>activated </strong>事件参数包含一个 <strong>PreviousExecutionState </strong>属性，该属性会告诉您在激活之前应用程序所处的状态。该属性的值是 <strong>Windows.ApplicationModel.Activation.ApplicationExecutionState</strong> 枚举值之一。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/image1.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://beyondvincent.com/wp-content/uploads/2013/06/image_thumb1.png" width="686" height="206" /></a></p>

<p><strong>PreviousExecutionState </strong>的值还可以是 <strong>Running </strong>或 <strong>Suspended</strong>，但在这些情况下，您的应用程序之前并未终止，因此您不必考虑是否需要还原数据。</p>

<p>当应用程序已激活并且其 <strong>PreviousExecutionState </strong>值为 <strong>Terminated </strong>时，您必须还原已保存的会话数据，以使应用程序完全保持用户上次看到的样子。如果用户手动关闭应用程序、应用程序意外终止或者在当前会话中尚未运行，则您必须忽略之前的会话数据并使用默认视图启动应用程序。</p>

<p>我们的示例股票应用程序使用 <strong>activated </strong>事件重新显示挂起时所保存的股票和股价图信息。该应用程序还刷新其缓存的网络数据。这样，用户看到的就是他们离开该应用程序时所查看的股票，但股票价格、股价图和新闻文章全都是最新的。</p>

<p><strong>在 JavaScript 中处理激活</strong></p>

<p>如果您使用 Windows JavaScript 库 (WinJS) 编写 Metro 风格应用程序，则可以使用 <strong>activated </strong>事件处理激活。</p>

<p>在 <strong>activated </strong>事件处理程序代码中，您的应用程序可以检查 <strong>sessionState </strong>对象，以确定它是应加载保存的数据，还是应显示默认主页视图。<strong>SessionState </strong>通过检查 <strong>eventArgs.detail.previousExecutionState</strong> 自动确定应用程序上次的状态。如果 <strong>sessionState </strong>已填充，则使用它还原会话数据，否则使用应用程序的默认数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">var app = WinJS.Application;

function activatedHandler(eventArgs) {
    if (eventArgs.detail.kind == Windows.ApplicationModel.Activation.ActivationKind.launch) {
        // Check whether the session state variables are valid.
        // If so, retrieve the stock and range values saved in the checkpoint handler
        if (app.sessionState) {
            stock = app.sessionState.lastSeenStock;
            range = app.sessionState.lastSeenRange;
        } 
        // If not, use the app&#039;s default values
        else{
            stock = &quot;DOW&quot;;
            range = &quot;1M&quot;;           
        }

        // Initialize the WinJS controls asynchronously behind the app splash screen
        // Start retrieving the latest stock data asynchronously after the controls are ready
        eventObject.setPromise(WinJS.UI.processAll().then(function() {
            Api.initializeUserStocks();
        }));
    }
}

app.addEventListener(&quot;activated&quot;, activatedHandler);</pre>


<p>有关如何在 JavaScript 中处理激活的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465102.aspx"><u>如何激活应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理激活</strong></p>

<p>在使用 XAML 和 C# 的 Metro 风格应用程序中，您可以替代 <strong>OnLaunched </strong>事件来处理从磁贴基本激活应用程序。</p>

<p>在 <strong>OnLaunched </strong>事件处理程序代码中，您的应用程序可以检查事件参数上的 <strong>PreviousExecutionState</strong>。如果它等于 <strong>Terminated</strong>，则还原您在 <strong>Suspending </strong>事件中保存的数据。如果是其他值，则使用应用程序的默认数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">async protected override void OnLaunched(LaunchActivatedEventArgs args)
        {
    // Check whether the session data should be restored
            if (args.PreviousExecutionState == ApplicationExecutionState.Terminated)
            {
                // Here we&#039;ve created a SuspensionManager class which handles restoring session
                // data from a file and then gives access to that data through a Dictionary
                await SuspensionManager.RestoreAsync();

// Retrieve the stock and range values saved in the suspend handler 
stock = SuspensionManager.SessionState[&quot;lastSeenStock&quot;];
                range = SuspensionManager.SessionState[&quot;lastSeenRange&quot;];
            }
            // If not, use the app&#039;s default values
            else
            {
                stock = &quot;DOW&quot;;
                range = &quot;1M&quot;;
            }

    // Start retrieving the latest stock data
            Api.InitializeUserStocks();

            Window.Current.Activate();
        }</pre>


<p>有关如何在 XAML 中处理激活的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465093(v=win.10).aspx"><u>如何激活应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>打造出色应用程序生存期体验的提示</strong></p>

<p>现在您已了解了所有基础知识，下面是一些可帮助您为应用程序打造出色生存期体验以便在用户看来应用程序始终处于活动和最新状态的一些提示。</p>

<p><strong>有时最好重新开始</strong></p>

<p>如果自用户上次查看应用程序已过了很长时间，有时最好将应用程序重置为其默认视图。多久才算很久完全由您决定，但如果应用程序的内容看起来陈旧或过时，则建议您将应用程序恢复为其主页视图。这会使应用程序在用户看来更加智能。</p>

<p>例如，如果您要构建一个新闻阅读器应用程序，在用户从该应用程序切出后，它可能会被挂起。过了一段时间后，当用户回到新闻阅读器应用程序时，应用程序将会恢复。在恢复处理程序中，检查当前文章已存在多长时间，以确定它现在是否已过时。如果文章太旧，则显示默认主页视图而不是旧文章。</p>

<p><strong>在正确的时间保存正确的数据</strong></p>

<p>在应用程序的整个生命周期中，始终以增量方式保存重要数据。由于应用程序只有最多五秒的时间来运行挂起事件处理程序代码，因此您需要确保在应用程序挂起时，您的重要应用程序数据已保存到持久存储。</p>

<p>在编写应用程序时，您需要管理以下两种类型的数据：<strong>会话数据</strong>和<strong>用户数据</strong>。会话数据是应用程序中与用户的当前体验相关的临时数据。例如，用户正在查看的当前股票、用户正在 eBook 中阅读的当前页面或一个很长的项目列表中的滚动位置。用户数据是持久性的，必须始终可供用户访问，无论它们是什么。例如，用户正在键入的进行中文档、在应用程序中拍摄的照片或用户在游戏中的进度。</p>

<p>确保在应用程序挂起时，它已将这两种数据类型保存到持久存储。</p>

<p><strong>还原会话数据</strong></p>

<p>用户希望 Metro 风格应用程序通常保持他们上次使用它时所处的状态。从开发人员的角度看，当您的应用程序从挂起状态恢复或从未运行状态激活时，还原之前保存的会话数据通常是合理的。</p>

<p>例如，如果您的应用程序包括购物车功能，并且用户向购物车中添加商品后从应用程序中切出，那么在用户恢复或重新激活该应用程序时维护购物车中的那些商品应该是有意义的。</p>

<p>再举一个例子，假设某应用程序显示新闻文章。如果用户之前正在查看某特定文章，然后切换到另一应用程序，用户会希望当他们回到您的应用程序中时，他们能够看到之前正在查看的文章。</p>

<p><strong>释放挂起事件处理程序中的独占资源</strong></p>

<p>如果应用程序在执行过程中获取了任何独占资源（例如文件句柄或外部设备引用），那么它在收到<strong>suspending</strong> 事件时则必须释放这些资源。此外，如果您的应用程序需要使用这些独占资源才能继续运行，那么在收到 <strong>resuming</strong> 事件时，则必须回收这些资源。</p>

<p><strong>不要关闭应用程序！</strong></p>

<p>Windows 8 中的 Metro 风格应用程序永远不能将其自身关闭或者提供应用程序用户界面让用户关闭您的应用程序。挂起和终止应用程序由 Windows 代表用户进行处理，以维护系统性能和电池寿命。如果用户想要关闭您的应用程序，他们可以通过从屏幕顶部向屏幕底部滑动或者按 Alt＋F4 来实现。</p>

<p><strong>结束语</strong></p>

<p>通过使用 <strong>suspending</strong>、<strong>resuming</strong> 和 <strong>activated</strong> 这三个事件，对用户而言，您的应用程序看起来始终处于活动状态。但与此同时，在用户不使用应用程序时，它永远不会不必要地耗尽电池电量或降低系统性能。在设备越来越紧凑、移动性越来越强的世界里，新的 Metro 风格应用程序生命周期使您的应用程序在任何设备上都能大放异彩。</p>

<p>本博文链接：</p>

<p>&#160;</p>

<p>本博文链接：</p>

<p>中文版：<a href="http://blogs.msdn.com/b/windowsappdev_cn/archive/2012/04/16/managing-app-lifecycle.aspx"><u>管理应用程序生命周期，让应用程序始终充满“生命活力”</u></a></p>

<p>英文版：<a href="http://blogs.msdn.com/b/windowsappdev/archive/2012/04/10/managing-app-lifecycle-so-your-apps-feel-quot-always-alive-quot.aspx"><u>Managing app lifecycle so your apps feel &ldquo;always alive&rdquo;</u></a></p>

<p>msdn上的一篇文章：应用程序生命周期（Metro style apps）</p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464925.aspx"><u>Application lifecycle (Metro style apps)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465093(v=win.10).aspx"><u>How to activate an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465115(v=win.10).aspx"><u>How to suspend an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465110.aspx"><u>How to resume an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/39/" itemprop="url">Windows Store App开发[012]Windows 8 中搜索合约的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在<a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91011%E6%B5%85%E8%B0%88windows-8-%E4%B8%AD%E7%9A%84%E5%90%88%E7%BA%A6contracts/" target="_blank"><u>上一篇</u></a>文章，我给大家介绍了Windows 8中的合约，如果你还没有看的话，建议你先去阅读一下。在本篇文章中，我将利用搜索合约，来跟大家介绍合约的使用。为了演示的方便，本次示例我使用下面这篇文章中的示例进行改进。</p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91007%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/" target="_blank"><u>Windows Store App开发[007]视图模型与数据绑定</u></a></p>

<p>本文的内容结构如下：</p>

<p>1、搜索合约的声明</p>

<p>2、搜索的激活</p>

<p>3、提交查询的候选项</p>

<p>4、运行效果和示例代码</p>

<p>&#160;</p>

<p><strong>1、搜索合约的声明</strong></p>

<p>&#160;&#160; 我们打开上面提到的示例程序，并打开Package.appxmanifest文件，选择声明选项卡，如下图，并找到选择搜索声明，然后添加:</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/16.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb6.png" width="682" height="453" /></a></p>

<p>然后我们部署应用程序到计算机上。部署完毕之后，按Windows+Q组合键，可以看到，我们的示例程序：搜索合约测试已经在搜索面板中了。如果这里不添加搜索声明的话，在搜索面板中是看不到的。如下两图所示(左图是已经添加搜索声明的，右图则是没有添加)</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/26.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb7.png" width="652" height="665" /></a></p>

<p><strong>2、搜索的激活</strong> <br/>
&#160;&#160;&#160; 打开App.xml.cs文件，在其中添加如下函数</p>

<pre class="wp-code-highlight prettyprint linenums:1">protected override void OnSearchActivated(SearchActivatedEventArgs args)
{
    viewModel.SearchAndSelect(args.QueryText);
}</pre>


<p>当应用程序以显示搜索结果为目的被激活时，该方法会被调用，也就是说，从搜索面板中输入内容，然后回车可以激活该方法。</p>

<p>在这里，我把viewModel的位置放到App里面了，这样方便调用。在viewModel方法中我添加了一个方法SearchAndSelect，该方法用于搜索内容。代码如下：该代码的左右就是查找出ForumItemList 中name与搜索内容符合的字段，并记录相关的index。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public void SearchAndSelect(string searchTerm)
{
    int selIndex = -1;
    for (int i = 0; i &lt; ForumItemList.Count; i++)
    {
        if (ForumItemList.Name.ToLower().Contains(searchTerm.ToLower()))
        {
            selIndex = i;
            System.Diagnostics.Debug.WriteLine(ForumItemList.Name);
            break;
        }
    }
    SelectedItemIndex = selIndex;
}</pre>


<p>为了在界面上让搜索命中相选中，我还对SelectedItemIndex进行了监听，如果发生改变则界面先择也相应的进行改变，如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">viewModel.PropertyChanged += (sender, args) =&gt;
{
    if (args.PropertyName == &quot;SelectedItemIndex&quot;)
    {
        ForumList.SelectedIndex = viewModel.SelectedItemIndex;
    }
};</pre>


<p>这样，当SelectedItemIndex 改变的时候，界面上的选中项也会发生改变。</p>

<p><strong>3、提交查询的候选项</strong></p>

<p>&#160;&#160;&#160; 为了加强用户体验，方便用户选择搜索内容，我们可以在搜索面板添加一些搜索的候选项。当用户在输入内容的时候，按照一定的规则，给用户列出适合的内容。</p>

<p>&#160;&#160;&#160; 首先需要做的事情就是监听SuggestionRequested事件，当用户开始在搜索框中输入内容时，就会触发该事件。那么我们可以通过下面的代码进行注册：注意在这里需要增加using Windows.ApplicationModel.Search;否则会出现错误。</p>

<pre class="wp-code-highlight prettyprint linenums:1">SearchPane.GetForCurrentView().SuggestionsRequested += searchPane_SuggestionsRequested;</pre>


<p>当SuggestionRequested事件来的时候，我们就可以发送候选项建议了。就像查询一样，候选项内容可以来自网络服务，或者自行组合，在这里为了演示目的，我从ForumItemList中获取内容，在SearchPageSuggestionsRequestedEventArgs实例中，我们可以把候选项添加到SearchSuggestionCollection中，SearchSuggestionCollection中的内容会显示在搜索面板中。因为当用户每次输入内容的时候，该方法都会被调用，因此一定要注意该函数的编写。下面是我的代码：</p>

<p>&#160;&#160;&#160; 需要注意的是搜索面板只能显示最多5个候选项</p>

<pre class="wp-code-highlight prettyprint linenums:1">void searchPane_SuggestionsRequested(SearchPane sender, SearchPaneSuggestionsRequestedEventArgs args)
{
    foreach (ForumItem forumItem in viewModel.ForumItemList)
    {
        string suggestion = forumItem.Name;

        if (suggestion.StartsWith(args.QueryText, StringComparison.CurrentCultureIgnoreCase))
        {
            args.Request.SearchSuggestionCollection.AppendQuerySuggestion(suggestion);
        }
        if (args.Request.SearchSuggestionCollection.Size &gt;= 5)
        {
            break;
        }
    }
}</pre>


<p>这样我们就成功的在程序中实现了搜索合约功能。下面我们看看运行效果</p>

<p><strong>4、运行效果和示例代码</strong></p>

<p>实运行程序，调出搜索面板（Windows键+Q），输入W字母，看到如下效果图，在右边列出了以W开头的两个候选项</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/37.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb7.png" width="682" height="427" /></a></p>

<p>选择第二项：Windows 8 开发论坛，此时左边的对应项会被选中，如下图所示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/45.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb5.png" width="682" height="427" /></a></p>

<p>到此，搜索合约的讲解就结束了，欢迎大家的阅读。</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SearchContract" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/38/" itemprop="url">Windows Store App开发[011]浅谈Windows 8 中的合约(contracts)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Windows 8 Metro App开发中，你很快就会使用到合约功能，合约是Windows 8中至关重要的全新概念，作为Metro开发者，有必要掌握。目前关于合约的相关资料还比较少，在这里，我主要参考了msdn提供的一些文档，写此贴的目的是希望大家对合约有一个初步的了解，同时也欢迎大家来交流。</p>

<p>&#160;&#160;&#160;&#160;&#160; 在这篇文章中，我主要对合约进行一个概述。在下一篇文章中，我会通过编程的方式，向大家介绍如何使用合约。</p>

<p>本文，我主要介绍如下内容：</p>

<p>1、合约概述</p>

<p>2、合约类型</p>

<p>&#160;</p>

<p><strong>1、合约概述</strong></p>

<p>Metro 风格的应用程序使用合约来声明它们支持哪些与其他应用程序和 Windows 进行的交互。对于其中的一些合约，您可能早有耳闻，如“搜索”合约和“共享”合约。通过各种合约，应用程序不仅可以通过与系统协作来提高运行速度，而且在用户安装了多个实施合约的应用程序时，它们还可以彼此配合来保持良好的运行状态。</p>

<p>合约：针对特定目的启动 Metro 风格的应用程序（包含上下文）</p>

<p>&#160;&#160;&#160; Windows 8 合约发挥着纽带的作用，它可以将您的应用程序与其他 Metro 风格的应用程序以及系统 UI 相关联。例如，“文件打开选取器”合约允许用户将文件从一个应用程序导入到另一个。使用“搜索”合约，用户能够在系统中的任意位置搜索应用程序，并在多个应用程序之间快速传输查询。在这些案例以及许多其他合约定应用场景中，Windows 都需要具备可通过应用程序 UI 启动应用程序的功能，这样用户才能快速高效地完成特定任务。这正是我们的激活平台和 API 发挥其作用的平台。</p>

<p>&#160;&#160;&#160; Windows 8已经定义了一些合约。最重要的合约有：搜索合约（search contract）、共享合约（share contract）、设置合约（settings contract）和App To App picker合约。这里也有更多的何用合约，在应用中使用这些合约时，一定要注意用户体验。</p>

<p>下面我们就来分别看看Windows 8中的合约类型。</p>

<p>&#160;</p>

<p><strong>2、合约类型</strong></p>

<p>&#160;&#160;&#160; 在介绍合约之前，先跟大家分享一个热键组合——Windows键+C键（或将鼠标移到屏幕的最右上角或右下角），就可以启动系统的Charm面板，Charm面板里面有搜索、共享、设定等相关功能，这些功能与下面介绍的合约有密切关系。</p>

<p>接下来，我们对各种合约进行初步的认识：</p>

<p>Search contract</p>

<p>&#160;&#160;&#160; Search contract 可以用来建立针对 Metro Style Apps 中内容的搜索功能。我们可以轻松的使用Search contract ，让用户能直接通过 Windows 8 里的 Search Charm 对我们开发的 Metro Style Apps 的内容里的字符串或是文字进行查找。</p>

<p>&#160;&#160;&#160; 一旦我们的 App 实现了Search contract，当使用者打开 Windows 8 的 Search Charm 时，我们的 App 就会出现在右下方的 Apps 列表，使用者就可以直接在该接口点选我们的 App 的 Icon，针对我们的 App 中的数据内容进行s搜索，如此一来，我们也不用特别去多花心思去为我们的每一个 App 设计个自的搜索接口，一切都交给 Windows 8 的 Search Charm 就行了。</p>

<p>&#160;&#160; 不过，通过Search contract 并不能针对 App 中特定文件的内容进行搜索，如果要实现特定文件内容的搜索的话，就得自己在 App 中写搜索的接口和相关逻辑开启 Windows 8 内置的 Search 面版热键为 Windows键 + Q键</p>

<p>Share contract <br/>
&#160;&#160;&#160; Share contract 比较特别的地方是，它有「来源端 App」及「目标端 App」。如果我们开发的 Metro Style Apps 里会有文档可以当作数据源给其他的 Metro Style Apps 使用，那么这个 App 就会是来源端 App；相反的，如果我们的 Metro Style Apps 允许接受其他 Metro Style Apps 的数据作为数据的输入来源的话，这个 App 就是目标端 App，可以借助Share Target contract 来操作让它可以透过 Share Charm 接受其他 App 的数据源的功能。通过 Share Contract，我们就能使用 Windows 8 的 Share Charm，让用户更轻松的进行数据间的分享及传递了。 <br/>
开启 Windows 8 内置的 Share 面版的热键为 Windows 键 + H 键。 <br/>
Settings contract <br/>
&#160;&#160;&#160; 通过 Settings contract功能，我们可以让用户通过 Windows 8 的 Settings Charm 来针对我们开发的 Metro Style Apps 进行设定，如此一来，我们不用费心去特别设计一个设定专用的画面，其次，整个用户体验也和操作系统本身更为贴近。 <br/>
开启 Windows 8 内置的 Settings 面版的热键为 Windows 键 + I 键。 <br/>
Play To contract <br/>
&#160;&#160;&#160; 通过 Play To contract，我们可以轻松的让用户在我们开发的 Metro Style Apps 中进行播放的影片、音乐或是相片等等媒体文件，以串流的方式，通过兼容于 DLNA 的装置进行播放。若操作系统侦测到有支持相关功能的其他装置，会自动将那些装置显示在 Devices Charm 里，而我们就可以通过 Play To 功能，将媒体以串流的传输方式传送过去。 <br/>
开启 Windows 8 内置的 Devices 面版的热键为 Windows 键 + K 键。 <br/>
App to App Picking contract <br/>
&#160;&#160;&#160; 我们可以通过 App to App Picking contract，让我们的 App 开启文件系统、网络上或是其它在线服务中的文件，甚至使某个 App 具备能通过其他 App 进行浏览或是开启特定类型文件的能力；除此之外，使用者在开启特定类型文件时，也可以自行决定要使用哪一个 App 来开启。 <br/>
更多的合约类型参考下面的链接： <br/>
<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464906.aspx"><u>App contracts and extensions (Metro style apps)</u></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/37/" itemprop="url">Windows Store App开发[010]通知使用(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在我写的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a>中，我概述了Windows 8 中的通知，介绍了通知的类型（tile，toast和badges），以及通知的分发机制(local，scheduled和push)。在这一篇帖子中，我将以编程者的角度来给大家介绍我目前对通知的了解情况，希望能够起到抛砖引玉的作用，更多功能还需要等待你来实现。</p>

<p>&#160;&#160;&#160; 注：1、本次主要以代码的形式来讲解通知的使用</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2、本次讲解的通知分发方法为local[关于分发方法，请参考我的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a></p>

<p>通过本次的学习，你将初步掌握如下内容：</p>

<p>1、准备工作</p>

<p>2、Toast通知的使用</p>

<p>3、Tile通知的使用</p>

<p>4、Badge通知的使用 <br/>
5、最后附上程序相关代码工程</p>

<p>&#160;</p>

<p><strong>1、准备工作</strong></p>

<p>&#160;&#160;&#160; a) 首先以Blank App创建一个应用程序。然后打开Package.appxmanifest文件，按照下面图中的标准，制作了3个图片，并添加到工程中。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/15.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb5.png" width="682" height="183" /></a></p>

<p>&#160;</p>

<p>b) 获取 NotificationsExtensions 库</p>

<p>&#160;&#160;&#160; 由于Tile、Toast和Badge使用的都是xml模版，为了简化对xml的操作，这里我们可以使用NotificationsExtensions对象库模型，它提供磁贴、锁屏提醒和 Toast 通知 XML 模板内容，而无需直接使用 XML 文档对象模型 (DOM)。 当你在 Microsoft Visual Studio 中使用此库时，你可以获得下列好处：</p>

<ul>
<li>智能感知，它将可用的通知 XML 标记和属性列为对象属性。这样，开发人员将无需参考架构文档来获取有关元素和结构的信息。</li>
<li>工厂函数，可通过该函数来创建主干通知。然后，你可以用你的内容填充这些通知。</li>
<li>一种在你的通知负载中同时包括方形和加宽磁贴版本（这是最佳做法！）的简化方式。</li>
<li>一种查找和填充文本和图像属性的有用方式。可通过它们的名称来获取有关它们在模板中的预期使用、大小或位置的更多信息。</li>
</ul>


<p>具体的使用操作说明微软的官网上有详细内容，我就不细说了，参考下面的链接：</p>

<p><a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/hh969156.aspx"><u>使用 NotificationsExtensions 填充锁屏提醒、磁贴和 Toast 模板</u></a></p>

<p>这里我就默认你已经按照上面链接给出的操作步骤，完成了对NotificationsExtensions库的引用。</p>

<p>&#160;</p>

<p><strong>2、Toast通知的使用</strong></p>

<p>&#160;&#160;&#160; 先上相关代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void sendToast(object sender, RoutedEventArgs e)
{
    IToastNotificationContent toastContent = null;
    IToastText01 templateContent = ToastContentFactory.CreateToastText01();
    templateContent.TextBodyWrap.Text = &quot;今天去游泳！(BeyondVincent|破船|)&quot;;
    toastContent = templateContent;
    ToastNotification toast = toastContent.CreateNotification();
    ToastNotificationManager.CreateToastNotifier().Show(toast);
}</pre>


<p>看上面的代码，通过使用NotificationsExtensions库提供的IToastNotificationContent类，我们可以方便的创建出一个ToastNotification，然后在利用ToastNotificationManager该语句ToastNotificationManager.CreateToastNotifier().Show(toast); 将Toast通知显示出来。显示效果如下图所示：</p>

<p>显示在屏幕的右上角</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/25.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb6.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p>关于Toast通知需要注意的是：需要在Package.appxmanifest中将是否支持Toast通知设置为是，如下图</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/36.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb6.png" width="654" height="676" /></a></p>

<hr />

<p><strong>3、Tile通知的使用</strong></p>

<p>微软提供了好多Tile模版供我们使用，这里已经给出了详细的介绍，大家可以前去学习了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761491"><u>Choosing a tile template</u></a></p>

<p>在这里我用了两种方式更新Tile：纯文本（ ITileWideText03&#160; ITileWideText04）和web图片（ITileSquareImage）</p>

<p>&#160;&#160;&#160; 先上纯文本代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void UpdateTileWithText()
{
    ITileWideText03 tileContent = TileContentFactory.CreateTileWideText03();
    tileContent.TextHeadingWrap.Text = &quot;你有三条未读短信！&quot;;

    ITileSquareText04 squareContent = TileContentFactory.CreateTileSquareText04();
    squareContent.TextBodyWrap.Text = &quot;你有三条未读短信！&quot;;
    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>看上面的代码，在这里同样使用NotificationsExtensions库提供的功能，很方便的创建出Notification，然后使用最后一行代码将其更新。</p>

<p>使用web图片代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateTileWithWebImage()
{
    ITileWideImageAndText01 tileContent = TileContentFactory.CreateTileWideImageAndText01();

    tileContent.TextCaptionWrap.Text = &quot;高清：撑杆跳伊辛巴耶娃4米70无缘奥运三连冠&quot;;

    tileContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    tileContent.Image.Alt = &quot;Web image&quot;;

    ITileSquareImage squareContent = TileContentFactory.CreateTileSquareImage();

    squareContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    squareContent.Image.Alt = &quot;Web image&quot;;

    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>如果我们要清除Tile信息，则调用下面的代码即可</p>

<pre class="wp-code-highlight prettyprint linenums:1">TileUpdateManager.CreateTileUpdaterForApplication().Clear();</pre>


<p>运行效果如下图：</p>

<p>文字：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/44.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb4.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/52.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb2.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>4、Badge通知的使用 </strong></p>

<p>&#160;&#160;&#160; 微软也提供了badge相关的详细介绍以及图标，建议参考下面的链接，进行了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh779719"><u>Badge overview (Metro style apps)</u></a></p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761458"><u>Choosing a badge image</u></a></p>

<p>下面我继续上代码，这里我同样用两种方式展现badge的使用（数字和图片）</p>

<p>先上数字的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithNumber(int number)
{
    BadgeNumericNotificationContent badgeContent = new BadgeNumericNotificationContent((uint)number);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>代码很简单，我就不表了。</p>

<p>再上图片的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithGlyph(GlyphValue index)
{
    BadgeGlyphNotificationContent badgeContent = new BadgeGlyphNotificationContent(index);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>同样不细表，如果大家在使用过程中遇到什么问题，可以跟帖进行讨论。</p>

<p>下面是清除badge通知内容的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">BadgeUpdateManager.CreateBadgeUpdaterForApplication().Clear();</pre>


<p>很简单吧。那我就来上两个允许效果图：</p>

<p>数字：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/61.png"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb1.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/7.png"><img title="7" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>5、最后附上程序相关代码工程</strong></p>

<p>下图是程序主界面图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/8.png"><img title="8" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="8" src="http://beyondvincent.com/wp-content/uploads/2013/06/8_thumb.png" width="682" height="410" /></a> </p></p>

<p>&#160;</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/Notifications" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/36/" itemprop="url">Windows Store App开发[009]通知概述(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在开始屏幕上，瓷贴是一个应用程序主要的展现。为了使开始屏幕充满活力，让用户看到的东西可以一目了然（这也是metro 风格的主要目的），你可以在瓷贴上添加通知，当然也可以单独使用它们。</p>

<p>通过本次的学习，你将掌握如下内容：</p>

<p>1、通知的类型</p>

<p>2、通知的分发方法</p>

<p>3、用例图表</p>

<p>&#160;</p>

<p><strong>1、通知的类型</strong></p>

<p>&#160;&#160;&#160; 这里主要有三种通知类型：Toast通知、Tile通知和Badge通知。下面我们就来分别了解一下它们各自的特性。</p>

<p>Toast通知</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/14.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb4.png" width="321" height="77" /></a></p>

<p>Toast通知实际上并不是新特征了，在微软的Outlook或者一些社交类客户端应用程序中都可以看到Toast的身影。Toast通知主要用于：时间敏感的个人信息，例如朋友发来了一条消息。Toast通知暗示有一个事件或者内容需要你关注，当点击toast时会启动应用程序，并进入到与通知信息相关的画面。一定要记住：Toast通知可能会丢失或者被用户关闭，所以不能用来当做一种保证交付机制使用。Windows 8 中的Toast通知可以出现在其它程序中，开始屏幕上或者桌面（desktop）。</p>

<p>&#160;</p>

<p>Tile通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/24.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb5.png" width="210" height="102" /></a></p>

<p>Tile通知显示在开始屏幕上，所以对于没有运行的程序，这类通知更加有用（当然，当程序在运行的时候，用户是不喜欢来看开始屏幕上的Tile通知）。Tile通知是Windows 8和Windows Phone特有的通知，它们看起来一目了然——用户可以快速的查看最新e-mail的主题，看到当前天气情况，检查收藏的股票信息。这一切信息的获取都不需要启动应用程序。</p>

<p>&#160;</p>

<p>Badge通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/35.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb5.png" width="104" height="108" /></a></p>

<p>Badge被认为是Tile通知的特殊类型。badge通知可以显示eleven glyphs或者从1到99之间任意的一个数字，显示的位置在tile的右下角。如上图中数字badge通知在Windows Store tile中，表示有1个可以更新的程序。如果是媒体播放器，可以使用不同的字形（eleven glyphs）来表示播放器是暂停或者播放中。</p>

<p>&#160;</p>

<p><strong>2、通知的分发方法</strong> <br/>
&#160;&#160;&#160; 有三种重要的分发方法：Local通知，Scheduled通知和Push通知，下面我们也来看看各自的特点 <br/>
Local通知</p>

<ul>
<li>只有当程序运行的时候可以使用</li>
<li>&#160;&#160;&#160;&#160; 主要用于更新tiles和badges</li>
</ul>


<p>&#160;&#160;&#160;&#160;&#160; Local通知是由运行的程序触发的，用于通知用户应用程序状态当前发生的变化，或者有感兴趣的新内容，这些都是有应用程序本身负责生成或者发现的。 <br/>
Scheduled通知
*   在某个精确的时间点使用toast通知或者tile通知</p>

<p>&#160;&#160;&#160;&#160;&#160; 开发者可以让Scheduled通知使用local通知在将来某一个时刻运行。典型的例子就是一个会议的提醒，此时应用程序不需要运行起来。 <br/>
Push通知
*   从云端更新tiles，显示badges和toast
*   &#160;&#160;&#160;&#160;&#160; 及时应用程序不允许，也可以进行Push通知</p>

<p>&#160;&#160;&#160; Push通知是最强大和解耦的一种通知机制，但同时它的结构也非常的复杂。通过利用Windows Push Notification Service，push通知可以被分发到你的应用程序，消息的产生不是由你的应用程序决定的，而是由你自己的或者第三方的web services生成并进行内容的管理和分发。 <br/>
<strong>3、用例图表</strong> <br/>
&#160;&#160;&#160; 这里我做了一个用例图表，你可以看一下。需要注意的是：Badge通知类型并不能使用Scheduled分发方法。在这里我添加了一行表示那些分发方法需要应用程序是运行的（仅仅是local通知需要）。内容源这一行表示消息内容的生成地方。在local和scheduled通知中，内容的组装是有应用程序负责的，内容的源可能是应用程序自行处理或者从外部服务中轮训获取到；push通知则依赖于外部服务,使用pull和push方法,将数据提供给你的程序。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/4.jpg"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb.jpg" width="682" height="191" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/7/" class="prev">Prev</a>
    
    
        <a href="/blog/page/9/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">所有文章</a></div>
    
    <script type="text/javascript">
var duoshuoQuery = {short_name:"beyondvincent"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
</nav>

</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - 破船(BeyondVincent) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'beyondvincent001';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42893468-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1a3c98825a726bfbf68a83ba97e0b9be' type='text/javascript'%3E%3C/script%3E"));
    </script>

		</div>
	</div>
</body>
</html>
