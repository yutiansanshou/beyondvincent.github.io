
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>破船之家</title>
	<meta name="author" content="破船(BeyondVincent)">

	
	<meta name="description" content="Jun 3rd, 2013 Step by Step, Windows商店应用开发 Windows Store App开发[014]Step by Step已矣 引子： &#160;&#160;&#160;&#160;&#160; 最近在看村上春树的小说，书中有提到“任何一把剃刀都自有其哲学！” &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="破船之家" type="application/atom+xml">
	
	<link rel="canonical" href="http://BeyondVincent.github.io/blog/page/8/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("beyondvincent@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">破船之家</a></h1>
<p class="subtitle">宠辱不惊，闲看庭前花开花落<br>去留无意，漫随天外云卷云舒<br>不妄取，不妄予，不妄想，不妄求<br>与人方便，随遇而安</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/about">关于我</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/beyondvincent" title="Weibo">Weibo</a>
		
		
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav></header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/41/" itemprop="url">Windows Store App开发[014]Step by Step已矣</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>引子：</p>

<p>&#160;&#160;&#160;&#160;&#160; 最近在看村上春树的小说，书中有提到“任何一把剃刀都自有其哲学！”这是萨摩赛特.毛姆说过的一句话，意思大概是：无论何等微不足道的举动，只要日日坚持，从中总会产生出某些类似观念的东西来。能坚持做一件事，开始或许可以靠冲动或自律，时间长了能坚持下去肯定是从中找到了乐趣。</p>

<p>与大家共勉一下</p>

<p>BeyondVincent(破船)@2012.8.9</p>

<p>Windows 8 Metro App开发Step by Step到今天基本告一段落了，我们来回顾一下本系列涉及到的内容，算作Step by Step的一个收场吧。在以后的日子里，我也会与大家一起分享Windows 8 Metro App开发。</p>

<p>细心的读者，或许已经发现，本次Step by Step总结起来实际上分为5部分</p>

<p><strong>1、Windows 8 Metro App开发入门</strong></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91001%e5%b9%b3%e5%8f%b0%e7%ae%80%e4%bb%8b/"></a></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91001%e5%b9%b3%e5%8f%b0%e7%ae%80%e4%bb%8b/"><u>Windows Store App开发[001]平台简介</u></a></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91002%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba%e4%b8%8ehelloworld/"><u>Windows Store App开发[002]开发环境搭建与HelloWorld</u></a></p>

<p>&#160;</p>

<p><strong>2、基本控件AppBar, Flyout与NavBar的使用</strong></p>

<p><a href="http://beyondvincent.com/2013/05/31/windows-store-app%e5%bc%80%e5%8f%91003%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e6%a0%8fappbar%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[003]应用程序栏(AppBar)的使用</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/01/windows-store-app%e5%bc%80%e5%8f%91004%e5%bc%b9%e5%87%ba%e7%94%bb%e9%9d%a2flayouts/"><u>Windows Store App开发[004]弹出画面(Flayouts)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91005%e5%af%bc%e8%88%aa%e6%a0%8fappbar%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[005]导航栏(AppBar)的使用</u></a></p>

<p>&#160;</p>

<p><strong>3、数据绑定</strong></p>

<p><u>Windows Store App开发[007]视图模型与数据绑定</u></p>

<p>&#160;</p>

<p><strong>4、Layouts and Tiles布局与磁贴</strong></p>

<h4><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91008%e5%a4%84%e7%90%86fullscreen-snapped%e5%92%8cfilled%e7%8a%b6%e6%80%81/"></a></h4>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91008%e5%a4%84%e7%90%86fullscreen-snapped%e5%92%8cfilled%e7%8a%b6%e6%80%81/"><u>Windows Store App开发[008]处理Fullscreen, Snapped和Filled状态</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91009%e9%80%9a%e7%9f%a5%e6%a6%82%e8%bf%b0toasttile%e5%92%8cbadge/"><u>Windows Store App开发[009]通知概述(Toast,Tile和Badge)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91010%e9%80%9a%e7%9f%a5%e4%bd%bf%e7%94%a8toasttile%e5%92%8cbadge/"><u>Windows Store App开发[010]通知使用(Toast,Tile和Badge)</u></a></p>

<p>&#160;</p>

<p><strong>5、应用程序生命周期与合约</strong></p>

<h4><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91011%e6%b5%85%e8%b0%88windows-8-%e4%b8%ad%e7%9a%84%e5%90%88%e7%ba%a6contracts/"></a></h4>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91011%e6%b5%85%e8%b0%88windows-8-%e4%b8%ad%e7%9a%84%e5%90%88%e7%ba%a6contracts/"><u>Windows Store App开发[011]浅谈Windows 8 中的合约(contracts)</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%e5%bc%80%e5%8f%91012windows-8-%e4%b8%ad%e6%90%9c%e7%b4%a2%e5%90%88%e7%ba%a6%e7%9a%84%e4%bd%bf%e7%94%a8/"><u>Windows Store App开发[012]Windows 8 中搜索合约的使用</u></a></p>

<p><a href="http://beyondvincent.com/2013/06/03/windows-store-app%e5%bc%80%e5%8f%91013%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f/"><u>Windows Store App开发[013]应用程序生命周期</u></a></p>

<p>&#160;</p>

<p>最后上一个图，祝大家Happy Coding，顺结束这次Windows 8 Metro App开发之旅吧</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/1.jpg"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb.jpg" width="682" height="427" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-06-03</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-03T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/03/40/" itemprop="url">Windows Store App开发[013]应用程序生命周期</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>引子：</p>

<p>&#160;&#160;&#160;&#160;&#160; 在本系列学习文章刚开始的帖子<a href="http://www.devdiv.com/_DevDiv%E5%8E%9F%E5%88%9B_Windows_8_Metro_App%E5%BC%80%E5%8F%91_2_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8EHelloWorld-thread-130651-1-1.html">开发环境搭建与HelloWorld</a>中，我曾给大家简单的介绍了一下应用程序生命周期（应用程序的生命周期主要就是通过App.xaml.cs文件进行处理），但没有展开详细的介绍，随着学习的深入，开发的需求和增强用户体验，我们有必要熟悉应用程序的生命周期。</p>

<p>&#160;&#160;&#160; 我查阅了一下网络上的可用资源，有一些相关生命周期的资料，但是内容都出自微软的官方博客，由于官方博文中对此进行了详细的讲解，不仅有英文，中文的也有，非常值得我们学习。在此我就直接引用过来，供大家学习参考。在文章的最后，我会贴上一些有用链接。</p>

<p>本文章目录结构： <br/>
<strong>Metro 风格应用程序的生命周期</strong> <br/>
<strong>打造出色应用程序生存期体验的提示</strong> <br/>
<strong>结束语</strong></p>

<p>&#160;</p>

<p>&#160;</p>

<p><strong>管理应用程序生命周期，让应用程序始终充满“生命活力”</strong> <br/>
Windows 8 中的应用程序生命周期模型意味着用户无需再管理哪些应用程序正在运行。它还使开发人员能够轻松打造当应用程序在后台运行时不会影响设备的电池电量或性能的出色用户体验。使用新的生命周期事件，用户将感觉您的应用程序始终处于运行状态，即使它在位于屏幕之外时从不运行。 <br/>
如今，便携式计算机、平板电脑和手机上的电池电量经常不足，因为即使我们不使用应用程序，往往也会保持应用程序处于运行状态。我们这样做主要是为了方便使用和在应用程序之间实现快速切换。 <br/>
为 Windows 8 中的 Metro 风格应用程序开发生命周期模型时我们牢记以下几个方面：保持应用程序响应能力、节省电池电量并提供出色且一致的性能。Metro 风格应用程序关键在于全屏沉浸式体验。因此，Windows 8 中新的生命周期模型重点关注前台应用程序，确保积极主动的用户体验并充分实现设备的全部价值。在本博文中，我将带您浏览生命周期模型的新状态以及为了使应用程序出色运行您需要做的工作。 <br/>
<strong>Metro 风格应用程序的生命周期</strong> <br/>
在任意给定时间，您的 Metro 风格应用程序都处于以下四种生命周期状态之一：<strong>未运行</strong>、<strong>正在运行</strong>、<strong>已挂起</strong>或<strong>已终止</strong>。当应用程序在不同状态之间切换时，它会收到生命周期事件，这些事件可帮助您向用户提供一致且高性能的体验。 <br/>
下图显示了 Metro 风格应用程序如何在各状态之间切换：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/17.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb7.png" width="682" height="391" /></a></p>

<p>当用户启动 Metro 风格应用程序、在应用程序之间切换以及关闭应用程序时，所有这些应用程序都会经历这些状态。当用户在应用程序之间切换时，应用程序很可能频繁在<strong>正在运行</strong>和<strong>已挂起</strong>状态之间切换。因此，应用程序必须处理生命周期事件。 <br/>
当您的应用程序在各个生命周期状态之间切换时，它会收到以下生命周期事件：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://beyondvincent.com/wp-content/uploads/2013/06/image_thumb.png" width="636" height="172" /></a></p>

<p>&#160;</p>

<p><strong>挂起</strong> <br/>
通常情况下，Metro 风格应用程序会在用户切换到另一应用程序时停止运行。Windows 会挂起不在前台的应用程序。当您的应用程序挂起时，它在内存中处于冻结状态。处于此状态时，它无法运行，但如果用户返回该应用程序，Windows 可立即将其恢复。这样，Windows 就可以让前台应用程序更好地使用系统资源，并确保后台应用程序不会耗尽用户的电池电量。 <br/>
当您的应用程序离开前台时，Windows 会等待几秒钟以便能够快速切换回该应用程序，然后才尝试将其挂起。您的应用程序必须注册 <strong>suspending </strong>或 <strong>checkpoint </strong>(JavaScript) 事件，当 Windows 需要将其挂起时，它会收到这些事件。这是应用程序的重要时刻；可利用此机会保存必须保留在持久存储中的应用程序数据。通常，您的应用程序会按原样恢复，您不需要持久留存的数据，因为它们仍然在内存中。但您需要存储这些数据以防 Windows 为了释放系统资源而终止应用程序。保存足够的应用程序数据可让用户返回到当应用程序挂起时他们在应用程序中所处的位置。这样，您的客户就会感觉您的应用程序始终处于运行状态。 <br/>
如果应用程序没有在收到挂起事件后的 5 秒内从挂起事件处理程序中返回，Windows 会将其终止。切勿在挂起事件处理程序中执行任何繁重操作，这一点非常重要。应保存应用程序数据并快速返回。 <br/>
在本博文中，我们以股票应用程序为例。该应用程序可以使用挂起事件来保存用户上次查看的股票以及股价图的时间范围。这样一来，如果应用程序被终止，它就可以正好重新启动到用户上次查看该应用程序时所看到的同一视图。例如，针对股票应用程序的建议是，借此机会发送本地磁贴通知，以便在 Windows 挂起应用程序之前，应用程序的磁贴能够使用最新信息进行更新。 <br/>
<strong>在 JavaScript 中处理挂起</strong> <br/>
如果您使用 Windows JavaScript 库 (WinJS) 编写 Metro 风格应用程序，则可以使用 <strong>checkpoint </strong>事件处理挂起。</p>

<pre class="wp-code-highlight prettyprint linenums:1">var app = WinJS.Application;

function checkpointHandler() {
    // The checkpoint event gives us the chance to save application data.
    // In this case, we save the current stock info that the user is viewing.
    app.sessionState.lastSeenStock = selectedStock;
    app.sessionState.lastSeenRange = selectedRange;

    // Send client side notifications
    Tile.sendTileUpdate(selectedStock, stockInfo.change, stockInfo.lastSale, 
stockInfo.lastSaleTime, stockInfo.open); 
}

app.addEventListener(&quot;checkpoint&quot;, checkpointHandler);</pre>


<p>这只是一个概要。有关详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465138.aspx"><u>如何挂起应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理理挂起</strong></p>

<p>如果您使用 XAML 和 C# 编写 Metro 风格应用程序，则可以对应用程序对象使用 <strong>Suspending </strong>事件来处理应用程序挂起。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public App()
{
    InitializeComponent();
    this.Suspending += new SuspendingEventHandler(OnSuspending);
}

async protected void OnSuspending(object sender, SuspendingEventArgs args)
{
    // The Suspending event gives us the chance to save application state
    // In this case, we save the current stock info that the user is viewing

    // Because writing to a file is asynchronous, we grab a deferral which ensures
    // that suspending doesn’t complete until our file write is complete
    SuspendingDeferral deferral = args.SuspendingOperation.GetDeferral();

    // Here we create a SuspensionManager class which handles adding session data
    // to a Dictionary and then serializing that data to a file
    SuspensionManager.SessionState[&quot;lastSeenStock&quot;] = stock;
    SuspensionManager.SessionState[&quot;lastSeenRange&quot;] = range;
    await SuspensionManager.SaveAsync();

     // Send client side notifications
    Tile.SendTileUpdate(stock, stockInfo.Change, stockInfo.LastSale, 
stockInfo.LastSaleTime, stockInfo.Open);

    deferral.Complete();
}</pre>


<p>这同样只是一个概要。有关如何在 XAML 和 C# 中处理挂起的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465115.aspx"><u>如何挂起应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>恢复</strong></p>

<p>当应用程序恢复时，它将从 Windows 将其挂起它所处的状态继续进行。具体说就是：当应用程序挂起，应用程序数据和状态保留在内存中，因此当它恢复时，一切都保持它挂起时的状态。在收到 <strong>resuming </strong>事件时，您不需要明确还原任何已保存的数据。</p>

<p>但您希望您的应用程序看起来始终处于运行状态。为此，它必须保持连接并显示最新数据。但是在恢复之前，您的应用程序可能会在挂起状态停留很长时间。因此数据或网络连接可能会过时，在应用程序恢复时，可能需要刷新连接。当用户将您的应用程序切换到前台时，它会收到 <strong>resuming </strong>事件。您可以在应用程序收到此事件时刷新应用程序内容并重新连接网络资源。</p>

<p>在我们的示例股票应用程序中，将在恢复时刷新应用程序在挂起前所具有的所有缓存股票数据。之前的数据可能已存在数小时甚至数天之久。如果用户看到这些旧数据，他们就会意识到所用应用程序并非始终处于运行状态。因此在恢复时，我们的股票应用程序必须更新其所有数据。这样，应用程序每次切换到前台时，用户都会看到最新的股票价格、股价图和新闻文章。</p>

<p><strong>在 JavaScript 中处理恢复</strong></p>

<p>在 JavaScript 中，您可以在 <strong>Windows.UI.WebUI.WebUIApplication</strong> 命名空间中使用 Windows 运行时<strong>resuming </strong>事件。这是专门用于 JavaScript 应用程序的 resuming 事件。</p>

<pre class="wp-code-highlight prettyprint linenums:1">function resumingHandler() {
    //Update the selected stock with the latest news, stock info, and chart data
    News.requestNews(stock);
    Api.getStockInfoData(stock).then(function(data){displayStockInfo(data); });
    Api.getHistoryData(range).then(function (chartData) 
{CanvasChart.drawChart(&quot;chartCanvas&quot;, chartData, Chart.getChartOptions(false));});

    // Send client side notifications
    Tile.sendTileUpdate(stock, stockInfo.change, stockInfo.lastSale, 
stockInfo.lastSaleTime, stockInfo.open);    
        }

Windows.UI.WebUI.WebUIApplication.addEventListener(&quot;resuming&quot;, resumingHandler);</pre>


<p>有关详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465114.aspx"><u>如何恢复应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理恢复</strong></p>

<p>如果您使用 XAML 和 C# 编写 Metro 风格应用程序，则可以对应用程序对象使用 <strong>Resuming </strong>事件来处理应用程序恢复。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public App()
{
    InitializeComponent();
    this.Resuming += new EventHandler&lt;object&gt;(App_Resuming);
}

        async private void App_Resuming(object sender, object e)
        {
            //Update the selected stock with the latest news, stock info, and chart data
            News.RequestNews(stock);

            Data data = await Api.GetStockInfoDataAsync(stock);
            Api.DisplayStockInfo(data);

            Chart chartData = await Api.GetHistoryDataAsync(range);
            CanvasChart.DrawChart("chartCanvas", chartData, Chart.GetChartOptions(false));

            // Send client side notifications
    Tile.SendTileUpdate(stock, stockInfo.Change, stockInfo.LastSale, stockInfo.LastSaleTime, stockInfo.Open);
        }
</pre>


<p></p></p>

<p></object></p>

<p>有关如何在 VB/C#/C++ 和 XAML 中处理恢复的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465110.aspx"><u>如何恢复应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>激活</strong></p>

<p>激活与您应用程序的启动方式息息相关。在 Metro 风格应用程序中它起到多方面的作用。有关如何使用 Metro 风格应用程序激活处理合约的更多详细信息，请参阅我们之前的博文<a href="http://blogs.msdn.com/b/windowsappdev_cn/archive/2012/03/30/windows-8-activating-contracts.aspx"><u>在您的应用程序中激活 Windows 8 合约</u></a>。本文中我们重点介绍当 Windows 终止您的应用程序，随后用户又重新启动它时，如何使用激活来还原之前保存的数据。</p>

<p>Windows 可能会出于多个原因终止已挂起的应用程序。例如：用户手动关闭应用程序或注销，或者系统的资源不足（诸如游戏之类的应用程序可能需要大量资源！）。如果用户在 Windows 终止应用程序后启动应用程序，它会收到 <strong>activated </strong>事件，用户会看到应用程序的初始屏幕，直到应用程序被激活。您可以使用此事件确定应用程序是否需要还原上次挂起时保存的数据，或者您是否必须加载应用程序的默认数据。<strong>activated </strong>事件参数包含一个 <strong>PreviousExecutionState </strong>属性，该属性会告诉您在激活之前应用程序所处的状态。该属性的值是 <strong>Windows.ApplicationModel.Activation.ApplicationExecutionState</strong> 枚举值之一。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/image1.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://beyondvincent.com/wp-content/uploads/2013/06/image_thumb1.png" width="686" height="206" /></a></p>

<p><strong>PreviousExecutionState </strong>的值还可以是 <strong>Running </strong>或 <strong>Suspended</strong>，但在这些情况下，您的应用程序之前并未终止，因此您不必考虑是否需要还原数据。</p>

<p>当应用程序已激活并且其 <strong>PreviousExecutionState </strong>值为 <strong>Terminated </strong>时，您必须还原已保存的会话数据，以使应用程序完全保持用户上次看到的样子。如果用户手动关闭应用程序、应用程序意外终止或者在当前会话中尚未运行，则您必须忽略之前的会话数据并使用默认视图启动应用程序。</p>

<p>我们的示例股票应用程序使用 <strong>activated </strong>事件重新显示挂起时所保存的股票和股价图信息。该应用程序还刷新其缓存的网络数据。这样，用户看到的就是他们离开该应用程序时所查看的股票，但股票价格、股价图和新闻文章全都是最新的。</p>

<p><strong>在 JavaScript 中处理激活</strong></p>

<p>如果您使用 Windows JavaScript 库 (WinJS) 编写 Metro 风格应用程序，则可以使用 <strong>activated </strong>事件处理激活。</p>

<p>在 <strong>activated </strong>事件处理程序代码中，您的应用程序可以检查 <strong>sessionState </strong>对象，以确定它是应加载保存的数据，还是应显示默认主页视图。<strong>SessionState </strong>通过检查 <strong>eventArgs.detail.previousExecutionState</strong> 自动确定应用程序上次的状态。如果 <strong>sessionState </strong>已填充，则使用它还原会话数据，否则使用应用程序的默认数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">var app = WinJS.Application;

function activatedHandler(eventArgs) {
    if (eventArgs.detail.kind == Windows.ApplicationModel.Activation.ActivationKind.launch) {
        // Check whether the session state variables are valid.
        // If so, retrieve the stock and range values saved in the checkpoint handler
        if (app.sessionState) {
            stock = app.sessionState.lastSeenStock;
            range = app.sessionState.lastSeenRange;
        } 
        // If not, use the app&#039;s default values
        else{
            stock = &quot;DOW&quot;;
            range = &quot;1M&quot;;           
        }

        // Initialize the WinJS controls asynchronously behind the app splash screen
        // Start retrieving the latest stock data asynchronously after the controls are ready
        eventObject.setPromise(WinJS.UI.processAll().then(function() {
            Api.initializeUserStocks();
        }));
    }
}

app.addEventListener(&quot;activated&quot;, activatedHandler);</pre>


<p>有关如何在 JavaScript 中处理激活的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh465102.aspx"><u>如何激活应用程序（JavaScript 和 HTML）</u></a>。</p>

<p><strong>在 XAML 中处理激活</strong></p>

<p>在使用 XAML 和 C# 的 Metro 风格应用程序中，您可以替代 <strong>OnLaunched </strong>事件来处理从磁贴基本激活应用程序。</p>

<p>在 <strong>OnLaunched </strong>事件处理程序代码中，您的应用程序可以检查事件参数上的 <strong>PreviousExecutionState</strong>。如果它等于 <strong>Terminated</strong>，则还原您在 <strong>Suspending </strong>事件中保存的数据。如果是其他值，则使用应用程序的默认数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">async protected override void OnLaunched(LaunchActivatedEventArgs args)
        {
    // Check whether the session data should be restored
            if (args.PreviousExecutionState == ApplicationExecutionState.Terminated)
            {
                // Here we&#039;ve created a SuspensionManager class which handles restoring session
                // data from a file and then gives access to that data through a Dictionary
                await SuspensionManager.RestoreAsync();

// Retrieve the stock and range values saved in the suspend handler 
stock = SuspensionManager.SessionState[&quot;lastSeenStock&quot;];
                range = SuspensionManager.SessionState[&quot;lastSeenRange&quot;];
            }
            // If not, use the app&#039;s default values
            else
            {
                stock = &quot;DOW&quot;;
                range = &quot;1M&quot;;
            }

    // Start retrieving the latest stock data
            Api.InitializeUserStocks();

            Window.Current.Activate();
        }</pre>


<p>有关如何在 XAML 中处理激活的详细信息，请参阅开发中心中的<a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465093(v=win.10).aspx"><u>如何激活应用程序（VB/C#/C++ 和 XAML）</u></a>。</p>

<p><strong>打造出色应用程序生存期体验的提示</strong></p>

<p>现在您已了解了所有基础知识，下面是一些可帮助您为应用程序打造出色生存期体验以便在用户看来应用程序始终处于活动和最新状态的一些提示。</p>

<p><strong>有时最好重新开始</strong></p>

<p>如果自用户上次查看应用程序已过了很长时间，有时最好将应用程序重置为其默认视图。多久才算很久完全由您决定，但如果应用程序的内容看起来陈旧或过时，则建议您将应用程序恢复为其主页视图。这会使应用程序在用户看来更加智能。</p>

<p>例如，如果您要构建一个新闻阅读器应用程序，在用户从该应用程序切出后，它可能会被挂起。过了一段时间后，当用户回到新闻阅读器应用程序时，应用程序将会恢复。在恢复处理程序中，检查当前文章已存在多长时间，以确定它现在是否已过时。如果文章太旧，则显示默认主页视图而不是旧文章。</p>

<p><strong>在正确的时间保存正确的数据</strong></p>

<p>在应用程序的整个生命周期中，始终以增量方式保存重要数据。由于应用程序只有最多五秒的时间来运行挂起事件处理程序代码，因此您需要确保在应用程序挂起时，您的重要应用程序数据已保存到持久存储。</p>

<p>在编写应用程序时，您需要管理以下两种类型的数据：<strong>会话数据</strong>和<strong>用户数据</strong>。会话数据是应用程序中与用户的当前体验相关的临时数据。例如，用户正在查看的当前股票、用户正在 eBook 中阅读的当前页面或一个很长的项目列表中的滚动位置。用户数据是持久性的，必须始终可供用户访问，无论它们是什么。例如，用户正在键入的进行中文档、在应用程序中拍摄的照片或用户在游戏中的进度。</p>

<p>确保在应用程序挂起时，它已将这两种数据类型保存到持久存储。</p>

<p><strong>还原会话数据</strong></p>

<p>用户希望 Metro 风格应用程序通常保持他们上次使用它时所处的状态。从开发人员的角度看，当您的应用程序从挂起状态恢复或从未运行状态激活时，还原之前保存的会话数据通常是合理的。</p>

<p>例如，如果您的应用程序包括购物车功能，并且用户向购物车中添加商品后从应用程序中切出，那么在用户恢复或重新激活该应用程序时维护购物车中的那些商品应该是有意义的。</p>

<p>再举一个例子，假设某应用程序显示新闻文章。如果用户之前正在查看某特定文章，然后切换到另一应用程序，用户会希望当他们回到您的应用程序中时，他们能够看到之前正在查看的文章。</p>

<p><strong>释放挂起事件处理程序中的独占资源</strong></p>

<p>如果应用程序在执行过程中获取了任何独占资源（例如文件句柄或外部设备引用），那么它在收到<strong>suspending</strong> 事件时则必须释放这些资源。此外，如果您的应用程序需要使用这些独占资源才能继续运行，那么在收到 <strong>resuming</strong> 事件时，则必须回收这些资源。</p>

<p><strong>不要关闭应用程序！</strong></p>

<p>Windows 8 中的 Metro 风格应用程序永远不能将其自身关闭或者提供应用程序用户界面让用户关闭您的应用程序。挂起和终止应用程序由 Windows 代表用户进行处理，以维护系统性能和电池寿命。如果用户想要关闭您的应用程序，他们可以通过从屏幕顶部向屏幕底部滑动或者按 Alt＋F4 来实现。</p>

<p><strong>结束语</strong></p>

<p>通过使用 <strong>suspending</strong>、<strong>resuming</strong> 和 <strong>activated</strong> 这三个事件，对用户而言，您的应用程序看起来始终处于活动状态。但与此同时，在用户不使用应用程序时，它永远不会不必要地耗尽电池电量或降低系统性能。在设备越来越紧凑、移动性越来越强的世界里，新的 Metro 风格应用程序生命周期使您的应用程序在任何设备上都能大放异彩。</p>

<p>本博文链接：</p>

<p>&#160;</p>

<p>本博文链接：</p>

<p>中文版：<a href="http://blogs.msdn.com/b/windowsappdev_cn/archive/2012/04/16/managing-app-lifecycle.aspx"><u>管理应用程序生命周期，让应用程序始终充满“生命活力”</u></a></p>

<p>英文版：<a href="http://blogs.msdn.com/b/windowsappdev/archive/2012/04/10/managing-app-lifecycle-so-your-apps-feel-quot-always-alive-quot.aspx"><u>Managing app lifecycle so your apps feel &ldquo;always alive&rdquo;</u></a></p>

<p>msdn上的一篇文章：应用程序生命周期（Metro style apps）</p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464925.aspx"><u>Application lifecycle (Metro style apps)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465093(v=win.10).aspx"><u>How to activate an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Hh465115(v=win.10).aspx"><u>How to suspend an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465110.aspx"><u>How to resume an app (Metro style apps using C#/VB/C++ and XAML)</u></a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/39/" itemprop="url">Windows Store App开发[012]Windows 8 中搜索合约的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在<a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91011%E6%B5%85%E8%B0%88windows-8-%E4%B8%AD%E7%9A%84%E5%90%88%E7%BA%A6contracts/" target="_blank"><u>上一篇</u></a>文章，我给大家介绍了Windows 8中的合约，如果你还没有看的话，建议你先去阅读一下。在本篇文章中，我将利用搜索合约，来跟大家介绍合约的使用。为了演示的方便，本次示例我使用下面这篇文章中的示例进行改进。</p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91007%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/" target="_blank"><u>Windows Store App开发[007]视图模型与数据绑定</u></a></p>

<p>本文的内容结构如下：</p>

<p>1、搜索合约的声明</p>

<p>2、搜索的激活</p>

<p>3、提交查询的候选项</p>

<p>4、运行效果和示例代码</p>

<p>&#160;</p>

<p><strong>1、搜索合约的声明</strong></p>

<p>&#160;&#160; 我们打开上面提到的示例程序，并打开Package.appxmanifest文件，选择声明选项卡，如下图，并找到选择搜索声明，然后添加:</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/16.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb6.png" width="682" height="453" /></a></p>

<p>然后我们部署应用程序到计算机上。部署完毕之后，按Windows+Q组合键，可以看到，我们的示例程序：搜索合约测试已经在搜索面板中了。如果这里不添加搜索声明的话，在搜索面板中是看不到的。如下两图所示(左图是已经添加搜索声明的，右图则是没有添加)</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/26.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb7.png" width="652" height="665" /></a></p>

<p><strong>2、搜索的激活</strong> <br/>
&#160;&#160;&#160; 打开App.xml.cs文件，在其中添加如下函数</p>

<pre class="wp-code-highlight prettyprint linenums:1">protected override void OnSearchActivated(SearchActivatedEventArgs args)
{
    viewModel.SearchAndSelect(args.QueryText);
}</pre>


<p>当应用程序以显示搜索结果为目的被激活时，该方法会被调用，也就是说，从搜索面板中输入内容，然后回车可以激活该方法。</p>

<p>在这里，我把viewModel的位置放到App里面了，这样方便调用。在viewModel方法中我添加了一个方法SearchAndSelect，该方法用于搜索内容。代码如下：该代码的左右就是查找出ForumItemList 中name与搜索内容符合的字段，并记录相关的index。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public void SearchAndSelect(string searchTerm)
{
    int selIndex = -1;
    for (int i = 0; i &lt; ForumItemList.Count; i++)
    {
        if (ForumItemList.Name.ToLower().Contains(searchTerm.ToLower()))
        {
            selIndex = i;
            System.Diagnostics.Debug.WriteLine(ForumItemList.Name);
            break;
        }
    }
    SelectedItemIndex = selIndex;
}</pre>


<p>为了在界面上让搜索命中相选中，我还对SelectedItemIndex进行了监听，如果发生改变则界面先择也相应的进行改变，如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">viewModel.PropertyChanged += (sender, args) =&gt;
{
    if (args.PropertyName == &quot;SelectedItemIndex&quot;)
    {
        ForumList.SelectedIndex = viewModel.SelectedItemIndex;
    }
};</pre>


<p>这样，当SelectedItemIndex 改变的时候，界面上的选中项也会发生改变。</p>

<p><strong>3、提交查询的候选项</strong></p>

<p>&#160;&#160;&#160; 为了加强用户体验，方便用户选择搜索内容，我们可以在搜索面板添加一些搜索的候选项。当用户在输入内容的时候，按照一定的规则，给用户列出适合的内容。</p>

<p>&#160;&#160;&#160; 首先需要做的事情就是监听SuggestionRequested事件，当用户开始在搜索框中输入内容时，就会触发该事件。那么我们可以通过下面的代码进行注册：注意在这里需要增加using Windows.ApplicationModel.Search;否则会出现错误。</p>

<pre class="wp-code-highlight prettyprint linenums:1">SearchPane.GetForCurrentView().SuggestionsRequested += searchPane_SuggestionsRequested;</pre>


<p>当SuggestionRequested事件来的时候，我们就可以发送候选项建议了。就像查询一样，候选项内容可以来自网络服务，或者自行组合，在这里为了演示目的，我从ForumItemList中获取内容，在SearchPageSuggestionsRequestedEventArgs实例中，我们可以把候选项添加到SearchSuggestionCollection中，SearchSuggestionCollection中的内容会显示在搜索面板中。因为当用户每次输入内容的时候，该方法都会被调用，因此一定要注意该函数的编写。下面是我的代码：</p>

<p>&#160;&#160;&#160; 需要注意的是搜索面板只能显示最多5个候选项</p>

<pre class="wp-code-highlight prettyprint linenums:1">void searchPane_SuggestionsRequested(SearchPane sender, SearchPaneSuggestionsRequestedEventArgs args)
{
    foreach (ForumItem forumItem in viewModel.ForumItemList)
    {
        string suggestion = forumItem.Name;

        if (suggestion.StartsWith(args.QueryText, StringComparison.CurrentCultureIgnoreCase))
        {
            args.Request.SearchSuggestionCollection.AppendQuerySuggestion(suggestion);
        }
        if (args.Request.SearchSuggestionCollection.Size &gt;= 5)
        {
            break;
        }
    }
}</pre>


<p>这样我们就成功的在程序中实现了搜索合约功能。下面我们看看运行效果</p>

<p><strong>4、运行效果和示例代码</strong></p>

<p>实运行程序，调出搜索面板（Windows键+Q），输入W字母，看到如下效果图，在右边列出了以W开头的两个候选项</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/37.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb7.png" width="682" height="427" /></a></p>

<p>选择第二项：Windows 8 开发论坛，此时左边的对应项会被选中，如下图所示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/45.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb5.png" width="682" height="427" /></a></p>

<p>到此，搜索合约的讲解就结束了，欢迎大家的阅读。</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SearchContract" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/38/" itemprop="url">Windows Store App开发[011]浅谈Windows 8 中的合约(contracts)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Windows 8 Metro App开发中，你很快就会使用到合约功能，合约是Windows 8中至关重要的全新概念，作为Metro开发者，有必要掌握。目前关于合约的相关资料还比较少，在这里，我主要参考了msdn提供的一些文档，写此贴的目的是希望大家对合约有一个初步的了解，同时也欢迎大家来交流。</p>

<p>&#160;&#160;&#160;&#160;&#160; 在这篇文章中，我主要对合约进行一个概述。在下一篇文章中，我会通过编程的方式，向大家介绍如何使用合约。</p>

<p>本文，我主要介绍如下内容：</p>

<p>1、合约概述</p>

<p>2、合约类型</p>

<p>&#160;</p>

<p><strong>1、合约概述</strong></p>

<p>Metro 风格的应用程序使用合约来声明它们支持哪些与其他应用程序和 Windows 进行的交互。对于其中的一些合约，您可能早有耳闻，如“搜索”合约和“共享”合约。通过各种合约，应用程序不仅可以通过与系统协作来提高运行速度，而且在用户安装了多个实施合约的应用程序时，它们还可以彼此配合来保持良好的运行状态。</p>

<p>合约：针对特定目的启动 Metro 风格的应用程序（包含上下文）</p>

<p>&#160;&#160;&#160; Windows 8 合约发挥着纽带的作用，它可以将您的应用程序与其他 Metro 风格的应用程序以及系统 UI 相关联。例如，“文件打开选取器”合约允许用户将文件从一个应用程序导入到另一个。使用“搜索”合约，用户能够在系统中的任意位置搜索应用程序，并在多个应用程序之间快速传输查询。在这些案例以及许多其他合约定应用场景中，Windows 都需要具备可通过应用程序 UI 启动应用程序的功能，这样用户才能快速高效地完成特定任务。这正是我们的激活平台和 API 发挥其作用的平台。</p>

<p>&#160;&#160;&#160; Windows 8已经定义了一些合约。最重要的合约有：搜索合约（search contract）、共享合约（share contract）、设置合约（settings contract）和App To App picker合约。这里也有更多的何用合约，在应用中使用这些合约时，一定要注意用户体验。</p>

<p>下面我们就来分别看看Windows 8中的合约类型。</p>

<p>&#160;</p>

<p><strong>2、合约类型</strong></p>

<p>&#160;&#160;&#160; 在介绍合约之前，先跟大家分享一个热键组合——Windows键+C键（或将鼠标移到屏幕的最右上角或右下角），就可以启动系统的Charm面板，Charm面板里面有搜索、共享、设定等相关功能，这些功能与下面介绍的合约有密切关系。</p>

<p>接下来，我们对各种合约进行初步的认识：</p>

<p>Search contract</p>

<p>&#160;&#160;&#160; Search contract 可以用来建立针对 Metro Style Apps 中内容的搜索功能。我们可以轻松的使用Search contract ，让用户能直接通过 Windows 8 里的 Search Charm 对我们开发的 Metro Style Apps 的内容里的字符串或是文字进行查找。</p>

<p>&#160;&#160;&#160; 一旦我们的 App 实现了Search contract，当使用者打开 Windows 8 的 Search Charm 时，我们的 App 就会出现在右下方的 Apps 列表，使用者就可以直接在该接口点选我们的 App 的 Icon，针对我们的 App 中的数据内容进行s搜索，如此一来，我们也不用特别去多花心思去为我们的每一个 App 设计个自的搜索接口，一切都交给 Windows 8 的 Search Charm 就行了。</p>

<p>&#160;&#160; 不过，通过Search contract 并不能针对 App 中特定文件的内容进行搜索，如果要实现特定文件内容的搜索的话，就得自己在 App 中写搜索的接口和相关逻辑开启 Windows 8 内置的 Search 面版热键为 Windows键 + Q键</p>

<p>Share contract <br/>
&#160;&#160;&#160; Share contract 比较特别的地方是，它有「来源端 App」及「目标端 App」。如果我们开发的 Metro Style Apps 里会有文档可以当作数据源给其他的 Metro Style Apps 使用，那么这个 App 就会是来源端 App；相反的，如果我们的 Metro Style Apps 允许接受其他 Metro Style Apps 的数据作为数据的输入来源的话，这个 App 就是目标端 App，可以借助Share Target contract 来操作让它可以透过 Share Charm 接受其他 App 的数据源的功能。通过 Share Contract，我们就能使用 Windows 8 的 Share Charm，让用户更轻松的进行数据间的分享及传递了。 <br/>
开启 Windows 8 内置的 Share 面版的热键为 Windows 键 + H 键。 <br/>
Settings contract <br/>
&#160;&#160;&#160; 通过 Settings contract功能，我们可以让用户通过 Windows 8 的 Settings Charm 来针对我们开发的 Metro Style Apps 进行设定，如此一来，我们不用费心去特别设计一个设定专用的画面，其次，整个用户体验也和操作系统本身更为贴近。 <br/>
开启 Windows 8 内置的 Settings 面版的热键为 Windows 键 + I 键。 <br/>
Play To contract <br/>
&#160;&#160;&#160; 通过 Play To contract，我们可以轻松的让用户在我们开发的 Metro Style Apps 中进行播放的影片、音乐或是相片等等媒体文件，以串流的方式，通过兼容于 DLNA 的装置进行播放。若操作系统侦测到有支持相关功能的其他装置，会自动将那些装置显示在 Devices Charm 里，而我们就可以通过 Play To 功能，将媒体以串流的传输方式传送过去。 <br/>
开启 Windows 8 内置的 Devices 面版的热键为 Windows 键 + K 键。 <br/>
App to App Picking contract <br/>
&#160;&#160;&#160; 我们可以通过 App to App Picking contract，让我们的 App 开启文件系统、网络上或是其它在线服务中的文件，甚至使某个 App 具备能通过其他 App 进行浏览或是开启特定类型文件的能力；除此之外，使用者在开启特定类型文件时，也可以自行决定要使用哪一个 App 来开启。 <br/>
更多的合约类型参考下面的链接： <br/>
<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464906.aspx"><u>App contracts and extensions (Metro style apps)</u></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/37/" itemprop="url">Windows Store App开发[010]通知使用(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在我写的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a>中，我概述了Windows 8 中的通知，介绍了通知的类型（tile，toast和badges），以及通知的分发机制(local，scheduled和push)。在这一篇帖子中，我将以编程者的角度来给大家介绍我目前对通知的了解情况，希望能够起到抛砖引玉的作用，更多功能还需要等待你来实现。</p>

<p>&#160;&#160;&#160; 注：1、本次主要以代码的形式来讲解通知的使用</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2、本次讲解的通知分发方法为local[关于分发方法，请参考我的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a></p>

<p>通过本次的学习，你将初步掌握如下内容：</p>

<p>1、准备工作</p>

<p>2、Toast通知的使用</p>

<p>3、Tile通知的使用</p>

<p>4、Badge通知的使用 <br/>
5、最后附上程序相关代码工程</p>

<p>&#160;</p>

<p><strong>1、准备工作</strong></p>

<p>&#160;&#160;&#160; a) 首先以Blank App创建一个应用程序。然后打开Package.appxmanifest文件，按照下面图中的标准，制作了3个图片，并添加到工程中。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/15.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb5.png" width="682" height="183" /></a></p>

<p>&#160;</p>

<p>b) 获取 NotificationsExtensions 库</p>

<p>&#160;&#160;&#160; 由于Tile、Toast和Badge使用的都是xml模版，为了简化对xml的操作，这里我们可以使用NotificationsExtensions对象库模型，它提供磁贴、锁屏提醒和 Toast 通知 XML 模板内容，而无需直接使用 XML 文档对象模型 (DOM)。 当你在 Microsoft Visual Studio 中使用此库时，你可以获得下列好处：</p>

<ul>
<li>智能感知，它将可用的通知 XML 标记和属性列为对象属性。这样，开发人员将无需参考架构文档来获取有关元素和结构的信息。</li>
<li>工厂函数，可通过该函数来创建主干通知。然后，你可以用你的内容填充这些通知。</li>
<li>一种在你的通知负载中同时包括方形和加宽磁贴版本（这是最佳做法！）的简化方式。</li>
<li>一种查找和填充文本和图像属性的有用方式。可通过它们的名称来获取有关它们在模板中的预期使用、大小或位置的更多信息。</li>
</ul>


<p>具体的使用操作说明微软的官网上有详细内容，我就不细说了，参考下面的链接：</p>

<p><a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/hh969156.aspx"><u>使用 NotificationsExtensions 填充锁屏提醒、磁贴和 Toast 模板</u></a></p>

<p>这里我就默认你已经按照上面链接给出的操作步骤，完成了对NotificationsExtensions库的引用。</p>

<p>&#160;</p>

<p><strong>2、Toast通知的使用</strong></p>

<p>&#160;&#160;&#160; 先上相关代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void sendToast(object sender, RoutedEventArgs e)
{
    IToastNotificationContent toastContent = null;
    IToastText01 templateContent = ToastContentFactory.CreateToastText01();
    templateContent.TextBodyWrap.Text = &quot;今天去游泳！(BeyondVincent|破船|)&quot;;
    toastContent = templateContent;
    ToastNotification toast = toastContent.CreateNotification();
    ToastNotificationManager.CreateToastNotifier().Show(toast);
}</pre>


<p>看上面的代码，通过使用NotificationsExtensions库提供的IToastNotificationContent类，我们可以方便的创建出一个ToastNotification，然后在利用ToastNotificationManager该语句ToastNotificationManager.CreateToastNotifier().Show(toast); 将Toast通知显示出来。显示效果如下图所示：</p>

<p>显示在屏幕的右上角</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/25.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb6.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p>关于Toast通知需要注意的是：需要在Package.appxmanifest中将是否支持Toast通知设置为是，如下图</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/36.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb6.png" width="654" height="676" /></a></p>

<hr />

<p><strong>3、Tile通知的使用</strong></p>

<p>微软提供了好多Tile模版供我们使用，这里已经给出了详细的介绍，大家可以前去学习了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761491"><u>Choosing a tile template</u></a></p>

<p>在这里我用了两种方式更新Tile：纯文本（ ITileWideText03&#160; ITileWideText04）和web图片（ITileSquareImage）</p>

<p>&#160;&#160;&#160; 先上纯文本代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void UpdateTileWithText()
{
    ITileWideText03 tileContent = TileContentFactory.CreateTileWideText03();
    tileContent.TextHeadingWrap.Text = &quot;你有三条未读短信！&quot;;

    ITileSquareText04 squareContent = TileContentFactory.CreateTileSquareText04();
    squareContent.TextBodyWrap.Text = &quot;你有三条未读短信！&quot;;
    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>看上面的代码，在这里同样使用NotificationsExtensions库提供的功能，很方便的创建出Notification，然后使用最后一行代码将其更新。</p>

<p>使用web图片代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateTileWithWebImage()
{
    ITileWideImageAndText01 tileContent = TileContentFactory.CreateTileWideImageAndText01();

    tileContent.TextCaptionWrap.Text = &quot;高清：撑杆跳伊辛巴耶娃4米70无缘奥运三连冠&quot;;

    tileContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    tileContent.Image.Alt = &quot;Web image&quot;;

    ITileSquareImage squareContent = TileContentFactory.CreateTileSquareImage();

    squareContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    squareContent.Image.Alt = &quot;Web image&quot;;

    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>如果我们要清除Tile信息，则调用下面的代码即可</p>

<pre class="wp-code-highlight prettyprint linenums:1">TileUpdateManager.CreateTileUpdaterForApplication().Clear();</pre>


<p>运行效果如下图：</p>

<p>文字：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/44.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb4.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/52.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb2.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>4、Badge通知的使用 </strong></p>

<p>&#160;&#160;&#160; 微软也提供了badge相关的详细介绍以及图标，建议参考下面的链接，进行了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh779719"><u>Badge overview (Metro style apps)</u></a></p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761458"><u>Choosing a badge image</u></a></p>

<p>下面我继续上代码，这里我同样用两种方式展现badge的使用（数字和图片）</p>

<p>先上数字的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithNumber(int number)
{
    BadgeNumericNotificationContent badgeContent = new BadgeNumericNotificationContent((uint)number);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>代码很简单，我就不表了。</p>

<p>再上图片的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithGlyph(GlyphValue index)
{
    BadgeGlyphNotificationContent badgeContent = new BadgeGlyphNotificationContent(index);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>同样不细表，如果大家在使用过程中遇到什么问题，可以跟帖进行讨论。</p>

<p>下面是清除badge通知内容的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">BadgeUpdateManager.CreateBadgeUpdaterForApplication().Clear();</pre>


<p>很简单吧。那我就来上两个允许效果图：</p>

<p>数字：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/61.png"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb1.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/7.png"><img title="7" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>5、最后附上程序相关代码工程</strong></p>

<p>下图是程序主界面图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/8.png"><img title="8" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="8" src="http://beyondvincent.com/wp-content/uploads/2013/06/8_thumb.png" width="682" height="410" /></a> </p></p>

<p>&#160;</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/Notifications" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/36/" itemprop="url">Windows Store App开发[009]通知概述(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在开始屏幕上，瓷贴是一个应用程序主要的展现。为了使开始屏幕充满活力，让用户看到的东西可以一目了然（这也是metro 风格的主要目的），你可以在瓷贴上添加通知，当然也可以单独使用它们。</p>

<p>通过本次的学习，你将掌握如下内容：</p>

<p>1、通知的类型</p>

<p>2、通知的分发方法</p>

<p>3、用例图表</p>

<p>&#160;</p>

<p><strong>1、通知的类型</strong></p>

<p>&#160;&#160;&#160; 这里主要有三种通知类型：Toast通知、Tile通知和Badge通知。下面我们就来分别了解一下它们各自的特性。</p>

<p>Toast通知</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/14.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb4.png" width="321" height="77" /></a></p>

<p>Toast通知实际上并不是新特征了，在微软的Outlook或者一些社交类客户端应用程序中都可以看到Toast的身影。Toast通知主要用于：时间敏感的个人信息，例如朋友发来了一条消息。Toast通知暗示有一个事件或者内容需要你关注，当点击toast时会启动应用程序，并进入到与通知信息相关的画面。一定要记住：Toast通知可能会丢失或者被用户关闭，所以不能用来当做一种保证交付机制使用。Windows 8 中的Toast通知可以出现在其它程序中，开始屏幕上或者桌面（desktop）。</p>

<p>&#160;</p>

<p>Tile通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/24.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb5.png" width="210" height="102" /></a></p>

<p>Tile通知显示在开始屏幕上，所以对于没有运行的程序，这类通知更加有用（当然，当程序在运行的时候，用户是不喜欢来看开始屏幕上的Tile通知）。Tile通知是Windows 8和Windows Phone特有的通知，它们看起来一目了然——用户可以快速的查看最新e-mail的主题，看到当前天气情况，检查收藏的股票信息。这一切信息的获取都不需要启动应用程序。</p>

<p>&#160;</p>

<p>Badge通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/35.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb5.png" width="104" height="108" /></a></p>

<p>Badge被认为是Tile通知的特殊类型。badge通知可以显示eleven glyphs或者从1到99之间任意的一个数字，显示的位置在tile的右下角。如上图中数字badge通知在Windows Store tile中，表示有1个可以更新的程序。如果是媒体播放器，可以使用不同的字形（eleven glyphs）来表示播放器是暂停或者播放中。</p>

<p>&#160;</p>

<p><strong>2、通知的分发方法</strong> <br/>
&#160;&#160;&#160; 有三种重要的分发方法：Local通知，Scheduled通知和Push通知，下面我们也来看看各自的特点 <br/>
Local通知</p>

<ul>
<li>只有当程序运行的时候可以使用</li>
<li>&#160;&#160;&#160;&#160; 主要用于更新tiles和badges</li>
</ul>


<p>&#160;&#160;&#160;&#160;&#160; Local通知是由运行的程序触发的，用于通知用户应用程序状态当前发生的变化，或者有感兴趣的新内容，这些都是有应用程序本身负责生成或者发现的。 <br/>
Scheduled通知
*   在某个精确的时间点使用toast通知或者tile通知</p>

<p>&#160;&#160;&#160;&#160;&#160; 开发者可以让Scheduled通知使用local通知在将来某一个时刻运行。典型的例子就是一个会议的提醒，此时应用程序不需要运行起来。 <br/>
Push通知
*   从云端更新tiles，显示badges和toast
*   &#160;&#160;&#160;&#160;&#160; 及时应用程序不允许，也可以进行Push通知</p>

<p>&#160;&#160;&#160; Push通知是最强大和解耦的一种通知机制，但同时它的结构也非常的复杂。通过利用Windows Push Notification Service，push通知可以被分发到你的应用程序，消息的产生不是由你的应用程序决定的，而是由你自己的或者第三方的web services生成并进行内容的管理和分发。 <br/>
<strong>3、用例图表</strong> <br/>
&#160;&#160;&#160; 这里我做了一个用例图表，你可以看一下。需要注意的是：Badge通知类型并不能使用Scheduled分发方法。在这里我添加了一行表示那些分发方法需要应用程序是运行的（仅仅是local通知需要）。内容源这一行表示消息内容的生成地方。在local和scheduled通知中，内容的组装是有应用程序负责的，内容的源可能是应用程序自行处理或者从外部服务中轮训获取到；push通知则依赖于外部服务,使用pull和push方法,将数据提供给你的程序。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/4.jpg"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb.jpg" width="682" height="191" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/35/" itemprop="url">Windows Store App开发[008]处理Fullscreen, Snapped和Filled状态</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Windows 8 Metro App中定义了三种视图状态：full screen, snapped, filled。这三种状态在程序中都比较常见，也会经常用到，在这里我就跟大家分享一下相关视图状态的知识点。</p>

<p>&#160;&#160;&#160; 通过本次学习，你将掌握以下内容：</p>

<p>1、视图状态的介绍</p>

<p>2、如何在程序中实现三种视图状态的切换</p>

<p>3、最后附上程序运行截图和程序</p>

<p>&#160;</p>

<p>1、视图状态的介绍</p>

<p>&#160;&#160;&#160; 在Windows 8 Metro App中，我们可以处理三种视图状态：full screen, snapped, filled。</p>

<p>full screen是Metro App默认的状态，而snapped和fill视图状态只能显示在水平分辨率为1366像素或者更高的屏幕中。因为snapped 视图宽度为320像素，可以摆放在屏幕的左边或者右边。剩余的1046像素分别分配为：分割线（22像素）和fill视图，fill视图的水平像素必须为1024或者更高。</p>

<p>如下面的三个图所示：</p>

<p>full screen（程序填满整个屏幕）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/13.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb3.png" width="197" height="140" /></a></p>

<p>snapped（应用程序只占据了整个屏幕的一小部分）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/23.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb4.png" width="197" height="140" /></a></p>

<p>Fill（应用程序占据了snapped宽度剩余的区域）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/34.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb4.png" width="197" height="140" /></a></p>

<p>这样用户就可以同时使用2个应用程序，那么作为开发者，就需要提供相应的布局和用户响应以满足三种视图状态。 <br/>
下面我就会根据视图状态的变化，在对我的程序进行编程控制，以适应相应的布局和用户响应。 <br/>
2、如何在程序中实现三种视图状态的切换 <br/>
&#160;&#160;&#160; a、首先我使用BlankApp创建了一个名为DevDiv_SnapView的工程，并在工程中添加Pages文件夹，然后使用空模版创建了3个xaml文件，分别为：FillView.xaml，FullView.xaml和SnapView.xaml，并把MainPage.xaml也移动到Pages目录中。 <br/>
&#160;&#160;&#160; b、由于三种视图状态可以显示三种不同的视图，那么我就利用上面创建的三个页面以在不同视图状态进行显示。首先我把这三个视图的布局和内容进行了编写，在这里不是关键的，所以就不上代码了，具体内容可以下载后面我提供的代码附件进行查看。 <br/>
&#160;&#160;&#160; c、在MainPage.xaml中为了进行相关页面的导航，我使用了一个Frame控件，在MainPage.xaml文件中也可以看到想要的代码。这里不列出来了。 <br/>
&#160;&#160;&#160; d、监听视图状态改变事件，以进行相应的处理 <br/>
&#160;&#160;&#160;&#160; 这一步是最重要的。在此需要监听视图状态的改变，具体代码如下所示[文件MainPage.xaml.cs]：其中 SizeChanged += MainView_SizeChanged;是注册事件。 <br/>
ApplicationView.value是获取当前视图状态的值。值类型定义如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">摘要:
//     指定可以处理的应用程序视图状态更改集。
[Version(100794368)]
public enum ApplicationViewState
{
    // 摘要:
    //     当前应用程序的视图为全屏（没有预期相邻的对齐的应用程序）并且已更改为横向。
    FullScreenLandscape = 0,
    //
    // 摘要:
    //     当前应用程序视图已缩小到部分屏幕视图作为另一个应用程序对齐的结果。
    Filled = 1,
    //
    // 摘要:
    //     当前应用程序的视图已对齐。
    Snapped = 2,
    //
    // 摘要:
    //     当前应用程序的视图为全屏（没有预期相邻的对齐的应用程序）并且已更改为纵向。
    FullScreenPortrait = 3,
}</pre>


<p>下面是文件MainPage.xaml.cs 代码：其中方法MainView_SizeChanged 根据不同的视图状态切换到不同的视图，以为用户提供不同的布局</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.ViewManagement;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;

// The Blank Page item template is documented at &lt;a href="\" target="\" _blank\?? ?LinkId=&#039;234238\""&#039; fwlink go.microsoft.com http:&gt;http://go.microsoft.com/fwlink/?LinkId=234238&lt;/a&gt;

namespace DevDiv_SnapView.Pages
{
    /// &lt;summary&gt;
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class MainPage : Page
    {
        public MainPage()
        {
            this.InitializeComponent();

            SizeChanged += MainView_SizeChanged;
        }

        void MainView_SizeChanged(object sender, SizeChangedEventArgs e)
        {
            if (ApplicationView.Value == ApplicationViewState.Filled)
            {
                MainFrame.Navigate(typeof(FillView));
            }
            else if (ApplicationView.Value == ApplicationViewState.Snapped)
            {
                MainFrame.Navigate(typeof(SnapView));
            }
            else if (ApplicationView.Value == ApplicationViewState.FullScreenLandscape)
            {
                MainFrame.Navigate(typeof(FullView));
            }
            else if (ApplicationView.Value == ApplicationViewState.FullScreenPortrait)
            {
            }
        }

        /// &lt;summary&gt;
        /// Invoked when this page is about to be displayed in a Frame.
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;Event data that describes how this page was reached.  The Parameter
        /// property is typically used to configure the page.&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }
    }
}</pre>


<p>代码编写至此结束，下面我们来运行程序，看看实际效果</p>

<p>3、最后附上程序运行截图和程序</p>

<p>Full视图</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/43.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb3.png" width="682" height="386" /></a></p>

<p>Snap视图（左边）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/51.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb1.png" width="682" height="386" /></a></p>

<p>Fill视图（左边）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/6.png"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb.png" width="682" height="386" /></a></p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SnapView" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/34/" itemprop="url">Windows Store App开发[007]视图模型与数据绑定</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在程序中使用视图模型（ViewModel），可以带来很多好处，在开发中值得采纳，视图模型的使用对Metro App开发非常有帮助，通过学习MVC和MVVC你可以了解到试图模型。在这里我将介绍如何定义和使用试图模型，其中包括数据的绑定等内容。</p>

<p>&#160;&#160;&#160; 本次程序我以DevDiv论坛的板块为参考数据，写一个视图模型，有一个主画面，画面的左边有一个列表，列表中的数据来自试图模型中板块项列表，同时右边会显示选中板块的介绍。下面是程序的运行图，我们可以先来看看最终效果：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/12.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb2.png" width="682" height="435" /></a></p>

<p>&#160;&#160;&#160; 本次学习内容主要包括一下几部分：</p>

<p>1、视图模型（ViewModel）的创建</p>

<p>2、添加页面</p>

<p>3、编写页面相关代码</p>

<p>4、添加资源字典</p>

<p>5、编写XAML</p>

<p>6、程序运行效果图与Demo程序</p>

<p>&#160;</p>

<p>1、视图模型（ViewModel）的创建</p>

<p>&#160;&#160; 对于创建具有可持续性和和可维护性的应用程序，试图模型是必须具有的一个基础部分，它可以让我将应用程序数据与呈现数据给用户的方法相分离。如果不使用视图模型的话，你会发现你的程序越来越难以维护和开发。</p>

<p>&#160;&#160; 在本小节，我首先使用Blank App模版创建了一个名为DevDiv_DataBinding的工程。并在其中创建一个Data目录，然后再Data目录下创建两个新的类文件。分别是ForumItem.cs和ViewModel.cs文件。</p>

<p>ForumItem类的代码如下</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.ComponentModel;

namespace DevDiv_DataBinding.Data
{
    class ForumItem : INotifyPropertyChanged
    {
        private string name, link, info;// 论坛板块的名称,链接和描述信息
        private int topicCount; // 主题数
        public string Name
        {
            get { return name; }
            set { name = value; NotifyPropertyChanged(&quot;Name&quot;); }
        }
        public string Link
        {
            get { return link; }
            set { link = value; NotifyPropertyChanged(&quot;Link&quot;); }
        }
        public string Info
        {
            get { return info; }
            set { info = value; NotifyPropertyChanged(&quot;info&quot;); }
        }
        public int TopicCount
        {
            get { return topicCount; }
            set { topicCount = value; NotifyPropertyChanged(&quot;TopicCount&quot;); }
        }
        public event PropertyChangedEventHandler PropertyChanged;
        private void NotifyPropertyChanged(string propName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propName));
            }
        }
    }
}</pre>


<p>ForumItem类是论坛中每个板块的信息：板块名称、链接、描述信息和主题数。</p>

<p>该类中最重要的部分是实现了INotifyPropertyChanged接口，即让该类的属性可观测，Metro UI控件一个很好的特性是它们支持数据绑定，这意味着当他们所显示的可观测数据发生变化时控件将会自动更新。所以在这里让ForumItem支持可观测，那么方便UI上自动的进行更新。</p>

<p>ViewModel类的代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.ComponentModel;
using System.Collections.ObjectModel;

namespace DevDiv_DataBinding.Data
{
    class ViewModel : INotifyPropertyChanged
    {
        private ObservableCollection&lt;forumitem&gt; forumItemList;
        private int selectedItemIndex;
        private string itemDetail;
        public ViewModel()
        {
            forumItemList = new ObservableCollection&lt;forumitem&gt;();
            selectedItemIndex = -1;
        }

        public int SelectedItemIndex
        {
            get { return selectedItemIndex; }
            set
            {
                selectedItemIndex = value; NotifyPropertyChanged(&quot;SelectedItemIndex&quot;);
            }
        }

        public string ItemDetail
        {
            get { return itemDetail; }
            set
            {
                itemDetail = value; NotifyPropertyChanged(&quot;ItemDetail&quot;);
            }
        }

        public ObservableCollection&lt;forumitem&gt; ForumItemList
        {
            get
            {
                return forumItemList;
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;
        private void NotifyPropertyChanged(string propName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propName));
            }
        }
    }

}</pre>


<p>ViewModel中最重要的是forumItemList对象集合（ObservableCollection）。ObservableCollection类实现了一个集合的基本特性，并在向列表中的项有被添加、删除或替换时发送事件通知。注意ObservableCollection类本身并不会发送一个事件通知，当它包含的某个对象的数据值被修改时，只有通过创建一个可观测的forumItemList 对象的可观测集合，才能确保对ForumItem所做的任何改变都将导致UI控件的更新。</p>

<p>ViewModel也实现了INotifyPropertyChanged接口，因为在这里有用到了可观测对象itemDetail。</p>

<p>好吧，上面就是一个简单的视图模型，下面我会介绍视图模型如何跟UI进行交互以实现数据改变后UI能够自动更新。</p>

<p>2、添加页面</p>

<p>&#160;&#160;&#160; 我在工程中添加了Pages目录，并添加了一个空白页ListPage.xaml。在这里我并没有使用工程默认创建的MainPage.xaml。</p>

<p>&#160;&#160;&#160; 为了让程序启动的时候默认加载ListPage界面，需要更新App.xaml.cs，如下语句，修改为Pages.ListPage</p>

<pre class="wp-code-highlight prettyprint linenums:1">var rootFrame = new Frame();
if (!rootFrame.Navigate(typeof(Pages.ListPage)))
{
    throw new Exception(&quot;Failed to create initial page&quot;);
}</pre>


<p>这样我们的页面就添加好了。</p>

<p>下面我们就来对该页面ListPage.xaml.cs进行编写</p>

<p>3、编写页面相关代码</p>

<p>这里我直接贴出ListPage.xaml.cs文件的代码，以方便你直接阅读</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;
using DevDiv_DataBinding.Data;

// The Blank Page item template is documented at &lt;a href="\" target="\" _blank\?? ?LinkId=&#039;234238\""&#039; fwlink go.microsoft.com http:&gt;http://go.microsoft.com/fwlink/?LinkId=234238&lt;/a&gt;

namespace DevDiv_DataBinding.Pages
{
    /// &lt;summary&gt;
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class ListPage : Page
    {
        ViewModel viewModel;

        public ListPage()
        {

            viewModel = new ViewModel();
            viewModel.SelectedItemIndex = -1;
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Android开发论坛&quot;, TopicCount = 4, Link = &quot;http://www.devdiv.com/forum-110-1.html&quot;,
                                                        Info = &quot;Android开发论坛、Android开发者论坛、环境搭建、应用开发、驱动开发、系统移植、文档&quot;});
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Android开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;iOS开发论坛/iPhone开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;iOS开发资料/iPhone开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;微软/诺基亚 Windows Phone开发论坛 &quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Windows Phone开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Windows 8 开发论坛 &quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot;,
                                                        Info = &quot;Windows 8 代码、教程、入门、文档、视频&quot;});
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });

            this.InitializeComponent();

            this.DataContext = viewModel;
        }

        /// &lt;summary&gt;
        /// Invoked when this page is about to be displayed in a Frame.
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;Event data that describes how this page was reached.  The Parameter
        /// property is typically used to configure the page.&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }

        private void ListSelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            viewModel.ItemDetail = ((ForumItem)e.AddedItems[0]).Info;
            if (viewModel.ItemDetail == null || viewModel.ItemDetail.Length == 0)
            {
                viewModel.ItemDetail = ((ForumItem)e.AddedItems[0]).Name;
            }
        }
    }
}</pre>


<p>上面的代码看着让我有点头疼，在这里我创建了一个viewModel并对其进行了初始化。你需要重点关注的下面的代码：</p>

<p>this.DataContext = viewModel;</p>

<p>DataContext 属性指定绑定到一个UI控件及其所有子控件的数据的来源。也就是说这里控件需要用到的数据来源是viewModel。使用this关键字来为整个布局设置DataContext。</p>

<p>代码最后定义了一个方法ListSelectionChanged，该方法处理当ListView中选择项改变后会触发的事件。在xaml文件中有使用到。</p>

<p>&#160;</p>

<p>4、添加资源字典</p>

<p>&#160;&#160;&#160;&#160; 为了方便样式的统一，在这里我自定义了ListView使用到的一些样式，这样做的好处是UI控件的字体，颜色等属性我只需要在一个地方修改就可以应用到所有使用到的地方，非常的方便。为此我在工程中创建了Resources目录，并用Resource Dictionary（资源字典）项模板创建了一个新的ForumResourceDictionary.xaml文件。</p>

<p>该文件的代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;resourcedictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:local="using:DevDiv_DataBinding.Resources" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;
    &lt;resourcedictionary.mergeddictionaries&gt;
        &lt;resourcedictionary source="/Common/StandardStyles.xaml"&gt;&lt;/resourcedictionary&gt;
    &lt;/resourcedictionary.mergeddictionaries&gt;

    &lt;solidcolorbrush x:key="AppBackgroundColor" color="#3E790A"&gt;&lt;/solidcolorbrush&gt;
    &lt;style x:key="ForumListItem" targettype="TextBlock" basedon="{StaticResource BasicTextStyle}"&gt;
        &lt;setter property="FontSize" value="38"/&gt;
        &lt;setter property="FontWeight" value="Light"/&gt;
        &lt;setter property="Margin" value="10, 0"/&gt;
        &lt;setter property="VerticalAlignment" value="Center"/&gt;
    &lt;/style&gt;

    &lt;datatemplate x:key="ForumListItemTemplate"&gt;
        &lt;stackpanel orientation="Horizontal"&gt;
            &lt;textblock text="{Binding Name}"&gt;&lt;/textblock&gt;
        &lt;/stackpanel&gt;
    &lt;/datatemplate&gt;

&lt;/resourcedictionary&gt;</pre>


<p>看上面的代码，我定义了ForumListItem样式，以及一个数据模版ForumListItemTemplate。ForumListItem定义了item的一些字体、布局等属性。ForumListItemTemplate这定义了该item具有的控件内容以及绑定到的数据。通过在.cs文件中设置DataContext属性，使视图模型作为绑定的数据源，Binding 关键字则让指定细节（“显示这个特定属性的值”)。</p>

<p>最后把该资源字典添加到App.xaml中即可，如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;resourcedictionary source="Resources/ForumResourceDictionary.xaml" /&gt;</pre>


<p>5、编写XAML</p>

<p>我把ListPage.xaml文件的编写放到最后，这并不影响程序的开发。</p>

<p>同样我先把文件代码贴出来，然后对关键部分进行分析</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:local="using:DevDiv_DataBinding.Pages" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" x:class="DevDiv_DataBinding.Pages.ListPage" istabstop="false" mc:ignorable="d"&gt;

    &lt;grid background="{StaticResource AppBackgroundColor}"&gt;
        &lt;grid.rowdefinitions&gt;
            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
        &lt;/grid.rowdefinitions&gt;
        &lt;grid.columndefinitions&gt;
            &lt;columndefinition width="885*"&gt;&lt;/columndefinition&gt;
            &lt;columndefinition width="481*"&gt;&lt;/columndefinition&gt;
        &lt;/grid.columndefinitions&gt;
        &lt;stackpanel grid.rowspan="2"&gt;
            &lt;textblock text="论坛首页-DevDiv.com" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
            &lt;listview grid.rowspan="2" x:name="ForumList" itemssource="{Binding ForumItemList}" itemtemplate="{StaticResource ForumListItemTemplate}" selectionchanged="ListSelectionChanged"&gt;&lt;/listview&gt;
        &lt;/stackpanel&gt;
        &lt;stackpanel orientation="Vertical" grid.column="1"&gt;
            &lt;textblock text="板块详情" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
            &lt;textblock text="{Binding ItemDetail}" margin="10" fontsize="30"&gt;&lt;/textblock&gt;
        &lt;/stackpanel&gt;
        &lt;stackpanel orientation="Vertical" background="White" grid.column="1" grid.row="1"&gt;
    &lt;textblock height="80"&gt;&lt;/textblock&gt;
            &lt;img source="../Assets/icon.png" horizontalalignment="Center" /&gt;
            &lt;textblock foreground="Red" fontsize="18" height="135"&gt;        
                &lt;run text="大家好！我是破船"&gt;&lt;/run&gt;
                    &lt;run text="欢迎跟我一起学习"&gt;&lt;/run&gt;  
                &lt;linebreak&gt;&lt;/linebreak&gt;
                    &lt;run text="Window 8 Metro App开发"&gt;&lt;/run&gt;
            &lt;/textblock&gt;
        &lt;/stackpanel&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>首先，来看看VS设计器显示的内容是什么，如下图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/22.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb3.png" width="682" height="403" /></a></p>

<p>可以看到，Grid控件的Background 特性为我在资源字典中指定的颜色。</p>

<p>我们来看上面的关键代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;listview grid.rowspan="2" x:name="ForumList" itemssource="{Binding ForumItemList}" itemtemplate="{StaticResource ForumListItemTemplate}" selectionchanged="ListSelectionChanged"&gt;&lt;/listview&gt;</pre>


<p>该代码片段是使用了ListView ，并指定了它的数据源ItemsSource和数据模板ItemTemplate。</p>

<p>Binding 关键字告诉ListView控件应该显示我在.cs代码文件中设置的DataContext对象的ForumItemList 属性的内容。而ItemTemplate则告诉ListView 控件应该如何显示ItemSource 中的每一数据项。StaticResource关键字和ForumListItemTemplate 值表示将使用我在资源字典中指定的数据模板。</p>

<p>最后就是指定SelectionChanged事件的处理方法。</p>

<p>再来看看下面的代码：该代码是显示在画面右上角的，其中第二个TextBlock 中将数据源绑定到视图模型的ItemDetail上。当用户改变选择项时，视图模型中的ItemDetail 内容也会改变，这样UI也会自动的更新ItemDetail 内容。</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;stackpanel orientation="Vertical" grid.column="1"&gt;
    &lt;textblock text="板块详情" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
    &lt;textblock text="{Binding ItemDetail}" margin="10" fontsize="30"&gt;&lt;/textblock&gt;
&lt;/stackpanel&gt;</pre>


<p>至此，我们的代码关键部分就编写完毕了。在设计器中你是看不到ListView中的数据的，因为设计器不能显示动态生成的内容。下面就让我们运行起来看看吧。</p>

<p>6、程序运行效果图与Demo程序</p>

<p>未选中效果</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/33.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb3.png" width="682" height="435" /></a></p>

<p>&#160;</p>

<p>选中效果</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/42.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb2.png" width="682" height="435" /></a></p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/DataBinding" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/33/" itemprop="url">Windows Store App开发[006]访问Assets文件夹</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>一般当你开始以XAML形式开发Windows 8 Metro App时，在你的工程里面可能会包含一些文件，例如用于显示的图片，数据和xml文件的读取。如下图，是我以Blank App模版创建的一个程序截图。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/11.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb1.png" width="320" height="285" /></a></p>

<p>&#160;</p>

<p>今天我就来跟大家分享一下，如何访问Assets文件夹以及里面的文件。</p>

<p>Windows.Storage名称空间</p>

<p>我们首先需要认识一下Windows.Store名称空间。</p>

<p>&#160;&#160;&#160; 如果你去阅读微软MSDN上提供的文档<a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.storage%28v=vs.85%29.aspx">Windows.Storage文档</a>，你会发现里面有一个StorageFolder类，通过该类，我们可以操作文件夹和相关的内容。StorageFolder类有一个方法叫做StorageFolder.CreateFileAsync，这个方法会在当前文件夹中异步的创建一个文件。同时，你也会看到，这里有获取文件内容，读取文件属性等方法。</p>

<p>&#160;&#160;&#160; 在这里我会在Assets目录中添加一个XML文件1.xml，然后将其读取出来并显示在TextBox中。</p>

<p>&#160;&#160;&#160; 首先，我们需要获取Assets文件夹安装的路径。可以通过下面的代码获取。</p>

<pre class="wp-code-highlight prettyprint linenums:1">StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;</pre>


<p>然后就是从Assets目录的文件1.xml中读取出数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">string CountriesFile = @&quot;Assets\1.xml&quot;;
StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;
StorageFile file = await InstallationFolder.GetFileAsync(CountriesFile);
Stream Countries = await file.OpenStreamForReadAsync();</pre>


<p>在这里我把文件内容转换为stream，并使用Linq XML从XML中读取数据。</p>

<p>下面我给出完成的代码片段：</p>

<pre class="wp-code-highlight prettyprint linenums:1">public async void LoadCountriesXML()
{
    string CountriesFile = @&quot;Assets\1.xml&quot;;
    StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;
    StorageFile file = await InstallationFolder.GetFileAsync(CountriesFile);
    Stream Countries = await file.OpenStreamForReadAsync();

    XDocument xDOC = XDocument.Load(Countries);

    testXml.Text = xDOC.ToString();
}</pre>


<p>这里需要特别注意的是async和await两个关键字，这两个是C#中新的关键字，在这里我们只需要知道在调用异步函数的时候需要使用到，后续的学习系列中我会对async和await进行详细的讲解。</p>

<p>下面我们就来看看程序运行的效果</p>

<p>第一个图是1.xml文件中的内容，第二个图是程序运行起来，显示出的xml内容。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/21.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb2.png" width="530" height="385" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/32.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb2.png" width="682" height="386" /></a></p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/AccessAssets" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/32/" itemprop="url">Windows Store App开发[005]导航栏(AppBar)的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>有时候我们的程序包含不同的功能，需要不同的画面来显示用户需求，此时各画面之间就需要进行导航，为了让用户可以方便的进行画面切换，最好提供一致的导航功能。在本次学习中，我就带领大家学如何在Metro应用程序开发中使用AppBar。</p>

<p>&#160;&#160;&#160; 通过本次学习，你将掌握以下内容：</p>

<p>1、如何把AppBar封装到程序中</p>

<p>2、画面的导航及相关页面代码编写</p>

<p>3、最后附上程序运行截图和程序</p>

<p>&#160;</p>

<p>1、如何把AppBar封装到程序中</p>

<p>在这里我使用Blank App模版创建一个名为DevDiv_AppNavBar的工程。并在MainPage.xaml文件的page中，添加如下代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;page.topappbar&gt;
    &lt;appbar background="SteelBlue"&gt;
        &lt;stackpanel orientation="Horizontal" horizontalalignment="Center"&gt;
            &lt;button x:name="btBlankPage1" automationproperties.name="第一个画面" isenabled="False" click="NavBarButtonPress"&gt;
            &lt;button x:name="btBlankPage2" automationproperties.name="第二个画面" isenabled="True" click="NavBarButtonPress"&gt;
        &lt;/stackpanel&gt;
    &lt;/appbar&gt;
&lt;/page.topappbar&gt;
&lt;grid background="OliveDrab"&gt;
    &lt;frame x:name="MainFrame" /&gt;
&lt;/grid&gt;
&lt;pre&gt;</pre>


<p></p></p>

<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>


<p></button></p>

<p>为了添加一个NavBar，我在Page.TopAppBar属性里面声明了一个AppBar控件。NavBar的机制与AppBar（底部）类似，在这里我添加了两个Button，用以进行画面的导航响应。</p>

<p>&#160;&#160;&#160; 从上面给出的代码，还可以看到除了NavBar，MainPage的布局中还包含一个Frame，我将用它来显示不同的视图。&#160;&#160;&#160; 上面代码可以在VS的设计器中看到，如下图。很简单吧，这样就完成了导航栏的添加了。</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/1.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb.png" width="682" height="420" /></a></p>

<p>下面我们来给导航栏中按钮做事件处理，以及相关页面的编写。</p>

<p>2、画面的导航及相关页面代码编写</p>

<p>导航事件响应的代码编写相对来说也比较简单，只需要在MainPage.xaml.cs中实现button对应的NavBarButtonPress函数就行。下面我给出该函数完整的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void NavBarButtonPress(object sender, RoutedEventArgs e)
{
    Boolean isBlankPage1 = (Button)sender == btBlankPage1;

    btBlankPage1.IsEnabled = !isBlankPage1;
    btBlankPage2.IsEnabled = isBlankPage1;

    if (isBlankPage1)
    {
        MainFrame.Navigate(typeof(BlankPage1));
    }
    else
    {
        MainFrame.Navigate(typeof(BlankPage2));
    }
}</pre>


<p>如上代码所示，由于两个button都由NavBarButtonPress负责响应事件，那么在该函数的开始需要先判断以下事件的来源，以作响应的处理。如果事件来源是btBlankPage1，则说明需要切换到画面一，如果是btBlankPage2，则切换到画面二。</p>

<p>&#160;&#160;&#160; 在这里需要注意的是，为了演示导航，我使用空白页模版另外新建了两个BlankPage（BlankPage1和BlankPage2），并将其放在Pages目录中。这两个画面实际上什么都没有。</p>

<p>如下图：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/2.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb1.png" width="682" height="433" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/31.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb1.png" width="353" height="260" /></a></p>

<p>3、最后附上程序运行截图和程序</p>

<p>虽然代码看起来不太复杂，但是在写这个小例子程序中，还是花了些许时间。下面我就把程序运行截图和代码附上，如果你需要的话，可以下载来学习，有问题的话也可以跟帖交流。</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/41.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb1.png" width="682" height="435" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/5.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb.png" width="682" height="435" /></a></p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/AppNavBar" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/7/" class="prev">Prev</a>
    
    
        <a href="/blog/page/9/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">所有文章</a></div>
    
    <script type="text/javascript">
var duoshuoQuery = {short_name:"beyondvincent"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
</nav>

</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - 破船(BeyondVincent) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42893468-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1a3c98825a726bfbf68a83ba97e0b9be' type='text/javascript'%3E%3C/script%3E"));
    </script>

		</div>
	</div>
</body>
</html>
