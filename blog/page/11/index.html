
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>破船之家</title>
	<meta name="author" content="破船(BeyondVincent)">

	
	<meta name="description" content="Jun 2nd, 2013 Step by Step, Windows商店应用开发 Windows Store App开发[012]Windows 8 中搜索合约的使用 在上一篇文章，我给大家介绍了Windows 8中的合约，如果你还没有看的话，建议你先去阅读一下。在本篇文章中，我将利用搜索合约 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="破船之家" type="application/atom+xml">
	
	<link rel="canonical" href="http://BeyondVincent.github.io/blog/page/11/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("beyondvincent@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">破船之家</a></h1>
<p class="subtitle">宠辱不惊，闲看庭前花开花落<br>去留无意，漫随天外云卷云舒<br>不妄取，不妄予，不妄想，不妄求<br>与人方便，随遇而安</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/about">关于我</a></li>
</ul>
</nav>
欢迎关注我的微信公众账号<br>
<div align=center><img width="100" height="100" src="http://beyondvincent.com/images/2013/12/qrcode_bv.jpg"></div>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/beyondvincent" title="Weibo">Weibo</a>
		
		
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/39/" itemprop="url">Windows Store App开发[012]Windows 8 中搜索合约的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在<a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91011%E6%B5%85%E8%B0%88windows-8-%E4%B8%AD%E7%9A%84%E5%90%88%E7%BA%A6contracts/" target="_blank"><u>上一篇</u></a>文章，我给大家介绍了Windows 8中的合约，如果你还没有看的话，建议你先去阅读一下。在本篇文章中，我将利用搜索合约，来跟大家介绍合约的使用。为了演示的方便，本次示例我使用下面这篇文章中的示例进行改进。</p>

<p><a href="http://beyondvincent.com/2013/06/02/windows-store-app%E5%BC%80%E5%8F%91007%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/" target="_blank"><u>Windows Store App开发[007]视图模型与数据绑定</u></a></p>

<p>本文的内容结构如下：</p>

<p>1、搜索合约的声明</p>

<p>2、搜索的激活</p>

<p>3、提交查询的候选项</p>

<p>4、运行效果和示例代码</p>

<p>&#160;</p>

<p><strong>1、搜索合约的声明</strong></p>

<p>&#160;&#160; 我们打开上面提到的示例程序，并打开Package.appxmanifest文件，选择声明选项卡，如下图，并找到选择搜索声明，然后添加:</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/16.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb6.png" width="682" height="453" /></a></p>

<p>然后我们部署应用程序到计算机上。部署完毕之后，按Windows+Q组合键，可以看到，我们的示例程序：搜索合约测试已经在搜索面板中了。如果这里不添加搜索声明的话，在搜索面板中是看不到的。如下两图所示(左图是已经添加搜索声明的，右图则是没有添加)</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/26.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb7.png" width="652" height="665" /></a></p>

<p><strong>2、搜索的激活</strong> <br/>
&#160;&#160;&#160; 打开App.xml.cs文件，在其中添加如下函数</p>

<pre class="wp-code-highlight prettyprint linenums:1">protected override void OnSearchActivated(SearchActivatedEventArgs args)
{
    viewModel.SearchAndSelect(args.QueryText);
}</pre>


<p>当应用程序以显示搜索结果为目的被激活时，该方法会被调用，也就是说，从搜索面板中输入内容，然后回车可以激活该方法。</p>

<p>在这里，我把viewModel的位置放到App里面了，这样方便调用。在viewModel方法中我添加了一个方法SearchAndSelect，该方法用于搜索内容。代码如下：该代码的左右就是查找出ForumItemList 中name与搜索内容符合的字段，并记录相关的index。</p>

<pre class="wp-code-highlight prettyprint linenums:1">public void SearchAndSelect(string searchTerm)
{
    int selIndex = -1;
    for (int i = 0; i &lt; ForumItemList.Count; i++)
    {
        if (ForumItemList.Name.ToLower().Contains(searchTerm.ToLower()))
        {
            selIndex = i;
            System.Diagnostics.Debug.WriteLine(ForumItemList.Name);
            break;
        }
    }
    SelectedItemIndex = selIndex;
}</pre>


<p>为了在界面上让搜索命中相选中，我还对SelectedItemIndex进行了监听，如果发生改变则界面先择也相应的进行改变，如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">viewModel.PropertyChanged += (sender, args) =&gt;
{
    if (args.PropertyName == &quot;SelectedItemIndex&quot;)
    {
        ForumList.SelectedIndex = viewModel.SelectedItemIndex;
    }
};</pre>


<p>这样，当SelectedItemIndex 改变的时候，界面上的选中项也会发生改变。</p>

<p><strong>3、提交查询的候选项</strong></p>

<p>&#160;&#160;&#160; 为了加强用户体验，方便用户选择搜索内容，我们可以在搜索面板添加一些搜索的候选项。当用户在输入内容的时候，按照一定的规则，给用户列出适合的内容。</p>

<p>&#160;&#160;&#160; 首先需要做的事情就是监听SuggestionRequested事件，当用户开始在搜索框中输入内容时，就会触发该事件。那么我们可以通过下面的代码进行注册：注意在这里需要增加using Windows.ApplicationModel.Search;否则会出现错误。</p>

<pre class="wp-code-highlight prettyprint linenums:1">SearchPane.GetForCurrentView().SuggestionsRequested += searchPane_SuggestionsRequested;</pre>


<p>当SuggestionRequested事件来的时候，我们就可以发送候选项建议了。就像查询一样，候选项内容可以来自网络服务，或者自行组合，在这里为了演示目的，我从ForumItemList中获取内容，在SearchPageSuggestionsRequestedEventArgs实例中，我们可以把候选项添加到SearchSuggestionCollection中，SearchSuggestionCollection中的内容会显示在搜索面板中。因为当用户每次输入内容的时候，该方法都会被调用，因此一定要注意该函数的编写。下面是我的代码：</p>

<p>&#160;&#160;&#160; 需要注意的是搜索面板只能显示最多5个候选项</p>

<pre class="wp-code-highlight prettyprint linenums:1">void searchPane_SuggestionsRequested(SearchPane sender, SearchPaneSuggestionsRequestedEventArgs args)
{
    foreach (ForumItem forumItem in viewModel.ForumItemList)
    {
        string suggestion = forumItem.Name;

        if (suggestion.StartsWith(args.QueryText, StringComparison.CurrentCultureIgnoreCase))
        {
            args.Request.SearchSuggestionCollection.AppendQuerySuggestion(suggestion);
        }
        if (args.Request.SearchSuggestionCollection.Size &gt;= 5)
        {
            break;
        }
    }
}</pre>


<p>这样我们就成功的在程序中实现了搜索合约功能。下面我们看看运行效果</p>

<p><strong>4、运行效果和示例代码</strong></p>

<p>实运行程序，调出搜索面板（Windows键+Q），输入W字母，看到如下效果图，在右边列出了以W开头的两个候选项</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/37.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb7.png" width="682" height="427" /></a></p>

<p>选择第二项：Windows 8 开发论坛，此时左边的对应项会被选中，如下图所示：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/45.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb5.png" width="682" height="427" /></a></p>

<p>到此，搜索合约的讲解就结束了，欢迎大家的阅读。</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SearchContract" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/38/" itemprop="url">Windows Store App开发[011]浅谈Windows 8 中的合约(contracts)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Windows 8 Metro App开发中，你很快就会使用到合约功能，合约是Windows 8中至关重要的全新概念，作为Metro开发者，有必要掌握。目前关于合约的相关资料还比较少，在这里，我主要参考了msdn提供的一些文档，写此贴的目的是希望大家对合约有一个初步的了解，同时也欢迎大家来交流。</p>

<p>&#160;&#160;&#160;&#160;&#160; 在这篇文章中，我主要对合约进行一个概述。在下一篇文章中，我会通过编程的方式，向大家介绍如何使用合约。</p>

<p>本文，我主要介绍如下内容：</p>

<p>1、合约概述</p>

<p>2、合约类型</p>

<p>&#160;</p>

<p><strong>1、合约概述</strong></p>

<p>Metro 风格的应用程序使用合约来声明它们支持哪些与其他应用程序和 Windows 进行的交互。对于其中的一些合约，您可能早有耳闻，如“搜索”合约和“共享”合约。通过各种合约，应用程序不仅可以通过与系统协作来提高运行速度，而且在用户安装了多个实施合约的应用程序时，它们还可以彼此配合来保持良好的运行状态。</p>

<p>合约：针对特定目的启动 Metro 风格的应用程序（包含上下文）</p>

<p>&#160;&#160;&#160; Windows 8 合约发挥着纽带的作用，它可以将您的应用程序与其他 Metro 风格的应用程序以及系统 UI 相关联。例如，“文件打开选取器”合约允许用户将文件从一个应用程序导入到另一个。使用“搜索”合约，用户能够在系统中的任意位置搜索应用程序，并在多个应用程序之间快速传输查询。在这些案例以及许多其他合约定应用场景中，Windows 都需要具备可通过应用程序 UI 启动应用程序的功能，这样用户才能快速高效地完成特定任务。这正是我们的激活平台和 API 发挥其作用的平台。</p>

<p>&#160;&#160;&#160; Windows 8已经定义了一些合约。最重要的合约有：搜索合约（search contract）、共享合约（share contract）、设置合约（settings contract）和App To App picker合约。这里也有更多的何用合约，在应用中使用这些合约时，一定要注意用户体验。</p>

<p>下面我们就来分别看看Windows 8中的合约类型。</p>

<p>&#160;</p>

<p><strong>2、合约类型</strong></p>

<p>&#160;&#160;&#160; 在介绍合约之前，先跟大家分享一个热键组合——Windows键+C键（或将鼠标移到屏幕的最右上角或右下角），就可以启动系统的Charm面板，Charm面板里面有搜索、共享、设定等相关功能，这些功能与下面介绍的合约有密切关系。</p>

<p>接下来，我们对各种合约进行初步的认识：</p>

<p>Search contract</p>

<p>&#160;&#160;&#160; Search contract 可以用来建立针对 Metro Style Apps 中内容的搜索功能。我们可以轻松的使用Search contract ，让用户能直接通过 Windows 8 里的 Search Charm 对我们开发的 Metro Style Apps 的内容里的字符串或是文字进行查找。</p>

<p>&#160;&#160;&#160; 一旦我们的 App 实现了Search contract，当使用者打开 Windows 8 的 Search Charm 时，我们的 App 就会出现在右下方的 Apps 列表，使用者就可以直接在该接口点选我们的 App 的 Icon，针对我们的 App 中的数据内容进行s搜索，如此一来，我们也不用特别去多花心思去为我们的每一个 App 设计个自的搜索接口，一切都交给 Windows 8 的 Search Charm 就行了。</p>

<p>&#160;&#160; 不过，通过Search contract 并不能针对 App 中特定文件的内容进行搜索，如果要实现特定文件内容的搜索的话，就得自己在 App 中写搜索的接口和相关逻辑开启 Windows 8 内置的 Search 面版热键为 Windows键 + Q键</p>

<p>Share contract <br/>
&#160;&#160;&#160; Share contract 比较特别的地方是，它有「来源端 App」及「目标端 App」。如果我们开发的 Metro Style Apps 里会有文档可以当作数据源给其他的 Metro Style Apps 使用，那么这个 App 就会是来源端 App；相反的，如果我们的 Metro Style Apps 允许接受其他 Metro Style Apps 的数据作为数据的输入来源的话，这个 App 就是目标端 App，可以借助Share Target contract 来操作让它可以透过 Share Charm 接受其他 App 的数据源的功能。通过 Share Contract，我们就能使用 Windows 8 的 Share Charm，让用户更轻松的进行数据间的分享及传递了。 <br/>
开启 Windows 8 内置的 Share 面版的热键为 Windows 键 + H 键。 <br/>
Settings contract <br/>
&#160;&#160;&#160; 通过 Settings contract功能，我们可以让用户通过 Windows 8 的 Settings Charm 来针对我们开发的 Metro Style Apps 进行设定，如此一来，我们不用费心去特别设计一个设定专用的画面，其次，整个用户体验也和操作系统本身更为贴近。 <br/>
开启 Windows 8 内置的 Settings 面版的热键为 Windows 键 + I 键。 <br/>
Play To contract <br/>
&#160;&#160;&#160; 通过 Play To contract，我们可以轻松的让用户在我们开发的 Metro Style Apps 中进行播放的影片、音乐或是相片等等媒体文件，以串流的方式，通过兼容于 DLNA 的装置进行播放。若操作系统侦测到有支持相关功能的其他装置，会自动将那些装置显示在 Devices Charm 里，而我们就可以通过 Play To 功能，将媒体以串流的传输方式传送过去。 <br/>
开启 Windows 8 内置的 Devices 面版的热键为 Windows 键 + K 键。 <br/>
App to App Picking contract <br/>
&#160;&#160;&#160; 我们可以通过 App to App Picking contract，让我们的 App 开启文件系统、网络上或是其它在线服务中的文件，甚至使某个 App 具备能通过其他 App 进行浏览或是开启特定类型文件的能力；除此之外，使用者在开启特定类型文件时，也可以自行决定要使用哪一个 App 来开启。 <br/>
更多的合约类型参考下面的链接： <br/>
<a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464906.aspx"><u>App contracts and extensions (Metro style apps)</u></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/37/" itemprop="url">Windows Store App开发[010]通知使用(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在我写的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a>中，我概述了Windows 8 中的通知，介绍了通知的类型（tile，toast和badges），以及通知的分发机制(local，scheduled和push)。在这一篇帖子中，我将以编程者的角度来给大家介绍我目前对通知的了解情况，希望能够起到抛砖引玉的作用，更多功能还需要等待你来实现。</p>

<p>&#160;&#160;&#160; 注：1、本次主要以代码的形式来讲解通知的使用</p>

<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2、本次讲解的通知分发方法为local[关于分发方法，请参考我的<a href="http://beyondvincent.com/category/windows_store_app-develop/"><strong><u>上一个帖子</u></strong></a></p>

<p>通过本次的学习，你将初步掌握如下内容：</p>

<p>1、准备工作</p>

<p>2、Toast通知的使用</p>

<p>3、Tile通知的使用</p>

<p>4、Badge通知的使用 <br/>
5、最后附上程序相关代码工程</p>

<p>&#160;</p>

<p><strong>1、准备工作</strong></p>

<p>&#160;&#160;&#160; a) 首先以Blank App创建一个应用程序。然后打开Package.appxmanifest文件，按照下面图中的标准，制作了3个图片，并添加到工程中。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/15.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb5.png" width="682" height="183" /></a></p>

<p>&#160;</p>

<p>b) 获取 NotificationsExtensions 库</p>

<p>&#160;&#160;&#160; 由于Tile、Toast和Badge使用的都是xml模版，为了简化对xml的操作，这里我们可以使用NotificationsExtensions对象库模型，它提供磁贴、锁屏提醒和 Toast 通知 XML 模板内容，而无需直接使用 XML 文档对象模型 (DOM)。 当你在 Microsoft Visual Studio 中使用此库时，你可以获得下列好处：</p>

<ul>
<li>智能感知，它将可用的通知 XML 标记和属性列为对象属性。这样，开发人员将无需参考架构文档来获取有关元素和结构的信息。</li>
<li>工厂函数，可通过该函数来创建主干通知。然后，你可以用你的内容填充这些通知。</li>
<li>一种在你的通知负载中同时包括方形和加宽磁贴版本（这是最佳做法！）的简化方式。</li>
<li>一种查找和填充文本和图像属性的有用方式。可通过它们的名称来获取有关它们在模板中的预期使用、大小或位置的更多信息。</li>
</ul>


<p>具体的使用操作说明微软的官网上有详细内容，我就不细说了，参考下面的链接：</p>

<p><a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/hh969156.aspx"><u>使用 NotificationsExtensions 填充锁屏提醒、磁贴和 Toast 模板</u></a></p>

<p>这里我就默认你已经按照上面链接给出的操作步骤，完成了对NotificationsExtensions库的引用。</p>

<p>&#160;</p>

<p><strong>2、Toast通知的使用</strong></p>

<p>&#160;&#160;&#160; 先上相关代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void sendToast(object sender, RoutedEventArgs e)
{
    IToastNotificationContent toastContent = null;
    IToastText01 templateContent = ToastContentFactory.CreateToastText01();
    templateContent.TextBodyWrap.Text = &quot;今天去游泳！(BeyondVincent|破船|)&quot;;
    toastContent = templateContent;
    ToastNotification toast = toastContent.CreateNotification();
    ToastNotificationManager.CreateToastNotifier().Show(toast);
}</pre>


<p>看上面的代码，通过使用NotificationsExtensions库提供的IToastNotificationContent类，我们可以方便的创建出一个ToastNotification，然后在利用ToastNotificationManager该语句ToastNotificationManager.CreateToastNotifier().Show(toast); 将Toast通知显示出来。显示效果如下图所示：</p>

<p>显示在屏幕的右上角</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/25.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb6.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p>关于Toast通知需要注意的是：需要在Package.appxmanifest中将是否支持Toast通知设置为是，如下图</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/36.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb6.png" width="654" height="676" /></a></p>

<hr />

<p><strong>3、Tile通知的使用</strong></p>

<p>微软提供了好多Tile模版供我们使用，这里已经给出了详细的介绍，大家可以前去学习了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761491"><u>Choosing a tile template</u></a></p>

<p>在这里我用了两种方式更新Tile：纯文本（ ITileWideText03&#160; ITileWideText04）和web图片（ITileSquareImage）</p>

<p>&#160;&#160;&#160; 先上纯文本代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void UpdateTileWithText()
{
    ITileWideText03 tileContent = TileContentFactory.CreateTileWideText03();
    tileContent.TextHeadingWrap.Text = &quot;你有三条未读短信！&quot;;

    ITileSquareText04 squareContent = TileContentFactory.CreateTileSquareText04();
    squareContent.TextBodyWrap.Text = &quot;你有三条未读短信！&quot;;
    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>看上面的代码，在这里同样使用NotificationsExtensions库提供的功能，很方便的创建出Notification，然后使用最后一行代码将其更新。</p>

<p>使用web图片代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateTileWithWebImage()
{
    ITileWideImageAndText01 tileContent = TileContentFactory.CreateTileWideImageAndText01();

    tileContent.TextCaptionWrap.Text = &quot;高清：撑杆跳伊辛巴耶娃4米70无缘奥运三连冠&quot;;

    tileContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    tileContent.Image.Alt = &quot;Web image&quot;;

    ITileSquareImage squareContent = TileContentFactory.CreateTileSquareImage();

    squareContent.Image.Src = &quot;http://img1.gtimg.com/4/460/46005/4600509_980x1200_292.jpg&quot;;
    squareContent.Image.Alt = &quot;Web image&quot;;

    tileContent.SquareContent = squareContent;

    TileUpdateManager.CreateTileUpdaterForApplication().Update(tileContent.CreateNotification());
}</pre>


<p>如果我们要清除Tile信息，则调用下面的代码即可</p>

<pre class="wp-code-highlight prettyprint linenums:1">TileUpdateManager.CreateTileUpdaterForApplication().Clear();</pre>


<p>运行效果如下图：</p>

<p>文字：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/44.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb4.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/52.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb2.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>4、Badge通知的使用 </strong></p>

<p>&#160;&#160;&#160; 微软也提供了badge相关的详细介绍以及图标，建议参考下面的链接，进行了解</p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh779719"><u>Badge overview (Metro style apps)</u></a></p>

<p><a href="http://msdn.microsoft.com/library/windows/apps/Hh761458"><u>Choosing a badge image</u></a></p>

<p>下面我继续上代码，这里我同样用两种方式展现badge的使用（数字和图片）</p>

<p>先上数字的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithNumber(int number)
{
    BadgeNumericNotificationContent badgeContent = new BadgeNumericNotificationContent((uint)number);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>代码很简单，我就不表了。</p>

<p>再上图片的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">void UpdateBadgeWithGlyph(GlyphValue index)
{
    BadgeGlyphNotificationContent badgeContent = new BadgeGlyphNotificationContent(index);

    BadgeUpdateManager.CreateBadgeUpdaterForApplication().Update(badgeContent.CreateNotification());
}</pre>


<p>同样不细表，如果大家在使用过程中遇到什么问题，可以跟帖进行讨论。</p>

<p>下面是清除badge通知内容的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">BadgeUpdateManager.CreateBadgeUpdaterForApplication().Clear();</pre>


<p>很简单吧。那我就来上两个允许效果图：</p>

<p>数字：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/61.png"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb1.png" width="682" height="410" /></a></p>

<p>图片：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/7.png"><img title="7" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="7" src="http://beyondvincent.com/wp-content/uploads/2013/06/7_thumb.png" width="682" height="410" /></a></p>

<p>&#160;</p>

<p><strong>5、最后附上程序相关代码工程</strong></p>

<p>下图是程序主界面图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/8.png"><img title="8" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="8" src="http://beyondvincent.com/wp-content/uploads/2013/06/8_thumb.png" width="682" height="410" /></a> </p></p>

<p>&#160;</p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/Notifications" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/36/" itemprop="url">Windows Store App开发[009]通知概述(Toast,Tile和Badge)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在开始屏幕上，瓷贴是一个应用程序主要的展现。为了使开始屏幕充满活力，让用户看到的东西可以一目了然（这也是metro 风格的主要目的），你可以在瓷贴上添加通知，当然也可以单独使用它们。</p>

<p>通过本次的学习，你将掌握如下内容：</p>

<p>1、通知的类型</p>

<p>2、通知的分发方法</p>

<p>3、用例图表</p>

<p>&#160;</p>

<p><strong>1、通知的类型</strong></p>

<p>&#160;&#160;&#160; 这里主要有三种通知类型：Toast通知、Tile通知和Badge通知。下面我们就来分别了解一下它们各自的特性。</p>

<p>Toast通知</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/14.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb4.png" width="321" height="77" /></a></p>

<p>Toast通知实际上并不是新特征了，在微软的Outlook或者一些社交类客户端应用程序中都可以看到Toast的身影。Toast通知主要用于：时间敏感的个人信息，例如朋友发来了一条消息。Toast通知暗示有一个事件或者内容需要你关注，当点击toast时会启动应用程序，并进入到与通知信息相关的画面。一定要记住：Toast通知可能会丢失或者被用户关闭，所以不能用来当做一种保证交付机制使用。Windows 8 中的Toast通知可以出现在其它程序中，开始屏幕上或者桌面（desktop）。</p>

<p>&#160;</p>

<p>Tile通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/24.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb5.png" width="210" height="102" /></a></p>

<p>Tile通知显示在开始屏幕上，所以对于没有运行的程序，这类通知更加有用（当然，当程序在运行的时候，用户是不喜欢来看开始屏幕上的Tile通知）。Tile通知是Windows 8和Windows Phone特有的通知，它们看起来一目了然——用户可以快速的查看最新e-mail的主题，看到当前天气情况，检查收藏的股票信息。这一切信息的获取都不需要启动应用程序。</p>

<p>&#160;</p>

<p>Badge通知</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/35.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb5.png" width="104" height="108" /></a></p>

<p>Badge被认为是Tile通知的特殊类型。badge通知可以显示eleven glyphs或者从1到99之间任意的一个数字，显示的位置在tile的右下角。如上图中数字badge通知在Windows Store tile中，表示有1个可以更新的程序。如果是媒体播放器，可以使用不同的字形（eleven glyphs）来表示播放器是暂停或者播放中。</p>

<p>&#160;</p>

<p><strong>2、通知的分发方法</strong> <br/>
&#160;&#160;&#160; 有三种重要的分发方法：Local通知，Scheduled通知和Push通知，下面我们也来看看各自的特点 <br/>
Local通知</p>

<ul>
<li>只有当程序运行的时候可以使用</li>
<li>&#160;&#160;&#160;&#160; 主要用于更新tiles和badges</li>
</ul>


<p>&#160;&#160;&#160;&#160;&#160; Local通知是由运行的程序触发的，用于通知用户应用程序状态当前发生的变化，或者有感兴趣的新内容，这些都是有应用程序本身负责生成或者发现的。 <br/>
Scheduled通知
*   在某个精确的时间点使用toast通知或者tile通知</p>

<p>&#160;&#160;&#160;&#160;&#160; 开发者可以让Scheduled通知使用local通知在将来某一个时刻运行。典型的例子就是一个会议的提醒，此时应用程序不需要运行起来。 <br/>
Push通知
*   从云端更新tiles，显示badges和toast
*   &#160;&#160;&#160;&#160;&#160; 及时应用程序不允许，也可以进行Push通知</p>

<p>&#160;&#160;&#160; Push通知是最强大和解耦的一种通知机制，但同时它的结构也非常的复杂。通过利用Windows Push Notification Service，push通知可以被分发到你的应用程序，消息的产生不是由你的应用程序决定的，而是由你自己的或者第三方的web services生成并进行内容的管理和分发。 <br/>
<strong>3、用例图表</strong> <br/>
&#160;&#160;&#160; 这里我做了一个用例图表，你可以看一下。需要注意的是：Badge通知类型并不能使用Scheduled分发方法。在这里我添加了一行表示那些分发方法需要应用程序是运行的（仅仅是local通知需要）。内容源这一行表示消息内容的生成地方。在local和scheduled通知中，内容的组装是有应用程序负责的，内容的源可能是应用程序自行处理或者从外部服务中轮训获取到；push通知则依赖于外部服务,使用pull和push方法,将数据提供给你的程序。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/4.jpg"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb.jpg" width="682" height="191" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/35/" itemprop="url">Windows Store App开发[008]处理Fullscreen, Snapped和Filled状态</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Windows 8 Metro App中定义了三种视图状态：full screen, snapped, filled。这三种状态在程序中都比较常见，也会经常用到，在这里我就跟大家分享一下相关视图状态的知识点。</p>

<p>&#160;&#160;&#160; 通过本次学习，你将掌握以下内容：</p>

<p>1、视图状态的介绍</p>

<p>2、如何在程序中实现三种视图状态的切换</p>

<p>3、最后附上程序运行截图和程序</p>

<p>&#160;</p>

<p>1、视图状态的介绍</p>

<p>&#160;&#160;&#160; 在Windows 8 Metro App中，我们可以处理三种视图状态：full screen, snapped, filled。</p>

<p>full screen是Metro App默认的状态，而snapped和fill视图状态只能显示在水平分辨率为1366像素或者更高的屏幕中。因为snapped 视图宽度为320像素，可以摆放在屏幕的左边或者右边。剩余的1046像素分别分配为：分割线（22像素）和fill视图，fill视图的水平像素必须为1024或者更高。</p>

<p>如下面的三个图所示：</p>

<p>full screen（程序填满整个屏幕）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/13.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb3.png" width="197" height="140" /></a></p>

<p>snapped（应用程序只占据了整个屏幕的一小部分）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/23.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb4.png" width="197" height="140" /></a></p>

<p>Fill（应用程序占据了snapped宽度剩余的区域）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/34.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb4.png" width="197" height="140" /></a></p>

<p>这样用户就可以同时使用2个应用程序，那么作为开发者，就需要提供相应的布局和用户响应以满足三种视图状态。 <br/>
下面我就会根据视图状态的变化，在对我的程序进行编程控制，以适应相应的布局和用户响应。 <br/>
2、如何在程序中实现三种视图状态的切换 <br/>
&#160;&#160;&#160; a、首先我使用BlankApp创建了一个名为DevDiv_SnapView的工程，并在工程中添加Pages文件夹，然后使用空模版创建了3个xaml文件，分别为：FillView.xaml，FullView.xaml和SnapView.xaml，并把MainPage.xaml也移动到Pages目录中。 <br/>
&#160;&#160;&#160; b、由于三种视图状态可以显示三种不同的视图，那么我就利用上面创建的三个页面以在不同视图状态进行显示。首先我把这三个视图的布局和内容进行了编写，在这里不是关键的，所以就不上代码了，具体内容可以下载后面我提供的代码附件进行查看。 <br/>
&#160;&#160;&#160; c、在MainPage.xaml中为了进行相关页面的导航，我使用了一个Frame控件，在MainPage.xaml文件中也可以看到想要的代码。这里不列出来了。 <br/>
&#160;&#160;&#160; d、监听视图状态改变事件，以进行相应的处理 <br/>
&#160;&#160;&#160;&#160; 这一步是最重要的。在此需要监听视图状态的改变，具体代码如下所示[文件MainPage.xaml.cs]：其中 SizeChanged += MainView_SizeChanged;是注册事件。 <br/>
ApplicationView.value是获取当前视图状态的值。值类型定义如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">摘要:
//     指定可以处理的应用程序视图状态更改集。
[Version(100794368)]
public enum ApplicationViewState
{
    // 摘要:
    //     当前应用程序的视图为全屏（没有预期相邻的对齐的应用程序）并且已更改为横向。
    FullScreenLandscape = 0,
    //
    // 摘要:
    //     当前应用程序视图已缩小到部分屏幕视图作为另一个应用程序对齐的结果。
    Filled = 1,
    //
    // 摘要:
    //     当前应用程序的视图已对齐。
    Snapped = 2,
    //
    // 摘要:
    //     当前应用程序的视图为全屏（没有预期相邻的对齐的应用程序）并且已更改为纵向。
    FullScreenPortrait = 3,
}</pre>


<p>下面是文件MainPage.xaml.cs 代码：其中方法MainView_SizeChanged 根据不同的视图状态切换到不同的视图，以为用户提供不同的布局</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.ViewManagement;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;

// The Blank Page item template is documented at &lt;a href="\" target="\" _blank\?? ?LinkId=&#039;234238\""&#039; fwlink go.microsoft.com http:&gt;http://go.microsoft.com/fwlink/?LinkId=234238&lt;/a&gt;

namespace DevDiv_SnapView.Pages
{
    /// &lt;summary&gt;
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class MainPage : Page
    {
        public MainPage()
        {
            this.InitializeComponent();

            SizeChanged += MainView_SizeChanged;
        }

        void MainView_SizeChanged(object sender, SizeChangedEventArgs e)
        {
            if (ApplicationView.Value == ApplicationViewState.Filled)
            {
                MainFrame.Navigate(typeof(FillView));
            }
            else if (ApplicationView.Value == ApplicationViewState.Snapped)
            {
                MainFrame.Navigate(typeof(SnapView));
            }
            else if (ApplicationView.Value == ApplicationViewState.FullScreenLandscape)
            {
                MainFrame.Navigate(typeof(FullView));
            }
            else if (ApplicationView.Value == ApplicationViewState.FullScreenPortrait)
            {
            }
        }

        /// &lt;summary&gt;
        /// Invoked when this page is about to be displayed in a Frame.
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;Event data that describes how this page was reached.  The Parameter
        /// property is typically used to configure the page.&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }
    }
}</pre>


<p>代码编写至此结束，下面我们来运行程序，看看实际效果</p>

<p>3、最后附上程序运行截图和程序</p>

<p>Full视图</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/43.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb3.png" width="682" height="386" /></a></p>

<p>Snap视图（左边）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/51.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb1.png" width="682" height="386" /></a></p>

<p>Fill视图（左边）</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/6.png"><img title="6" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="6" src="http://beyondvincent.com/wp-content/uploads/2013/06/6_thumb.png" width="682" height="386" /></a></p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/SnapView" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/34/" itemprop="url">Windows Store App开发[007]视图模型与数据绑定</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在程序中使用视图模型（ViewModel），可以带来很多好处，在开发中值得采纳，视图模型的使用对Metro App开发非常有帮助，通过学习MVC和MVVC你可以了解到试图模型。在这里我将介绍如何定义和使用试图模型，其中包括数据的绑定等内容。</p>

<p>&#160;&#160;&#160; 本次程序我以DevDiv论坛的板块为参考数据，写一个视图模型，有一个主画面，画面的左边有一个列表，列表中的数据来自试图模型中板块项列表，同时右边会显示选中板块的介绍。下面是程序的运行图，我们可以先来看看最终效果：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/12.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb2.png" width="682" height="435" /></a></p>

<p>&#160;&#160;&#160; 本次学习内容主要包括一下几部分：</p>

<p>1、视图模型（ViewModel）的创建</p>

<p>2、添加页面</p>

<p>3、编写页面相关代码</p>

<p>4、添加资源字典</p>

<p>5、编写XAML</p>

<p>6、程序运行效果图与Demo程序</p>

<p>&#160;</p>

<p>1、视图模型（ViewModel）的创建</p>

<p>&#160;&#160; 对于创建具有可持续性和和可维护性的应用程序，试图模型是必须具有的一个基础部分，它可以让我将应用程序数据与呈现数据给用户的方法相分离。如果不使用视图模型的话，你会发现你的程序越来越难以维护和开发。</p>

<p>&#160;&#160; 在本小节，我首先使用Blank App模版创建了一个名为DevDiv_DataBinding的工程。并在其中创建一个Data目录，然后再Data目录下创建两个新的类文件。分别是ForumItem.cs和ViewModel.cs文件。</p>

<p>ForumItem类的代码如下</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.ComponentModel;

namespace DevDiv_DataBinding.Data
{
    class ForumItem : INotifyPropertyChanged
    {
        private string name, link, info;// 论坛板块的名称,链接和描述信息
        private int topicCount; // 主题数
        public string Name
        {
            get { return name; }
            set { name = value; NotifyPropertyChanged(&quot;Name&quot;); }
        }
        public string Link
        {
            get { return link; }
            set { link = value; NotifyPropertyChanged(&quot;Link&quot;); }
        }
        public string Info
        {
            get { return info; }
            set { info = value; NotifyPropertyChanged(&quot;info&quot;); }
        }
        public int TopicCount
        {
            get { return topicCount; }
            set { topicCount = value; NotifyPropertyChanged(&quot;TopicCount&quot;); }
        }
        public event PropertyChangedEventHandler PropertyChanged;
        private void NotifyPropertyChanged(string propName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propName));
            }
        }
    }
}</pre>


<p>ForumItem类是论坛中每个板块的信息：板块名称、链接、描述信息和主题数。</p>

<p>该类中最重要的部分是实现了INotifyPropertyChanged接口，即让该类的属性可观测，Metro UI控件一个很好的特性是它们支持数据绑定，这意味着当他们所显示的可观测数据发生变化时控件将会自动更新。所以在这里让ForumItem支持可观测，那么方便UI上自动的进行更新。</p>

<p>ViewModel类的代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.ComponentModel;
using System.Collections.ObjectModel;

namespace DevDiv_DataBinding.Data
{
    class ViewModel : INotifyPropertyChanged
    {
        private ObservableCollection&lt;forumitem&gt; forumItemList;
        private int selectedItemIndex;
        private string itemDetail;
        public ViewModel()
        {
            forumItemList = new ObservableCollection&lt;forumitem&gt;();
            selectedItemIndex = -1;
        }

        public int SelectedItemIndex
        {
            get { return selectedItemIndex; }
            set
            {
                selectedItemIndex = value; NotifyPropertyChanged(&quot;SelectedItemIndex&quot;);
            }
        }

        public string ItemDetail
        {
            get { return itemDetail; }
            set
            {
                itemDetail = value; NotifyPropertyChanged(&quot;ItemDetail&quot;);
            }
        }

        public ObservableCollection&lt;forumitem&gt; ForumItemList
        {
            get
            {
                return forumItemList;
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;
        private void NotifyPropertyChanged(string propName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propName));
            }
        }
    }

}</pre>


<p>ViewModel中最重要的是forumItemList对象集合（ObservableCollection）。ObservableCollection类实现了一个集合的基本特性，并在向列表中的项有被添加、删除或替换时发送事件通知。注意ObservableCollection类本身并不会发送一个事件通知，当它包含的某个对象的数据值被修改时，只有通过创建一个可观测的forumItemList 对象的可观测集合，才能确保对ForumItem所做的任何改变都将导致UI控件的更新。</p>

<p>ViewModel也实现了INotifyPropertyChanged接口，因为在这里有用到了可观测对象itemDetail。</p>

<p>好吧，上面就是一个简单的视图模型，下面我会介绍视图模型如何跟UI进行交互以实现数据改变后UI能够自动更新。</p>

<p>2、添加页面</p>

<p>&#160;&#160;&#160; 我在工程中添加了Pages目录，并添加了一个空白页ListPage.xaml。在这里我并没有使用工程默认创建的MainPage.xaml。</p>

<p>&#160;&#160;&#160; 为了让程序启动的时候默认加载ListPage界面，需要更新App.xaml.cs，如下语句，修改为Pages.ListPage</p>

<pre class="wp-code-highlight prettyprint linenums:1">var rootFrame = new Frame();
if (!rootFrame.Navigate(typeof(Pages.ListPage)))
{
    throw new Exception(&quot;Failed to create initial page&quot;);
}</pre>


<p>这样我们的页面就添加好了。</p>

<p>下面我们就来对该页面ListPage.xaml.cs进行编写</p>

<p>3、编写页面相关代码</p>

<p>这里我直接贴出ListPage.xaml.cs文件的代码，以方便你直接阅读</p>

<pre class="wp-code-highlight prettyprint linenums:1">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;
using DevDiv_DataBinding.Data;

// The Blank Page item template is documented at &lt;a href="\" target="\" _blank\?? ?LinkId=&#039;234238\""&#039; fwlink go.microsoft.com http:&gt;http://go.microsoft.com/fwlink/?LinkId=234238&lt;/a&gt;

namespace DevDiv_DataBinding.Pages
{
    /// &lt;summary&gt;
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class ListPage : Page
    {
        ViewModel viewModel;

        public ListPage()
        {

            viewModel = new ViewModel();
            viewModel.SelectedItemIndex = -1;
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Android开发论坛&quot;, TopicCount = 4, Link = &quot;http://www.devdiv.com/forum-110-1.html&quot;,
                                                        Info = &quot;Android开发论坛、Android开发者论坛、环境搭建、应用开发、驱动开发、系统移植、文档&quot;});
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Android开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;iOS开发论坛/iPhone开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;iOS开发资料/iPhone开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;微软/诺基亚 Windows Phone开发论坛 &quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Windows Phone开发资料&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Windows 8 开发论坛 &quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot;,
                                                        Info = &quot;Windows 8 代码、教程、入门、文档、视频&quot;});
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });
            viewModel.ForumItemList.Add(new ForumItem { Name = &quot;Symbian开发论坛&quot;, TopicCount = 8, Link = &quot;http://www.devdiv.com/forum-102-1.html&quot; });

            this.InitializeComponent();

            this.DataContext = viewModel;
        }

        /// &lt;summary&gt;
        /// Invoked when this page is about to be displayed in a Frame.
        /// &lt;/summary&gt;
        /// &lt;param name="e" /&gt;Event data that describes how this page was reached.  The Parameter
        /// property is typically used to configure the page.&lt;/param&gt;
        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
        }

        private void ListSelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            viewModel.ItemDetail = ((ForumItem)e.AddedItems[0]).Info;
            if (viewModel.ItemDetail == null || viewModel.ItemDetail.Length == 0)
            {
                viewModel.ItemDetail = ((ForumItem)e.AddedItems[0]).Name;
            }
        }
    }
}</pre>


<p>上面的代码看着让我有点头疼，在这里我创建了一个viewModel并对其进行了初始化。你需要重点关注的下面的代码：</p>

<p>this.DataContext = viewModel;</p>

<p>DataContext 属性指定绑定到一个UI控件及其所有子控件的数据的来源。也就是说这里控件需要用到的数据来源是viewModel。使用this关键字来为整个布局设置DataContext。</p>

<p>代码最后定义了一个方法ListSelectionChanged，该方法处理当ListView中选择项改变后会触发的事件。在xaml文件中有使用到。</p>

<p>&#160;</p>

<p>4、添加资源字典</p>

<p>&#160;&#160;&#160;&#160; 为了方便样式的统一，在这里我自定义了ListView使用到的一些样式，这样做的好处是UI控件的字体，颜色等属性我只需要在一个地方修改就可以应用到所有使用到的地方，非常的方便。为此我在工程中创建了Resources目录，并用Resource Dictionary（资源字典）项模板创建了一个新的ForumResourceDictionary.xaml文件。</p>

<p>该文件的代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;resourcedictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:local="using:DevDiv_DataBinding.Resources" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;
    &lt;resourcedictionary.mergeddictionaries&gt;
        &lt;resourcedictionary source="/Common/StandardStyles.xaml"&gt;&lt;/resourcedictionary&gt;
    &lt;/resourcedictionary.mergeddictionaries&gt;

    &lt;solidcolorbrush x:key="AppBackgroundColor" color="#3E790A"&gt;&lt;/solidcolorbrush&gt;
    &lt;style x:key="ForumListItem" targettype="TextBlock" basedon="{StaticResource BasicTextStyle}"&gt;
        &lt;setter property="FontSize" value="38"/&gt;
        &lt;setter property="FontWeight" value="Light"/&gt;
        &lt;setter property="Margin" value="10, 0"/&gt;
        &lt;setter property="VerticalAlignment" value="Center"/&gt;
    &lt;/style&gt;

    &lt;datatemplate x:key="ForumListItemTemplate"&gt;
        &lt;stackpanel orientation="Horizontal"&gt;
            &lt;textblock text="{Binding Name}"&gt;&lt;/textblock&gt;
        &lt;/stackpanel&gt;
    &lt;/datatemplate&gt;

&lt;/resourcedictionary&gt;</pre>


<p>看上面的代码，我定义了ForumListItem样式，以及一个数据模版ForumListItemTemplate。ForumListItem定义了item的一些字体、布局等属性。ForumListItemTemplate这定义了该item具有的控件内容以及绑定到的数据。通过在.cs文件中设置DataContext属性，使视图模型作为绑定的数据源，Binding 关键字则让指定细节（“显示这个特定属性的值”)。</p>

<p>最后把该资源字典添加到App.xaml中即可，如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;resourcedictionary source="Resources/ForumResourceDictionary.xaml" /&gt;</pre>


<p>5、编写XAML</p>

<p>我把ListPage.xaml文件的编写放到最后，这并不影响程序的开发。</p>

<p>同样我先把文件代码贴出来，然后对关键部分进行分析</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:local="using:DevDiv_DataBinding.Pages" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" x:class="DevDiv_DataBinding.Pages.ListPage" istabstop="false" mc:ignorable="d"&gt;

    &lt;grid background="{StaticResource AppBackgroundColor}"&gt;
        &lt;grid.rowdefinitions&gt;
            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
            &lt;rowdefinition&gt;&lt;/rowdefinition&gt;
        &lt;/grid.rowdefinitions&gt;
        &lt;grid.columndefinitions&gt;
            &lt;columndefinition width="885*"&gt;&lt;/columndefinition&gt;
            &lt;columndefinition width="481*"&gt;&lt;/columndefinition&gt;
        &lt;/grid.columndefinitions&gt;
        &lt;stackpanel grid.rowspan="2"&gt;
            &lt;textblock text="论坛首页-DevDiv.com" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
            &lt;listview grid.rowspan="2" x:name="ForumList" itemssource="{Binding ForumItemList}" itemtemplate="{StaticResource ForumListItemTemplate}" selectionchanged="ListSelectionChanged"&gt;&lt;/listview&gt;
        &lt;/stackpanel&gt;
        &lt;stackpanel orientation="Vertical" grid.column="1"&gt;
            &lt;textblock text="板块详情" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
            &lt;textblock text="{Binding ItemDetail}" margin="10" fontsize="30"&gt;&lt;/textblock&gt;
        &lt;/stackpanel&gt;
        &lt;stackpanel orientation="Vertical" background="White" grid.column="1" grid.row="1"&gt;
    &lt;textblock height="80"&gt;&lt;/textblock&gt;
            &lt;img source="../Assets/icon.png" horizontalalignment="Center" /&gt;
            &lt;textblock foreground="Red" fontsize="18" height="135"&gt;        
                &lt;run text="大家好！我是破船"&gt;&lt;/run&gt;
                    &lt;run text="欢迎跟我一起学习"&gt;&lt;/run&gt;  
                &lt;linebreak&gt;&lt;/linebreak&gt;
                    &lt;run text="Window 8 Metro App开发"&gt;&lt;/run&gt;
            &lt;/textblock&gt;
        &lt;/stackpanel&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>首先，来看看VS设计器显示的内容是什么，如下图：</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/22.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb3.png" width="682" height="403" /></a></p>

<p>可以看到，Grid控件的Background 特性为我在资源字典中指定的颜色。</p>

<p>我们来看上面的关键代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;listview grid.rowspan="2" x:name="ForumList" itemssource="{Binding ForumItemList}" itemtemplate="{StaticResource ForumListItemTemplate}" selectionchanged="ListSelectionChanged"&gt;&lt;/listview&gt;</pre>


<p>该代码片段是使用了ListView ，并指定了它的数据源ItemsSource和数据模板ItemTemplate。</p>

<p>Binding 关键字告诉ListView控件应该显示我在.cs代码文件中设置的DataContext对象的ForumItemList 属性的内容。而ItemTemplate则告诉ListView 控件应该如何显示ItemSource 中的每一数据项。StaticResource关键字和ForumListItemTemplate 值表示将使用我在资源字典中指定的数据模板。</p>

<p>最后就是指定SelectionChanged事件的处理方法。</p>

<p>再来看看下面的代码：该代码是显示在画面右上角的，其中第二个TextBlock 中将数据源绑定到视图模型的ItemDetail上。当用户改变选择项时，视图模型中的ItemDetail 内容也会改变，这样UI也会自动的更新ItemDetail 内容。</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;stackpanel orientation="Vertical" grid.column="1"&gt;
    &lt;textblock text="板块详情" margin="10" foreground="Red"&gt;&lt;/textblock&gt;
    &lt;textblock text="{Binding ItemDetail}" margin="10" fontsize="30"&gt;&lt;/textblock&gt;
&lt;/stackpanel&gt;</pre>


<p>至此，我们的代码关键部分就编写完毕了。在设计器中你是看不到ListView中的数据的，因为设计器不能显示动态生成的内容。下面就让我们运行起来看看吧。</p>

<p>6、程序运行效果图与Demo程序</p>

<p>未选中效果</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/33.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb3.png" width="682" height="435" /></a></p>

<p>&#160;</p>

<p>选中效果</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/42.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb2.png" width="682" height="435" /></a></p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/DataBinding" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/33/" itemprop="url">Windows Store App开发[006]访问Assets文件夹</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>一般当你开始以XAML形式开发Windows 8 Metro App时，在你的工程里面可能会包含一些文件，例如用于显示的图片，数据和xml文件的读取。如下图，是我以Blank App模版创建的一个程序截图。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/11.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb1.png" width="320" height="285" /></a></p>

<p>&#160;</p>

<p>今天我就来跟大家分享一下，如何访问Assets文件夹以及里面的文件。</p>

<p>Windows.Storage名称空间</p>

<p>我们首先需要认识一下Windows.Store名称空间。</p>

<p>&#160;&#160;&#160; 如果你去阅读微软MSDN上提供的文档<a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.storage%28v=vs.85%29.aspx">Windows.Storage文档</a>，你会发现里面有一个StorageFolder类，通过该类，我们可以操作文件夹和相关的内容。StorageFolder类有一个方法叫做StorageFolder.CreateFileAsync，这个方法会在当前文件夹中异步的创建一个文件。同时，你也会看到，这里有获取文件内容，读取文件属性等方法。</p>

<p>&#160;&#160;&#160; 在这里我会在Assets目录中添加一个XML文件1.xml，然后将其读取出来并显示在TextBox中。</p>

<p>&#160;&#160;&#160; 首先，我们需要获取Assets文件夹安装的路径。可以通过下面的代码获取。</p>

<pre class="wp-code-highlight prettyprint linenums:1">StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;</pre>


<p>然后就是从Assets目录的文件1.xml中读取出数据。</p>

<pre class="wp-code-highlight prettyprint linenums:1">string CountriesFile = @&quot;Assets\1.xml&quot;;
StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;
StorageFile file = await InstallationFolder.GetFileAsync(CountriesFile);
Stream Countries = await file.OpenStreamForReadAsync();</pre>


<p>在这里我把文件内容转换为stream，并使用Linq XML从XML中读取数据。</p>

<p>下面我给出完成的代码片段：</p>

<pre class="wp-code-highlight prettyprint linenums:1">public async void LoadCountriesXML()
{
    string CountriesFile = @&quot;Assets\1.xml&quot;;
    StorageFolder InstallationFolder = Windows.ApplicationModel.Package.Current.InstalledLocation;
    StorageFile file = await InstallationFolder.GetFileAsync(CountriesFile);
    Stream Countries = await file.OpenStreamForReadAsync();

    XDocument xDOC = XDocument.Load(Countries);

    testXml.Text = xDOC.ToString();
}</pre>


<p>这里需要特别注意的是async和await两个关键字，这两个是C#中新的关键字，在这里我们只需要知道在调用异步函数的时候需要使用到，后续的学习系列中我会对async和await进行详细的讲解。</p>

<p>下面我们就来看看程序运行的效果</p>

<p>第一个图是1.xml文件中的内容，第二个图是程序运行起来，显示出的xml内容。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/21.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb2.png" width="530" height="385" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/32.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb2.png" width="682" height="386" /></a></p>

<p>&#160;</p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/AccessAssets" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/02/32/" itemprop="url">Windows Store App开发[005]导航栏(AppBar)的使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>有时候我们的程序包含不同的功能，需要不同的画面来显示用户需求，此时各画面之间就需要进行导航，为了让用户可以方便的进行画面切换，最好提供一致的导航功能。在本次学习中，我就带领大家学如何在Metro应用程序开发中使用AppBar。</p>

<p>&#160;&#160;&#160; 通过本次学习，你将掌握以下内容：</p>

<p>1、如何把AppBar封装到程序中</p>

<p>2、画面的导航及相关页面代码编写</p>

<p>3、最后附上程序运行截图和程序</p>

<p>&#160;</p>

<p>1、如何把AppBar封装到程序中</p>

<p>在这里我使用Blank App模版创建一个名为DevDiv_AppNavBar的工程。并在MainPage.xaml文件的page中，添加如下代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;page.topappbar&gt;
    &lt;appbar background="SteelBlue"&gt;
        &lt;stackpanel orientation="Horizontal" horizontalalignment="Center"&gt;
            &lt;button x:name="btBlankPage1" automationproperties.name="第一个画面" isenabled="False" click="NavBarButtonPress"&gt;
            &lt;button x:name="btBlankPage2" automationproperties.name="第二个画面" isenabled="True" click="NavBarButtonPress"&gt;
        &lt;/stackpanel&gt;
    &lt;/appbar&gt;
&lt;/page.topappbar&gt;
&lt;grid background="OliveDrab"&gt;
    &lt;frame x:name="MainFrame" /&gt;
&lt;/grid&gt;
&lt;pre&gt;</pre>


<p></p></p>

<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>




<div>
</div>


<p></button></p>

<p>为了添加一个NavBar，我在Page.TopAppBar属性里面声明了一个AppBar控件。NavBar的机制与AppBar（底部）类似，在这里我添加了两个Button，用以进行画面的导航响应。</p>

<p>&#160;&#160;&#160; 从上面给出的代码，还可以看到除了NavBar，MainPage的布局中还包含一个Frame，我将用它来显示不同的视图。&#160;&#160;&#160; 上面代码可以在VS的设计器中看到，如下图。很简单吧，这样就完成了导航栏的添加了。</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/1.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/06/1_thumb.png" width="682" height="420" /></a></p>

<p>下面我们来给导航栏中按钮做事件处理，以及相关页面的编写。</p>

<p>2、画面的导航及相关页面代码编写</p>

<p>导航事件响应的代码编写相对来说也比较简单，只需要在MainPage.xaml.cs中实现button对应的NavBarButtonPress函数就行。下面我给出该函数完整的代码：</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void NavBarButtonPress(object sender, RoutedEventArgs e)
{
    Boolean isBlankPage1 = (Button)sender == btBlankPage1;

    btBlankPage1.IsEnabled = !isBlankPage1;
    btBlankPage2.IsEnabled = isBlankPage1;

    if (isBlankPage1)
    {
        MainFrame.Navigate(typeof(BlankPage1));
    }
    else
    {
        MainFrame.Navigate(typeof(BlankPage2));
    }
}</pre>


<p>如上代码所示，由于两个button都由NavBarButtonPress负责响应事件，那么在该函数的开始需要先判断以下事件的来源，以作响应的处理。如果事件来源是btBlankPage1，则说明需要切换到画面一，如果是btBlankPage2，则切换到画面二。</p>

<p>&#160;&#160;&#160; 在这里需要注意的是，为了演示导航，我使用空白页模版另外新建了两个BlankPage（BlankPage1和BlankPage2），并将其放在Pages目录中。这两个画面实际上什么都没有。</p>

<p>如下图：</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/2.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb1.png" width="682" height="433" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/31.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb1.png" width="353" height="260" /></a></p>

<p>3、最后附上程序运行截图和程序</p>

<p>虽然代码看起来不太复杂，但是在写这个小例子程序中，还是花了些许时间。下面我就把程序运行截图和代码附上，如果你需要的话，可以下载来学习，有问题的话也可以跟帖交流。</p>

<p>&#160;</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/41.png"><img title="4" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb1.png" width="682" height="435" /></a></p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/5.png"><img title="5" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="5" src="http://beyondvincent.com/wp-content/uploads/2013/06/5_thumb.png" width="682" height="435" /></a></p>

<p>代码下载：</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/AppNavBar" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-01T00:00:00+08:00" data-updated="true" itemprop="datePublished">Jun 1<span>st</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/step-by-step/'>Step by Step</a>, <a class='category' href='/blog/categories/windowsshang-dian-ying-yong-kai-fa/'>Windows商店应用开发</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/01/31/" itemprop="url">Windows Store App开发[004]弹出画面(Flayouts)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>有时候在程序中，我们需要弹出一个画面与用户进行交互，此时我们并不想从当前画面切走，那是针对这种情况使用弹出画面(Flayouts)是比较好的一种选择。今天我就带领大家一起学习一下如何在程序画面中弹出一个画面。主要功能实现：当用户点击AppBar中的某个按钮时，弹出一个画面，达到与用户交互的目的。</p>

<p>弹出画面是一个pop-up窗口，显示在被点击按钮附近，当用户点击或者触摸屏幕的非弹出画面区域时，弹出画面会自动的消失。</p>

<p>&#160;&#160;&#160; 通过本次学习，你将掌握以下内容：</p>

<p>1、创建自定义控件</p>

<p>2、编写自定义控件代码</p>

<p>3、定位弹出的控件（画面）</p>

<p>4、在程序中使用弹出画面</p>

<p>5、显示弹出画面</p>

<p>6、最后附上程序运行截图和程序demo</p>

<p>&#160;</p>

<p>1、创建自定义控件</p>

<p>&#160;&#160;&#160; 为了代码易于管理，在这里，我把弹出画面定义为一个自定义控件。也就是包含一个xaml文件和相关的代码文件。如下图所示，如何创建自定义控件：</p>

<p>选择用户控件，输入名称就可以了。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/05/12.png"><img title="1" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="1" src="http://beyondvincent.com/wp-content/uploads/2013/05/1_thumb1.png" width="682" height="433" /></a></p>

<p>下图是创建好的画面</p>

<p>我将控件文件SearchFlayout存放在Flayouts文件夹下</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/05/21.png"><img title="2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="2" src="http://beyondvincent.com/wp-content/uploads/2013/06/2_thumb.png" width="682" height="410" /></a></p>

<p>在xaml文件中添加如下代码</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;usercontrol xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:DevDiv_AppBar.Flayouts" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="DevDiv_AppBar.Flayouts.SearchFlayout" mc:ignorable="d" d:designheight="300" d:designwidth="400"&gt;
    
    &lt;grid&gt;
        &lt;popup x:name="SearchPopup" islightdismissenabled="True" width="350" height="130"&gt;
            &lt;stackpanel background="Black"&gt;
                &lt;border background="#85bd" borderthickness="4"&gt;
                    &lt;stackpanel&gt;
                        &lt;stackpanel orientation="Horizontal" margin="10"&gt;
                            &lt;textblock margin="0,0,10,0" text="请输入搜索内容:" verticalalignment="Center"&gt;&lt;/textblock&gt;
                            &lt;textbox width="150" height="40" name="searchDataBox" fontsize="20"&gt;&lt;/textbox&gt;
                        &lt;/stackpanel&gt;
                        &lt;button margin="10" click="SearchButtonClick" horizontalalignment="Center"&gt;搜索&lt;/button&gt;
                    &lt;/stackpanel&gt;
                &lt;/border&gt;
            &lt;/stackpanel&gt;
        &lt;/popup&gt;
    &lt;/grid&gt;
&lt;/usercontrol&gt;</pre>


<p>在代码中，需要提醒的是Popup的属性IsLightDismissEnabled=&ldquo;True&#8221;。这表示当用户点击或者触摸屏幕的任意位置，不包括Popup的位置，pop-up画面是否消失。当把Popup用作弹出画面时，这个属性必须设置为True，因为这是才符合基本的弹出画面(flyout）用户体验。</p>

<p>如下图所示，我们还可以在设计器中，看到自定义控件长什么样</p>

<p>在上面的代码中需要注意的是创建弹出画面必须使用Popup控件，至于Popup控件里面的内容就按需而定即可。我在这里用了TextBlock、TextBox和Button三个控件，当然还有一个StackPanel容器控件。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/3.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="3" src="http://beyondvincent.com/wp-content/uploads/2013/06/3_thumb.png" width="682" height="524" /></a></p>

<p>这样我们xaml文件就基本写完了。下面我们开始编写控件的C#代码</p>

<p>2、编写自定义控件代码</p>

<p>在这里，自定义控件中主要实现两个功能：显示控件本身和响应控件提供的相关用户交互操作大家看下面两个函数Show方法主要就是将自己显示出来。SearchButtonClick是响应自定义控件中的搜索按钮事件。</p>

<p>注意：在Show方法中有一行代码如下，是用来计算当前弹出画面需要显示的位置，后面会有讲解（由于目前的版本中微软并没有提供相关好的方法来获取显示的位置，所以需要自行计算，希望在windows 8正式版发布之后，能解决这个问题）</p>

<p>FlyoutHelper.ShowRelativeToAppBar(SearchPopup, page, appbar, button);</p>

<pre class="wp-code-highlight prettyprint linenums:1">public void Show(Page page, AppBar appbar, Button button)
{
    SearchPopup.IsOpen = true;
        
    FlyoutHelper.ShowRelativeToAppBar(SearchPopup, page, appbar, button);
}</pre>




<pre class="wp-code-highlight prettyprint linenums:1">private void SearchButtonClick(object sender, RoutedEventArgs e) 
{
    SearchPopup.IsOpen = false;
}</pre>


<p>3、定位弹出的控件（画面）</p>

<p>在这里我创建了一个FlyoutHelper类，其中定义了一个静态方法ShowRelativeToAppBar。这个方法计算出相关按钮上显示的Popup的正确位置，这样做，需要传入Popup控件、包含AppBar的Page、AppBar控件和被点击的button按钮。这个方法并不好，但这是我发现的可以获得flyout准确位置的唯一方法。具体代码如下：</p>

<pre class="wp-code-highlight prettyprint linenums:1">namespace DevDiv_AppBar.Flayouts
{
    class FlyoutHelper
    {
        public static void ShowRelativeToAppBar(Popup popup, Page page, AppBar appbar, Button button)
        {
            Func&lt;uielement  , uielement, point&gt; getOffset = delegate(UIElement control1, UIElement control2)
            {
                return control1.TransformToVisual(control2).TransformPoint(new Point(0, 0));
            };

            Point popupOffset = getOffset(popup, page);
            Point buttonOffset = getOffset(button, page);
            popup.HorizontalOffset = buttonOffset.X - popupOffset.X - (popup.ActualWidth / 2) + (button.ActualWidth / 2); popup.VerticalOffset = getOffset(appbar, page).Y - popupOffset.Y - popup.ActualHeight;
            if (popupOffset.X + popup.HorizontalOffset + popup.ActualWidth &gt; page.ActualWidth)
            {
                popup.HorizontalOffset = page.ActualWidth - popupOffset.X - popup.ActualWidth;
            }
            else if
                (popup.HorizontalOffset + popupOffset.X &lt; 0)
            {
                popup.HorizontalOffset = -popupOffset.X;
            }
        }
    }
}</pre>


<p>代码会将Popup定位在与其相关的AppBar按钮的上方，如果Popup从屏幕的左侧或右侧消失那么Popup将被重新定位，由于这代码比较恶心，我就不细讲了，希望在windows 8正式版发布之后，这个问题会得到解决。</p>

<p>4、在程序中使用弹出画面</p>

<p>将刚刚定义的控件添加到MainPage.xaml中,代码如下所示。</p>

<p>这里需要将名称空间添加进来using:DevDiv_AppBar.Flayouts 这样才能使用Flayouts中定义的控件。</p>

<p>下面的代码中，添加自定义控件是这行代码</p>

<p>&lt;flyouts:SearchFlayout x:Name=&ldquo;SearchFlayout&rdquo;/></p>

<p>虽然这里并不是马上就显示出弹出画面，但是我们也需要把自定义控件声明为主程序布局的一部分。</p>

<pre class="wp-code-highlight prettyprint linenums:1">&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;?XML:NAMESPACE PREFIX = &quot;[default] http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; NS = &quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; /&gt;&lt;page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:DevDiv_AppBar" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" x:class="DevDiv_AppBar.MainPage" mc:ignorable="d" xmlns:flyouts="using:DevDiv_AppBar.Flayouts" istabstop="false"&gt;
    

    &lt;grid background="PaleGoldenrod"&gt;
        &lt;img width="295" height="200" margin="495,215,0,0" verticalalignment="Top" horizontalalignment="Left" source="Assets/icon.png" /&gt;
        &lt;flyouts:searchflayout x:name="SearchFlayout" /&gt;
    &lt;/grid&gt;
&lt;/page&gt;</pre>


<p>5、显示弹出画面</p>

<p>现在代码基本编写完毕了，剩下的任务就是当用户点击AppBar上的搜索按钮时，将弹出画面显示出来即可。</p>

<p>我在MainPage.xaml.cs中添加如下代码：</p>

<p>并将该方法与AppBar的搜索按钮Click事件关联起来即可</p>

<pre class="wp-code-highlight prettyprint linenums:1">private void AppBarButtonClick(object sender, RoutedEventArgs e){
    if (e.OriginalSource == AppBarSearchButton)
    {
        SearchFlayout.Show(this, this.BottomAppBar, (Button)e.OriginalSource);
    }
}</pre>


<p>6、最后附上程序运行截图和程序demo</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/06/4.png"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://beyondvincent.com/wp-content/uploads/2013/06/4_thumb.png" width="682" height="386" /></a></p>

<p>代码下载</p>

<p><a href="https://github.com/BeyondVincent/WindowsStoreAppStepByStep/tree/master/Flayouts" target="_blank"><img src="http://beyondvincent.com/wp-content/uploads/2013/05/code_xaml.png" /></a></p>

<p>&#160;</p>

<div style="text-align: left">
  <span style="color: #339966"></span>
</div>




<div style="text-align: left">
  <span style="color: #339966">本文由<span style="text-decoration: underline"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline">破船</span></a></span>原创●转载请注明出处●<time data-updated="true" datetime="2013-05-18T17:37:00+08:00">2012-05-31</time></span>
</div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-05-31T00:00:00+08:00" data-updated="true" itemprop="datePublished">May 31<span>st</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/05/31/30/" itemprop="url">Xcode Code Snippets</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://beyondvincent.com/wp-content/uploads/2013/05/fend_off_rsi.jpg"><img class="alignnone size-full wp-image-734" alt="fend_off_rsi" src="http://beyondvincent.com/wp-content/uploads/2013/05/fend_off_rsi.jpg" width="1200" height="620" /></a></p>

<p>在Double Encore，我们写的代码都是干净，可重用的——不过，有时候并不能完全做到。如在使用pragma mark的时候。下面就是一个示例：</p>

<pre class="wp-code-highlight prettyprint linenums:1">#pragma mark - UIViewController overrides</pre>


<p>通过pragma mark，可以让代码看起来既整洁又有组织。虽然这很重要，但是会带来额外的输入操作和时间。</p>

<p>此时，我们可以使用code snippets。</p>

<p>通过code snippets，我们可以创建一些可重用的代码块，并且在任何需要的地方很容易的就可以使用这些代码块。这可以节省输入需要的操作和时间。并且，一旦你学会使用code snippets，会发现你可以创建并扩充自己的code snippet library。</p>

<p>创建一个code snippet非常简单。首先，打开Xcode并在utilities panel中选择code snippet library。</p>

<p><a href="http://beyondvincent.com/wp-content/uploads/2013/05/1-1024x768.png"><img class="alignnone size-full wp-image-736" alt="1-1024x768" src="http://beyondvincent.com/wp-content/uploads/2013/05/1-1024x768.png" width="1024" height="768" /></a></p>

<p>上图中，可以看到在code snippet library中已经有一些数据了。</p>

<p>接着，输入希望创建的code snippet。在这里，我为pragma mark创建一个code snippet。如下图所示，在代码编辑器中输入 “#pragma mark – UIViewController overrides”。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/2-1024x768.png" width="1024" height="768" /></p>

<p>选中代码块，如下图所示：</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/3-1024x768.png" width="1024" height="768" /></p>

<p>然后单击并按住代码块，知道文本光标变为箭头光标。接着将代码块拖放到code snippet library中，然后松开鼠标。如下图所示</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/4-1024x768.png" width="1024" height="768" /></p>

<p>此时会弹出一个popover，通过该popover可以对新的code snippet进行编辑，如下图所示。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/5-1024x768.png" width="1024" height="768" /></p>

<p>首先，是定snippet的名字。这里我指定为“Pragma Mark”</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/6-1024x768.png" width="1024" height="768" /></p>

<p>然后，指定该snippet的completion shortcut（可选项）。这里我指定为“pm”。这样设置以后，在Xcode的代码编辑器中只需要输入快捷方式（pm），就能简单的将这个snippet添加到代码中。非常有用！</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/7-1024x768.png" width="1024" height="768" /></p>

<p>接着，可以看到在上面的示例中，pragma mark的标题是“UIViewController overrides”，不过我们是希望对其修改一下，以能够很容易的输入任意标题。</p>

<p>我们可以简单的将code snippet包含的文本内容修改为“#pragma mark – “即可。不过，这里还有更好的一个办法——将文本块封装到“&lt;#” 和 “#>”中间，这样code snippet将指出我们可以插入自定义文本的完整范围。</p>

<p>下面，将“UIViewController overrides”替换…</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/8-1024x768.png" width="1024" height="768" /></p>

<p>&#8230;为“&lt;#Title#>”。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/9-1024x768.png" width="1024" height="768" /></p>

<p>注意，completion scopes字段在这里并没有做修改，通过该字段可以指定completion shortcut的有效范围。</p>

<p>最后，点击edit按钮，以完成snippet的编辑。之后可以在这个popover画面中看到最终结果的一个预览效果。</p>

<p>&nbsp;</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/10-1024x768.png" width="1024" height="768" /></p>

<p>然后点击popover中的done按钮。下面，你可以将我们在代码编辑器中为创建snippet而写入的文本行删除掉。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/11-1024x768.png" width="1024" height="768" /></p>

<p>现在来试用一下刚刚创建的snippet！有两种方法。第一种是在code snippet library中找到snippet，然后用鼠标将其拖拽到代码编辑器中&#8230;</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/12-1024x768.png" width="1024" height="768" /></p>

<p>&#8230;然后松开鼠标。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/13-1024x768.png" width="1024" height="768" /></p>

<p>一旦将snippet拖放到代码编辑器之后，就可以通过点击键盘上的tab键在不同的completion字段间移动焦点。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/14-1024x768.png" width="1024" height="768" /></p>

<p>第二种方法是在代码编辑器里简单的输入completion shortcut中设置的内容即可。我们这里是“pm”。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/15-1024x768.png" width="1024" height="768" /></p>

<p>然后点击键盘中的return键，就可以将snippet插入到代码编辑器中。</p>

<p><img class="alignnone size-full wp-image-736" alt="" src="http://www.doubleencore.com/wp-content/uploads/2013/04/141-1024x768.png" width="1024" height="768" /></p>

<p>很简单吧！现在你已经知道如何创建自己的snippet了，你将发现这非常的有用。任何时候，你都遇到重复输入的相同代码块，都可以考虑将其添加到你的code snippets library中。</p>

<p>&nbsp;</p>

<p>下面是我经常使用到的一些snippet：</p>

<pre class="wp-code-highlight prettyprint linenums:1">Title: Animation Block
Completion Shortcut: ab
Completion Scopes: Function or Method
 
void (^&lt;#Title#&gt;)(void) = ^{ };
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Animation Completion Block
Completion Shortcut: acb
Completion Scopes: Function or Method
 
void (^&lt;#Title#&gt;)(BOOL) = ^(BOOL finished) { };
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Notification Add
Completion Shortcut: na
Completion Scopes: Function or Method
 
[[NSNotificationCenter defaultCenter] addObserver:&lt;#Observer#&gt; selector:&lt;#Selector#&gt; name:&lt;#Name#&gt; object:&lt;#Object#&gt;];
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Notification Remove
Completion Shortcut: nr
Completion Scopes: Function or Method
 
[[NSNotificationCenter defaultCenter] removeObserver:&lt;#Observer#&gt; name:&lt;#Name#&gt; object:&lt;#Object#&gt;];
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: NSLog
Completion Shortcut: log
Completion Scopes: Function or Method
 
NSLog(@"&lt;#Log#&gt;");
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Private Interface
Completion Shortcut: pi
Completion Scopes: Top Level
 
@interface &lt;#Title#&gt; ()

@end
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Property Assign
Completion Shortcut: pa
Completion Scopes: All
 
@property (assign, nonatomic)
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Property Strong
Completion Shortcut: ps
Completion Scopes: All
 
@property (strong, nonatomic)
</pre>




<pre class="wp-code-highlight prettyprint linenums:1">Title: Property Unsafe Unretained
Completion Shortcut: pu
Completion Scopes: All
 
@property (unsafe_unretained, nonatomic)
</pre>




<div style="text-align: left;">
</div>




<div style="text-align: left;">
</div>




<div style="text-align: left;">
  <span style="color: #808080;">本文由<span style="text-decoration: underline; color: #339966;"><a href="http://beyondvincent.com/"><span style="color: #339966; text-decoration: underline;">破船</span></a></span>译自<span style="text-decoration: underline; color: #339966;"><a href="http://www.doubleencore.com/2013/05/xcode-code-snippets/" target="_blank"><span style="color: #339966; text-decoration: underline;">doubleencore</span></a></span>●转载请注明出处●<time datetime="2013-05-18T17:37:00+08:00" data-updated="true">2012-05-30</time></span>
</div>




		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/10/" class="prev">Prev</a>
    
    
        <a href="/blog/page/12/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">所有文章</a></div>
    
    <script type="text/javascript">
var duoshuoQuery = {short_name:"beyondvincent"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
</nav>

</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - 破船(BeyondVincent) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'beyondvincent001';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42893468-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1a3c98825a726bfbf68a83ba97e0b9be' type='text/javascript'%3E%3C/script%3E"));
    </script>

		</div>
	</div>
</body>
</html>
